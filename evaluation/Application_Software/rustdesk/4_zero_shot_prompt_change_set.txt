Changes between 1.2.7 and 1.3.0
================================================================================

COMMITS
--------------------------------------------------------------------------------

Commit: eef091d4e816a5d57d897567461def74c0b99f6e
Author: 21pages
Date: 2024-07-23 13:35:05+00:00
Message: fix hide ab tag when custom client startup (#8795)

not custom: 'Y', ''
custom: 'Y', 'N'
should not use isNotEmpty

Signed-off-by: 21pages <sunboeasy@gmail.com>
----------------------------------------

Commit: 2ffc2ad85b5f7252ba4abe5bb6b1d7efa704b081
Author: rustdesk
Date: 2024-07-23 14:26:23+00:00
Message: enhance https://github.com/rustdesk/rustdesk-server-pro/discussions/325
----------------------------------------

Commit: 614086a216c3866c7155644e903045dd431db71a
Author: dignow
Date: 2024-07-23 15:28:03+00:00
Message: fix: mobile, query onlines, on active (#8796)

* fix: mobile, query onlines, on active

Signed-off-by: dignow <linlong1265@gmail.com>

* Update peer_tab_page.dart

---------

Signed-off-by: dignow <linlong1265@gmail.com>
Co-authored-by: RustDesk <71636191+rustdesk@users.noreply.github.com>
----------------------------------------

Commit: a72a8906b060c691624da1fa187558d5885ec9e9
Author: Vasyl Gello
Date: 2024-07-23 15:31:36+00:00
Message: vcpkg deps (#8764)

* Revert "Revert vcpkg ffmpeg (#8751)"

This reverts commit 5c16a8302e6c9c1381873aff45dba1487ee51d4f.

* vcpkg: Reland ffmpeg and try to fix sciter build

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

* vcpkg: Detect AVX2 by requiring __m256i

(ubuntu18.04 sciter)

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

* Install nasm from debian buster and python3.7

... from ubuntu universe

[Skip CI]

* vcpkg: Add libyuv port with fix for windows

From
https://github.com/dchapyshev/vcpkg4aspia/commit/abc59feabf5b3a70662631293eb67c941be4bb8a

Found by @deep-soft

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

* Bump vcpkg baseline to 2024.07.12

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

* Fix F-Droid version action

I thought the latest release will be updated by the time hook starts
but it is not the case. Get tag from GITHUB_REF instead if GITHUB_REF_TYPE
is "tag".

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

---------

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>
----------------------------------------

Commit: 2de81045ea45222ef7626caa52449594e2457f27
Author: Mr-Update
Date: 2024-07-24 01:41:25+00:00
Message: Update de.rs (#8801)
----------------------------------------

Commit: b26acde4508787669232907d4040ce650ceeeefe
Author: bovirus
Date: 2024-07-24 01:41:43+00:00
Message: Update Italian language (#8800)
----------------------------------------

Commit: 51a60a7eed62e47b71b4a69548fffea062440ca9
Author: Vasyl Gello
Date: 2024-07-24 02:16:25+00:00
Message: Fix arm32 sciter build (#8803)

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>
----------------------------------------

Commit: 8a4a2b573218388906991f085248f155b8e14dd7
Author: Vasyl Gello
Date: 2024-07-24 03:23:49+00:00
Message: Remove existing /opt/artifacts/vcpkg in sciter builds (#8804)

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>
----------------------------------------

Commit: 57d1b1ecc40e3b53ce6d595502ca71605db2fcc2
Author: 21pages
Date: 2024-07-24 04:06:16+00:00
Message: fix nextRgba not called when switching to texture render (#8792)

Because rgba buffer render doesn't support multi display, when switch to
multi display, it is possible that rgba.valid has been set to valid but
nextRgab is not called, when switching back to single display,
rgba.valid is still true.

Fix by rgba buffer, rgba texture and  gpu texture using different messages.

Signed-off-by: 21pages <sunboeasy@gmail.com>
----------------------------------------

Commit: 79a1f888d6518f64363217cdc5cee683a4bb12d4
Author: dignow
Date: 2024-07-24 06:00:49+00:00
Message: fix: flutter remove setState in initState (#8807)

Signed-off-by: dignow <linlong1265@gmail.com>
----------------------------------------

Commit: c04f460bbdd3a4d9deb2200d82ac1bcbc3d4c101
Author: 21pages
Date: 2024-07-24 09:20:58+00:00
Message: fix more bool options (#8809)

* fix more bool options
* hide sort ab tags because it's already sorted

Signed-off-by: 21pages <sunboeasy@gmail.com>
----------------------------------------

Commit: 39dbd89287c327ad245eaf1bffc710c4e3f6e21b
Author: dignow
Date: 2024-07-24 09:35:06+00:00
Message: fix: siwtching display, clear last old image (#8810)

* fix: siwtching display, clear last old image

1. Clear last old image.
2. Try refresh after switching display.
3. Add an interval check before refresh video service.

Signed-off-by: dignow <linlong1265@gmail.com>

* simple changes

Signed-off-by: dignow <linlong1265@gmail.com>

---------

Signed-off-by: dignow <linlong1265@gmail.com>
----------------------------------------

Commit: d73e0e1e5a2d1b785a51c479f6c7dcd0e49937f5
Author: dignow
Date: 2024-07-24 10:41:52+00:00
Message: fix: video service (#8812)

1. Unset refresh flag if just refreshed.
2. Reduce the scope of the lock.

Signed-off-by: dignow <linlong1265@gmail.com>
----------------------------------------

Commit: f7e9057a3965248b8dbb4cc1a1c9a8c1eae24529
Author: dignow
Date: 2024-07-24 13:59:25+00:00
Message: fix: video service, do not skip refresh message (#8815)

Signed-off-by: dignow <linlong1265@gmail.com>
----------------------------------------

Commit: 0451a1c45f911d46cbb7bcdf5c5a8b857314edac
Author: dignow
Date: 2024-07-24 16:13:22+00:00
Message: fix: mobile, server page, jumps on loading (#8819)

Signed-off-by: dignow <linlong1265@gmail.com>
----------------------------------------

Commit: 2aef79688b7b5ae363637ae7af3d48dd1c3e0040
Author: dignow
Date: 2024-07-24 16:43:14+00:00
Message: fix: mobile, conn page, jump on exiting remote (#8820)

Signed-off-by: dignow <linlong1265@gmail.com>
----------------------------------------

Commit: b967d496ccced6a01687887f48467bcb9c453662
Author: dignow
Date: 2024-07-25 02:45:51+00:00
Message: refact: init values from initState to Constractor (#8817)

* refact: init values from initState to Constractor

Signed-off-by: dignow <linlong1265@gmail.com>

* fix: move RxBool init into Constructor

Signed-off-by: dignow <linlong1265@gmail.com>

* peer sort option

Signed-off-by: dignow <linlong1265@gmail.com>

* Remove empty initState()

Signed-off-by: dignow <linlong1265@gmail.com>

---------

Signed-off-by: dignow <linlong1265@gmail.com>
----------------------------------------

Commit: baf70da2feab5371f8af2aefd63fe8e9a761bdb5
Author: dignow
Date: 2024-07-25 06:44:58+00:00
Message: fix: trackpad, reverse horizontal scroll (#8827)

Signed-off-by: dignow <linlong1265@gmail.com>
----------------------------------------

Commit: bbdce8d57bcebe07be87c822afe50a5d7b518fda
Author: rustdesk
Date: 2024-07-25 07:21:28+00:00
Message: Send clipboard keystroke, https://github.com/rustdesk/rustdesk/discussions/5451
----------------------------------------

Commit: 3999d498be4332a8427e90614b512c4527577c32
Author: fufesou
Date: 2024-07-25 13:52:57+00:00
Message: fix: keep window pos after new conn (#8834)

1. Keep window pos
2. Do some init in StatefulWidget constructor.
If try init in its state class, it may be too late. Because I see the
init function is called after building the widget tree.

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: 1850d32f4996d67ecf3828121e568c409f8e051e
Author: bovirus
Date: 2024-07-26 02:00:18+00:00
Message: Update Italian language (#8838)
----------------------------------------

Commit: f0f50f0f03215fa71de43873eb6e8b1894bfa3ff
Author: zuiyu
Date: 2024-07-26 02:31:01+00:00
Message: fix: remove getRadio todo and delete  contentPadding param (#8839)
----------------------------------------

Commit: be06c0d7381dcfce50161bceff3d1aac4e81ff46
Author: 21pages
Date: 2024-07-26 03:20:16+00:00
Message: tab border for desktop subwindow (#8842)

Signed-off-by: 21pages <sunboeasy@gmail.com>
----------------------------------------

Commit: 9f0985c842535a190d6d9d0a098a9c81db112619
Author: FastAct
Date: 2024-07-26 09:17:05+00:00
Message: Update nl.rs (#8843)
----------------------------------------

Commit: 30a5d1e0e1cd9d4d986efb2dbba90f32481c3fe9
Author: 21pages
Date: 2024-07-27 01:50:06+00:00
Message: avoid call refreshCurrentUser twice at startup (#8848)

refreshCurrentUser will be called at these 2 position:

1. runMainApp or runMobileApp in main.dart
2. when connect status is ready

Both of these two happens at startup, when connect status is ready and startup time < 5 seconds, not call refreshCurrentUser

Signed-off-by: 21pages <sunboeasy@gmail.com>
----------------------------------------

Commit: 1357ef5d6fc0d634724acb0ea95d8ff773bea589
Author: Vasyl Gello
Date: 2024-07-27 07:32:26+00:00
Message: Try to fix sciter-armhf build (#8850)

* Bootstrap CMake 3.29.7 for ubuntu/bionic/armhf
  * vcpkg exevutable now needs GCC 8 but all product binaries
    are still OK with GCC 7
  * Remove res/vcpkg/linux.cmake

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>
----------------------------------------

Commit: d679e8fa7d6e713722c226f6f9fcb790eab7a151
Author: rustdesk
Date: 2024-07-27 08:16:31+00:00
Message: WIN_RUST_VERSION -> SCITER_RUST_VERSION
----------------------------------------

Commit: aa42bf548e7f61809347ee28f7f05dcb0ee4f385
Author: Vasyl Gello
Date: 2024-07-27 08:29:53+00:00
Message: Limit cmake buildstep to 1 threads to check OOM (#8852)

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>
----------------------------------------

Commit: f67f2be0cbeca2b1774a1b6ab28d795647856b0f
Author: Vasyl Gello
Date: 2024-07-27 13:28:34+00:00
Message: Add built CMake to PATH in actual RD build step (#8855)

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>
----------------------------------------

Commit: 67d4e061fba73669990005ed2bc096f5917276b7
Author: Vasyl Gello
Date: 2024-07-27 15:57:53+00:00
Message: Try to detach /opt/artifacts from sciter (#8857)

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>
----------------------------------------

Commit: 9750e1409cf301b2d3a0681e97a9cd560a876620
Author: Vasyl Gello
Date: 2024-07-28 00:44:16+00:00
Message: Use VCPKG_FORCE_SYSTEM_BINARIES in actual RD sciter build step (#8859)

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>
----------------------------------------

Commit: 7e8d3bd2acb299f6f896cb4adaacb86a59f78d7b
Author: 21pages
Date: 2024-07-28 02:15:09+00:00
Message: remove calling refreshCurrentUser when connect status become ready (#8849)

When refreshCurrentUser throw error, show check network in ab and group
tab.

Signed-off-by: 21pages <sunboeasy@gmail.com>
----------------------------------------

Commit: ee5314de20044e96e349b2ef3c421f893472d989
Author: 21pages
Date: 2024-07-28 03:13:19+00:00
Message: use selectableText for some errors (#8862)

Signed-off-by: 21pages <sunboeasy@gmail.com>
----------------------------------------

Commit: 0faf82f109cfe224cd55ce60b87b1f52a401927a
Author: bovirus
Date: 2024-07-28 09:13:01+00:00
Message: Update Italian language (#8863)
----------------------------------------

Commit: 19d1605d8c9b38d238b7ad4a18e32f7286027238
Author: jxdv
Date: 2024-07-28 09:13:15+00:00
Message: Update trs (#8866)

* update sk-tr

* update cs-tr
----------------------------------------

Commit: 8c91e5c5ca169d3018b96fb729ba64ec972e9ccd
Author: fufesou
Date: 2024-07-28 09:26:18+00:00
Message: refact: update crate tfc (#8867)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: 541d9c6b86fb2cb649659106eacb982c7c61357f
Author: fufesou
Date: 2024-07-28 09:26:54+00:00
Message: feat: clipboard, multi formats (#8733)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: c0e94456020772bf7202ac674faf2f8f3d1a2a7b
Author: fufesou
Date: 2024-07-28 09:27:09+00:00
Message: refact: embed crate mouce, uinput (#8836)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: 50dd2b3aad492e799b7fcdcec56b3683dcf2279a
Author: fufesou
Date: 2024-07-28 11:33:00+00:00
Message: chore (#8868)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: 73f6afd4c08440f42aa6babaa1ecb8fe80339ef3
Author: Mr-Update
Date: 2024-07-28 13:09:36+00:00
Message: Update de.rs (#8870)
----------------------------------------

Commit: fd9b5f3c57cb8b9928c99532892af32bc78ee8c2
Author: rustdesk
Date: 2024-07-28 14:55:00+00:00
Message: fix https://github.com/rustdesk/rustdesk-server-pro/issues/334
----------------------------------------

Commit: 0a1d3c4afb1c2d8eacfdd0d41f1df0bcbc150094
Author: XLion
Date: 2024-07-29 07:34:26+00:00
Message: Update tw.rs and cn.rs (#8877)

* Update tw.rs

* Update cn.rs
----------------------------------------

Commit: 0e98a517752ccac7d51c5280f5604ba6cc0fd735
Author: fufesou
Date: 2024-07-29 07:40:02+00:00
Message: fix: clipboard, set formats and enable option (#8873)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: e03344d85bbd61b8098b0966419e3453b662a800
Author: fufesou
Date: 2024-07-29 13:19:29+00:00
Message: fix: clipboard, read as much as possible (#8881)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: 764fbe2c9dfed713fff14605ecb7922a33d9f4e8
Author: rustdesk
Date: 2024-07-29 16:26:38+00:00
Message: addressing https://github.com/rustdesk/rustdesk/issues/8883
----------------------------------------

Commit: 97772f9ac512a88bf4a6ed19a10911c6294cb0b8
Author: Generalworks Inc.
Date: 2024-07-29 16:27:28+00:00
Message: Fix typo on ja.rs (#8886)
----------------------------------------

Commit: 15404ecab4b5cca0d02f5d8e357123e5bb3d26d6
Author: fufesou
Date: 2024-07-30 03:35:39+00:00
Message: fix: clipboard, windows, controlled side, formats (#8885)

* fix: clipboard, windows, controlled side, formats

Signed-off-by: fufesou <linlong1266@gmail.com>

* Clipboard, reuse ipc conn and send_raw()

Signed-off-by: fufesou <linlong1266@gmail.com>

* Clipboard, merge content buffer

Signed-off-by: fufesou <linlong1266@gmail.com>

* refact: clipboard service, ipc stream

Signed-off-by: fufesou <linlong1266@gmail.com>

---------

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: 8ced4ddaa27fa2a71166fe83323b5627f06890f5
Author: fufesou
Date: 2024-07-30 05:06:37+00:00
Message: simple refact (#8888)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: cba8aaa4108f7826810b07a43163c41bd3743b5a
Author: rustdesk
Date: 2024-07-30 06:41:36+00:00
Message: tooltip for https://github.com/rustdesk/rustdesk/issues/8600, and change
dialog error to richtext with link support
----------------------------------------

Commit: e1e4bf599b0988bac0d26f8584eec72a80514111
Author: 21pages
Date: 2024-07-30 06:52:06+00:00
Message: add libatomic1 to linux armv7 sciter depends (#8890)

Signed-off-by: 21pages <sunboeasy@gmail.com>
----------------------------------------

Commit: a103b83647f31a4bc2e572fb7d760bf4d0508e1c
Author: FastAct
Date: 2024-07-30 12:23:49+00:00
Message: Update nl.rs (#8892)
----------------------------------------

Commit: 35571dc8d76821e2ba217fe124bafbe04fc9e60e
Author: solokot
Date: 2024-07-31 06:16:55+00:00
Message: Update ru.rs (#8901)
----------------------------------------

Commit: 4fec8abad41d1e5e4535f37e2802d2b15dfd35a0
Author: 21pages
Date: 2024-07-31 09:25:10+00:00
Message: update repo to rustdesk-org (#8905)

Signed-off-by: 21pages <sunboeasy@gmail.com>
----------------------------------------

Commit: cb6a6aa42a3e42a8858b45b8a93cea376fd5dadb
Author: Vasyl Gello
Date: 2024-07-31 12:38:00+00:00
Message: flutter-build: Parameterize Android build matrix (#8907)

As @rustdesk noted debug builds are no-go in official RD repo
but this change makes it possible to filter jobs only relevant to
Android from flutter-build.yml to build only Android in a separate
mirror of Rustdesk.

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>
----------------------------------------

Commit: 9f91eada898d28d13bd7707190aeb7936dcf02e1
Author: rustdesk
Date: 2024-08-01 01:09:45+00:00
Message: fix https://github.com/rustdesk/rustdesk-server-pro/issues/338
----------------------------------------

Commit: a12969be307909d3540694e5d07b424ae2b97d95
Author: Hamir Mahal
Date: 2024-08-01 01:12:11+00:00
Message: fix: usage of `actions/checkout@v3` (#8912)

* chore: changes from formatting on save

* fix: usage of `actions/checkout@v3`
----------------------------------------

Commit: 85604dee7915122646efd378486bc6905ef844bf
Author: fufesou
Date: 2024-08-01 07:08:52+00:00
Message: refact: msi, custom client props (#8913)

* refact: msi, custom client props

Signed-off-by: fufesou <linlong1266@gmail.com>

* format

Signed-off-by: fufesou <linlong1266@gmail.com>

---------

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: 1707987a7ba27c1a4b43c436256886576d414ca6
Author: Vasyl Gello
Date: 2024-08-01 07:09:33+00:00
Message: Fix typo in android-x86 lib copy step (#8914)

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>
----------------------------------------

Commit: f6aca4ca8e3eb7661f6665540494278fba7ce87a
Author: 21pages
Date: 2024-08-01 10:17:02+00:00
Message: fix click cm audio permission button before auth (#8917)

1. When not authenticated, clicking the audio permission button on the cm will send audio data
2. Keep the cursor position code unchanged, because `show_remote_cursor` is false before auth, so subscription will not happen.
3. Keep the clipboard code unchanged, because the keyboard permission will also be determined in `try_sub_services`. If the clipboard permission is clicked before auth and the keyboard permission is clicked after auth, the clipboard service will not be subscribed.

Signed-off-by: 21pages <sunboeasy@gmail.com>
----------------------------------------

Commit: 61ccc2152ed06a14f77da0c6988215cf44fc7098
Author: Vasyl Gello
Date: 2024-08-01 13:33:59+00:00
Message: Bump Android NDK to r27 (#8918)

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>
----------------------------------------

Commit: 2333ee2c07c6a67ed6c58ccfbc50a3bee203f90d
Author: rustdesk
Date: 2024-08-02 01:29:27+00:00
Message: fix https://github.com/rustdesk/rustdesk/issues/8923
----------------------------------------

Commit: e67b694f06afa40a754993c0747916d5a596e1dd
Author: Yevhen Popok
Date: 2024-08-02 01:31:37+00:00
Message: Update Ukrainian translation (#8921)
----------------------------------------

Commit: b6035fbbdfffb9d6a083e8754e786a8abaa3feaf
Author: 21pages
Date: 2024-08-02 07:12:48+00:00
Message: update supportedLocales (#8925)

Signed-off-by: 21pages <sunboeasy@gmail.com>
----------------------------------------

Commit: d9fba50606ef19065b7cff4bdd40dfdb9a3ca706
Author: rustdesk
Date: 2024-08-02 07:43:55+00:00
Message: fix https://github.com/rustdesk/rustdesk-server-pro/issues/334 again
----------------------------------------

Commit: 5e7d4fd2d62fb5fb45b18453f2c195a1316a2213
Author: Vasyl Gello
Date: 2024-08-02 10:43:30+00:00
Message: vcpkg deps (#8926)

* vcpkg: bump opus to 1.5.2

Should fix flakes caused by https://github.com/android/ndk/issues/2032

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

* vcpkg: actually use cached artifacts

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

* Print all vcpkg log files on errors

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

---------

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>
----------------------------------------

Commit: 6eea4252805a989a3743d954a6a28c64932c408b
Author: fufesou
Date: 2024-08-02 13:36:49+00:00
Message: fix: clipboard cm ipc data, raw bytes (#8930)

* fix: clipboard cm ipc data, raw bytes

Signed-off-by: fufesou <linlong1266@gmail.com>

* Remove useless check

Signed-off-by: fufesou <linlong1266@gmail.com>

---------

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: 2dd3d8c11e5d2a02cc1805718f7d0d965b375c66
Author: Yevhen Popok
Date: 2024-08-02 14:58:45+00:00
Message: Use correct locale code for Ukrainian translation file name (#8932)

Rename Ukrainian translation file ua.rs to uk.rs to avoid confusion.
This complements commits [2333ee2](https://github.com/rustdesk/rustdesk/commit/2333ee2c07c6a67ed6c58ccfbc50a3bee203f90d) and [b6035fb](https://github.com/21pages/rustdesk/commit/b6035fbbdfffb9d6a083e8754e786a8abaa3feaf)
----------------------------------------

Commit: f899b2a962e169a0e58e6b98c84d1fe9035f58de
Author: rustdesk
Date: 2024-08-03 10:04:52+00:00
Message: fix https://github.com/rustdesk/rustdesk/issues/8856
----------------------------------------

Commit: ba43424781ccc5c380906742c13ca860b5c0e849
Author: Vasyl Gello
Date: 2024-08-03 10:39:12+00:00
Message: Build universal apk (#8941)

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>
----------------------------------------

Commit: 31a1b7a80b42bc5ecf76b48cef172b9699ada703
Author: Vasyl Gello
Date: 2024-08-03 11:00:27+00:00
Message: Fix copy step for universal apk (#8942)

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>
----------------------------------------

Commit: 508dd5b38368223fb34e14bc9dc350087bdf54be
Author: fufesou
Date: 2024-08-03 14:29:30+00:00
Message: fix: custom client, msi, conn type (#8944)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: 0d1d7a9b8781e81c4f9ea3b40a7a466d25da4226
Author: Vasyl Gello
Date: 2024-08-04 04:34:08+00:00
Message: Guard parameters for universal apk (#8943)

* Guard parameters for universal apk

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

* Free space before android builds

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

---------

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>
----------------------------------------

Commit: b6ba9978e37b2caec34b4b4ea1af10fb4fef5bef
Author: 21pages
Date: 2024-08-04 08:11:00+00:00
Message: set max audio buffer to 150ms, clear audio buffer if full (#8947)

The device should have the capability to play a sufficient audio buffer during each period to meet the audio config, so the playback speed is not slow.

The audio delay is caused by network jitter. The controlled  side sends audio data every 10ms, but it often happens that multiple packets are sent together. During underrun periods, the controlling side plays extra silence data instead, resulting in the device playing more audio than the configured amount.
----------------------------------------

Commit: 9b8209b61bb66623edae7eee93175d913b94be6e
Author: rustdesk
Date: 2024-08-04 08:17:59+00:00
Message: log::trace audio buffer cleared
----------------------------------------

Commit: cb0dc46d08927513ff024e2f6546a09672874bbc
Author: rustdesk
Date: 2024-08-04 08:22:42+00:00
Message: turn it off since it does not work, please test it before submit PR
----------------------------------------

Commit: 7bf5e69444c42f6fba46a5ef062499beb5e3cd10
Author: rustdesk
Date: 2024-08-04 08:23:58+00:00
Message: revert
----------------------------------------

Commit: eafebdba210cad50c837fbf6607df6e22e494ee8
Author: rustdesk
Date: 2024-08-04 08:32:05+00:00
Message: run universal for upload only
----------------------------------------

Commit: e58e75eea9df83b866726cb3ea0f32d3a1a124a1
Author: rustdesk
Date: 2024-08-04 10:45:49+00:00
Message: add address_book_name, address_book_tag to cli, https://github.com/rustdesk/rustdesk/discussions/7866, need to use with server Pro 1.4.2 (not ready)
----------------------------------------

Commit: 2266fde26f609586641f3093a1230c57cade73d8
Author: rustdesk
Date: 2024-08-04 11:31:13+00:00
Message: fix address_book_name cli
----------------------------------------

Commit: b3e1c8a90770937350b0e825292bd1ede9acb861
Author: fufesou
Date: 2024-08-05 09:49:48+00:00
Message: Refact/msi more install options (#8949)

* refact: msi, more install options

Signed-off-by: fufesou <linlong1266@gmail.com>

* refact: msi, reg values on upgrade/modify

Signed-off-by: fufesou <linlong1266@gmail.com>

* fix: msi, silent repair/upgrade, RemoveInstallFolder()

Signed-off-by: fufesou <linlong1266@gmail.com>

* Options support both 1/0 and Y/N

Signed-off-by: fufesou <linlong1266@gmail.com>

* refact: msi, preprocess, open file with explicit encoding

Signed-off-by: fufesou <linlong1266@gmail.com>

* fix: msi, read previous options

Signed-off-by: fufesou <linlong1266@gmail.com>

* fix: mis, install folder, read previous option

Signed-off-by: fufesou <linlong1266@gmail.com>

* Comment on Control -> Checkbox

Signed-off-by: fufesou <linlong1266@gmail.com>

* fix: UI, checkbox options, read previous values

Signed-off-by: fufesou <linlong1266@gmail.com>

* fix: shortcuts options, init state

Signed-off-by: fufesou <linlong1266@gmail.com>

* fix: shortcuts, init state

Signed-off-by: fufesou <linlong1266@gmail.com>

* Better shortcuts property conditions

Signed-off-by: fufesou <linlong1266@gmail.com>

---------

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: 2662abc5a39b25d76568f3278de1fb4fd62b59b0
Author: fufesou
Date: 2024-08-05 16:28:31+00:00
Message: fix: reset voice call state, on conn (#8961)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: 421ddc001603b014a45d8492894989816e4e6f66
Author: rustdesk
Date: 2024-08-06 04:11:03+00:00
Message: fix https://github.com/rustdesk/rustdesk/issues/4863
----------------------------------------

Commit: 877b3e2ce58d25f1f02821d45e86bbf5ec431e0e
Author: rustdesk
Date: 2024-08-06 04:19:06+00:00
Message: fix ci
----------------------------------------

Commit: 5a2121501d508274d792561db608c2c3f0e86291
Author: 21pages
Date: 2024-08-06 04:36:39+00:00
Message: fix build (#8964)

Signed-off-by: 21pages <sunboeasy@gmail.com>
----------------------------------------

Commit: 51b250435dcdc0f6b6252d488897e10348526de6
Author: fufesou
Date: 2024-08-06 09:07:05+00:00
Message: refact: audio input, combobox instead of radio (#8965)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: 96edca8f74e195896db9f9929d2aed3100eac47f
Author: 21pages
Date: 2024-08-06 10:19:35+00:00
Message: update sysinfo rlim_max, which causing debian 13 pkexec not work (#8968)

* update sysinfo rlim_max, which causing debian 13 pkexec not work

Signed-off-by: 21pages <sunboeasy@gmail.com>

* Update Cargo.toml

---------

Signed-off-by: 21pages <sunboeasy@gmail.com>
Co-authored-by: RustDesk <71636191+rustdesk@users.noreply.github.com>
----------------------------------------

Commit: 2f432e941ddae05ce8a0603ec29791c6b79d2f17
Author: rustdesk
Date: 2024-08-06 17:08:36+00:00
Message: hide-tray option
----------------------------------------

Commit: 025cdfa25b0bb3d8a169b29829bc54eaf69eb70f
Author: rustdesk
Date: 2024-08-06 17:19:29+00:00
Message: fix ci
----------------------------------------

Commit: bc6ce6c7eeadb6a285241c7b9c3450ff4e78c7c5
Author: jkh0kr
Date: 2024-08-07 02:12:43+00:00
Message: Update ko.rs (#8974)

Additional Korean translation
----------------------------------------

Commit: 76d5a8b20587329c86e53ca5f755fa7062174aef
Author: 21pages
Date: 2024-08-07 08:21:38+00:00
Message: unlock with PIN (#8977)

* add custom password to unlock settings

* If not set, use admin password; if set, use custom settings password.
* At least 4 characters.
* Set with gui or command line.

Signed-off-by: 21pages <sunboeasy@gmail.com>

* Update cn.rs

---------

Signed-off-by: 21pages <sunboeasy@gmail.com>
Co-authored-by: RustDesk <71636191+rustdesk@users.noreply.github.com>
----------------------------------------

Commit: 9a194f085060c171009430cfd78d0a784b2dc656
Author: rustdesk
Date: 2024-08-07 15:26:03+00:00
Message: res/users.py
----------------------------------------

Commit: ade1d8c0c72c86c22195c5ab489ac5144167b896
Author: bovirus
Date: 2024-08-08 02:24:15+00:00
Message: Update Italian language (#8988)
----------------------------------------

Commit: 171177c76f34b13aded26ab6e1976b3572374344
Author: solokot
Date: 2024-08-08 02:24:28+00:00
Message: Update ru.rs (#8987)
----------------------------------------

Commit: ae16b8975bdb66c7e74c600797fd98826f107eb7
Author: Yevhen Popok
Date: 2024-08-08 02:24:40+00:00
Message: Update Ukrainian translation (#8980)

Sync with #8977
----------------------------------------

Commit: 2fd53f9825693d5f73f9d5480ffc931f3fc3ef42
Author: Vasyl Gello
Date: 2024-08-08 03:53:49+00:00
Message: Pass JVM to ffmpeg (#8985)

Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>
----------------------------------------

Commit: 619783231796d0a12fb0d3255da406d443de7132
Author: rustdesk
Date: 2024-08-08 03:58:12+00:00
Message: update hwcodec
----------------------------------------

Commit: 049c334db325cfe3ed9d4d9eb3dc17d3ea7214cd
Author: fufesou
Date: 2024-08-08 07:31:11+00:00
Message: fix: privacy mode, windows vd, init resolution (#8992)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: f4c40d733e74879c122155fe4980798b2f3a0523
Author: fufesou
Date: 2024-08-08 14:07:06+00:00
Message: Fix/exe upgrade options (#9001)

* fix: exe upgrade, use previous options

Signed-off-by: fufesou <linlong1266@gmail.com>

* refact: msi, shortcuts options, swap pos

Signed-off-by: fufesou <linlong1266@gmail.com>

---------

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: e7e244d4f25bb7ffdcfb4add9c8addabce27c10a
Author: fufesou
Date: 2024-08-08 15:06:33+00:00
Message: fix: update pub desktop_multi_window (#9002)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: 77f3ebaf1a846c56ecde7e9e318c7cb968751f16
Author: Ivan Beà
Date: 2024-08-08 15:18:01+00:00
Message: Update ca.rs (#8997)

* Update ca.rs

update catalan translation

* Update ca.rs

minor changes
----------------------------------------

Commit: 6820e2f4c78a9f04d65b730a159272a7377985eb
Author: Mr-Update
Date: 2024-08-09 00:43:18+00:00
Message: Update de.rs (#9004)
----------------------------------------

Commit: 3c6ddd7403968a05a71d30e1d60f76d217e9156d
Author: fufesou
Date: 2024-08-09 13:17:06+00:00
Message: fix: multi-displays, displays changed, switch idx (#9006)

Use init display index as the primary index.

But when displays changed, the primary display may also changes.

No need to change the old primary index.
But we need to make sure that the old primary index does not exceed the display number.

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: 7521bbe15f2a27830155c0677383241e05dd4077
Author: bovirus
Date: 2024-08-10 12:52:27+00:00
Message: Update Italian language (#9016)
----------------------------------------

Commit: fd69b146236eaa99dfecad0f32bdf95ce0e43b45
Author: mehdi-song
Date: 2024-08-10 22:49:34+00:00
Message: Update fa.rs (#9021)
----------------------------------------

Commit: ce56be65077602d6fa4713ecb8d80d7ce6e71d42
Author: FastAct
Date: 2024-08-10 22:49:52+00:00
Message: Update nl.rs (#9022)
----------------------------------------

Commit: 6625aca9942601fcc97049419f2bfd82d9575f91
Author: fufesou
Date: 2024-08-11 11:26:41+00:00
Message: fix: win, virtual display (#9023)

1. Default resolution 1920x1080.
2. Restore on conn & disconn.

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: 99d7b62d792e1b85145c51ba7312b970fc517f9a
Author: fufesou
Date: 2024-08-11 15:28:02+00:00
Message: fix: privacy mode 2, resolution changed (#9027)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: 57834840b8ffab75dcf553f2904f8b14f1152105
Author: Xp96
Date: 2024-08-12 09:22:00+00:00
Message: Update ptbr.rs (#9031)
----------------------------------------

Commit: 1729ee337f22145607bea1b2b9f68692ec661a5a
Author: 21pages
Date: 2024-08-12 10:08:33+00:00
Message: trust this device to skip 2fa (#9012)

* trust this device to skip 2fa

Signed-off-by: 21pages <sunboeasy@gmail.com>

* Update connection.rs

---------

Signed-off-by: 21pages <sunboeasy@gmail.com>
Co-authored-by: RustDesk <71636191+rustdesk@users.noreply.github.com>
----------------------------------------

Commit: 83bf067d187624ceb04c4765bf3148cb19f0767a
Author: fufesou
Date: 2024-08-12 13:53:41+00:00
Message: fix: not plug virtual dislay, non win, installed (#9034)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: 8f00067266140f824b7bdabbdd3ec4d3c2b92b7a
Author: fufesou
Date: 2024-08-12 14:15:59+00:00
Message: fix: build (#9036)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: b8b3a089f36f7e68e9ec9c48f11f27fa5eeda7fb
Author: 21pages
Date: 2024-08-12 14:20:35+00:00
Message: android telebot setting (#9035)

Signed-off-by: 21pages <sunboeasy@gmail.com>
----------------------------------------

Commit: a771abcdc2c71762448d38ae493bae0e72101cc8
Author: fufesou
Date: 2024-08-12 16:18:35+00:00
Message: fix: win, multi monitors, maximize, may fix 9033 (#9038)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: a3c5adb1f435d0e0516c550fcc201fd8822c1c89
Author: fufesou
Date: 2024-08-13 03:27:39+00:00
Message: refact: remove dup translation (#9043)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: 0651ad492f24e7b953f4b153c726b55cb265c465
Author: flusheDData
Date: 2024-08-13 06:11:36+00:00
Message: Update es.rs (#9045)

New translations
----------------------------------------

Commit: dbd195a46e00d19b25667fa74e325709ce11ccc3
Author: bovirus
Date: 2024-08-13 06:22:08+00:00
Message: Update Italian language (#9047)
----------------------------------------

Commit: 65318efd676206d569ad304c8f4eb1112456ae25
Author: rustdesk
Date: 2024-08-13 13:42:04+00:00
Message: update README
----------------------------------------

Commit: b477aded0b42b2acd59872fc2f486963ad18c780
Author: Mr-Update
Date: 2024-08-14 02:39:05+00:00
Message: Update de.rs (#9054)
----------------------------------------

Commit: f6ab5cdcb297285b3f5a45d582ae780fbe58a7a6
Author: RustDesk
Date: 2024-08-14 09:32:05+00:00
Message: Update config.toml (#9057)
----------------------------------------

Commit: 07cf1b4db5ef2f925efd3b16b87c33ce03c94809
Author: 21pages
Date: 2024-08-14 10:09:47+00:00
Message: fix wallpaper get sid (#9058)

Signed-off-by: 21pages <sunboeasy@gmail.com>
----------------------------------------

Commit: 5e22a49e490b4618c94375ab8c20438e5e2b255f
Author: flusheDData
Date: 2024-08-15 01:24:42+00:00
Message: Translation correction (#9064)

* Update es.rs

New translations

* Update es.rs

Translation correction of 'Version'
----------------------------------------

Commit: cc9b7e64eb75d11839a7e2081500b3b8c202fff1
Author: jkh0kr
Date: 2024-08-15 01:25:03+00:00
Message: Update ko.rs (#9067)

Additional Korean translations
----------------------------------------

Commit: 85ae3916cb7a4d772db979813739a8b58c2de577
Author: 21pages
Date: 2024-08-15 01:57:12+00:00
Message: fix get_custom_server_from_string, `relay=` is not used (#9069)

Signed-off-by: 21pages <sunboeasy@gmail.com>
----------------------------------------

Commit: a31c27be7316197f09a8091391ad43ef418429cd
Author: fufesou
Date: 2024-08-15 05:24:42+00:00
Message: fix: windows, remote window, resizing, #9061 (#9062)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: bb1b9858d500e88a77649dd39dd5cd27c1feb573
Author: 21pages
Date: 2024-08-15 05:25:59+00:00
Message: only main window show tabbar border, change cm tabbar color (#9073)

Signed-off-by: 21pages <sunboeasy@gmail.com>
----------------------------------------

Commit: dde3cce12023c82f8db333d514381dbf53e13dc3
Author: kibeb
Date: 2024-08-15 06:55:44+00:00
Message: Update cs.rs: typo corrected (#9074)
----------------------------------------

Commit: 071f51cf6f3b1aece1b2235d58a540fd2f8a509f
Author: kibeb
Date: 2024-08-15 09:34:39+00:00
Message: Update cs.rs: more corrections, new phrases translated (#9075)
----------------------------------------

Commit: 92752765ba0e1ec6f3398622ac3c05681eb920f0
Author: fufesou
Date: 2024-08-15 15:58:19+00:00
Message: fix: resize top edge (#9081)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: 579e0fac3632892197edf8fba684ee9d93ec09e6
Author: rustdesk
Date: 2024-08-16 04:20:40+00:00
Message: fix https://github.com/rustdesk/rustdesk/issues/9088
----------------------------------------

Commit: ed18e3c7860edca81d07794773bd86ea51e14e18
Author: 21pages
Date: 2024-08-16 04:55:58+00:00
Message: file rename (#9089)

Signed-off-by: 21pages <sunboeasy@gmail.com>
----------------------------------------

Commit: f31e60af5bf3cfac2d43918a0f940b162a00313d
Author: fufesou
Date: 2024-08-16 06:55:42+00:00
Message: fix: crash, drop tokio RunTime in async context (#9091)

* fix: crash, drop tokio RunTime in async context

Signed-off-by: fufesou <linlong1266@gmail.com>

* chore

Signed-off-by: fufesou <linlong1266@gmail.com>

---------

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: e1329c8157d5c6f308acee985da0af513b0d229b
Author: FastAct
Date: 2024-08-16 07:19:18+00:00
Message: Update nl.rs (#9092)
----------------------------------------

Commit: 7744bdbbe0288c1a694e9c78421f87dff3d6f9b1
Author: bovirus
Date: 2024-08-16 10:39:36+00:00
Message: Update Italian language (#9093)
----------------------------------------

Commit: d1fe61767076cdf3b044c2dd87351da211bf6742
Author: rustdesk
Date: 2024-08-18 01:30:53+00:00
Message: fixing https://github.com/rustdesk/rustdesk/issues/9103, maybe
----------------------------------------

Commit: 4e084c5ee0318c4ea24aa97d44d324a3480c981c
Author: rustdesk
Date: 2024-08-18 01:56:24+00:00
Message: revert
----------------------------------------

Commit: 0a5fafb84fa88944408aeefa84e403143febd262
Author: rustdesk
Date: 2024-08-18 02:04:20+00:00
Message: comment
----------------------------------------

Commit: e3f09b3ec66c3565e63552c39f36b2a89696943f
Author: Mr-Update
Date: 2024-08-18 19:12:56+00:00
Message: Update de.rs (#9107)
----------------------------------------

Commit: 715d475f495b551b0adf22db675ef023e517fa0d
Author: fufesou
Date: 2024-08-19 03:35:35+00:00
Message: fix: privacy mode 2, more error info (#9111)

Signed-off-by: fufesou <linlong1266@gmail.com>
----------------------------------------

Commit: c0de0aa108a96e1aa9a9c931efad4c5d6e93a79e
Author: XLion
Date: 2024-08-19 06:13:31+00:00
Message: Update tw.rs (#9112)
----------------------------------------

Commit: 921b64e1e000564dcc95863c09877a38cbeea343
Author: flusheDData
Date: 2024-08-19 06:14:47+00:00
Message: Last tips (#9113)

* Update es.rs

New translations

* Update es.rs

Translation correction of 'Version'

* Update es.rs

Last tips

---------

Co-authored-by: RustDesk <71636191+rustdesk@users.noreply.github.com>
----------------------------------------

Commit: da70cbcddae703e7fb80e077adbd452c078c132c
Author: RustDesk
Date: 2024-08-19 06:19:24+00:00
Message: Update es.rs
----------------------------------------

Commit: 2a0fd55af76cb32d1312cb0166d73ed7214f7ae1
Author: flusheDData
Date: 2024-08-19 06:41:28+00:00
Message: Update es.rs (#9114)

New terms added
----------------------------------------


PULL REQUESTS
--------------------------------------------------------------------------------

PR #8980: Update Ukrainian translation
Author: xalt7x
Merged at: 2024-08-08 02:24:40+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8980
Description:
Sync with #8977
----------------------------------------

PR #9112: Update tw.rs
Author: xlionjuan
Merged at: 2024-08-19 06:13:31+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9112
Description:
None
----------------------------------------

PR #8985: Use JNI MediaCodec-backed hardware codecs on Android (fix some waiting for image)
Author: basilgello
Merged at: 2024-08-08 03:53:49+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8985
Description:
This is a companion change utilizing https://github.com/rustdesk-org/hwcodec/pull/12

----------------------------------------

PR #9114: Update es.rs
Author: flusheDData
Merged at: 2024-08-19 06:41:28+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9114
Description:
New terms added
----------------------------------------

PR #9113: Last tips
Author: flusheDData
Merged at: 2024-08-19 06:14:47+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9113
Description:
None
----------------------------------------

PR #9111: fix: privacy mode 2, more error info
Author: fufesou
Merged at: 2024-08-19 03:35:35+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9111
Description:
Privacy mode 2.

Show `GetLastError()` if `ChangeDisplaySettingsEx` returns `DISP_CHANGE_FAILED `.
----------------------------------------

PR #9107: Update de.rs
Author: Mr-Update
Merged at: 2024-08-18 19:12:56+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9107
Description:
None
----------------------------------------

PR #9057: Fix CI failure on x686 windows for MSVCRT conflicts: MSVCRT.lib(chandler4gs.obj) : error LNK2019: unresolved external symbol __except_handler4_common referenced in function __except_handler4
Author: rustdesk
Merged at: 2024-08-14 09:32:05+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9057
Description:
Original CI failure on x686 Windows.
```
 LINK : warning LNK4098: defaultlib 'MSVCRT' conflicts with use of other libs; use /NODEFAULTLIB:library

          LINK : warning LNK4217: symbol '_abort' defined in 'libucrt.lib(abort.obj)' is imported by 'libmagnum_opus-543c189f8b942366.rlib(celt.c.obj)' in function '_celt_fatal'

          LINK : warning LNK4217: symbol '__set_abort_behavior' defined in 'libucrt.lib(abort.obj)' is imported by 'libmagnum_opus-543c189f8b942366.rlib(celt.c.obj)' in function '_celt_fatal'

          LINK : warning LNK4217: symbol '___acrt_iob_func' defined in 'libucrt.lib(_file.obj)' is imported by 'libmagnum_opus-543c189f8b942366.rlib(celt.c.obj)' in function '_celt_fatal'

          LINK : warning LNK4217: symbol '___stdio_common_vfprintf' defined in 'libucrt.lib(output.obj)' is imported by 'libmagnum_opus-543c189f8b942366.rlib(celt.c.obj)' in function '__vfprintf_l'

          LINK : warning LNK4217: symbol '_free' defined in 'libucrt.lib(free.obj)' is imported by 'libmagnum_opus-543c189f8b942366.rlib(opus_encoder.c.obj)' in function '_opus_encoder_create'

          LINK : warning LNK4217: symbol '_free' defined in 'libucrt.lib(free.obj)' is imported by 'libmagnum_opus-543c189f8b942366.rlib(opus_decoder.c.obj)' in function '_opus_decoder_create'

          LINK : warning LNK4286: symbol '_free' defined in 'libucrt.lib(free.obj)' is imported by 'libmagnum_opus-543c189f8b942366.rlib(repacketizer.c.obj)'

          LINK : warning LNK4217: symbol '_malloc' defined in 'libucrt.lib(malloc.obj)' is imported by 'libmagnum_opus-543c189f8b942366.rlib(opus_encoder.c.obj)' in function '_opus_alloc'

          LINK : warning LNK4217: symbol '_malloc' defined in 'libucrt.lib(malloc.obj)' is imported by 'libmagnum_opus-543c189f8b942366.rlib(opus_decoder.c.obj)' in function '_opus_decode_frame'

          LINK : warning LNK4286: symbol '_malloc' defined in 'libucrt.lib(malloc.obj)' is imported by 'libmagnum_opus-543c189f8b942366.rlib(repacketizer.c.obj)'

          MSVCRT.lib(chandler4gs.obj) : error LNK2019: unresolved external symbol __except_handler4_common referenced in function __except_handler4

          D:\a\rustdesk\rustdesk\target\release\deps\librustdesk.dll : fatal error LNK1120: 1 unresolved externals

```
----------------------------------------

PR #9091: fix: crash, drop tokio RunTime in async context (Wayland)
Author: fufesou
Merged at: 2024-08-16 06:55:43+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9091
Description:
https://github.com/rustdesk/rustdesk/issues/9051

## Reproduce steps

1. Enable selinux.
2. Do not config RustDesk selinux policies.
3. Start rustdesk service. The `--server` process will not be started.
4. Start rustdesk client.

## Desc

> This happens when a runtime is dropped from within an asynchronous context.


1. `setup_uinput()` is called. `UInputKeyboard` and `UInputMouse` contains `Runtime`.
https://github.com/rustdesk/rustdesk/blob/ed18e3c7860edca81d07794773bd86ea51e14e18/src/server/input_service.rs#L519

https://github.com/rustdesk/rustdesk/blob/ed18e3c7860edca81d07794773bd86ea51e14e18/src/server/uinput.rs#L30

2. `setup_rdp_input()` is called. The previous added `UInputKeyboard` and `UInputMouse` instances are dropped.
https://github.com/rustdesk/rustdesk/blob/ed18e3c7860edca81d07794773bd86ea51e14e18/src/server/input_service.rs#L500

So we need to avoid dropping the `Runtime` within an asynchronous context.

## Tests

- [x]  Pure client
- [x] Enable selinux, start service and client.
- [x]  Disable selinux (or add selinux policies), start service.

----------------------------------------

PR #9093: Update Italian language
Author: bovirus
Merged at: 2024-08-16 10:39:36+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9093
Description:
@rustdesk 

Please merge. Thanks.
----------------------------------------

PR #9089: file rename
Author: 21pages
Merged at: 2024-08-16 04:55:58+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9089
Description:
https://github.com/rustdesk/rustdesk/discussions/7758#discussioncomment-10234568

1. Rename file or directoy of local or remote. 
* validate filename
* show log in cm
* mobile menu is added in more dropdown
* tested Linux/Windows/Mac/Andriod
2. Desktop icon tooltips.

[file_rename_linux_android.webm](https://github.com/user-attachments/assets/c233174d-6651-4428-ac16-da404875f9d0)

https://github.com/user-attachments/assets/1347cdca-a291-4beb-981e-aac0c1bc3464


[file_name_validate.webm](https://github.com/user-attachments/assets/3562fe86-1491-4aeb-9924-3bb1f7299e76)

 
[file_manager_tooltips.webm](https://github.com/user-attachments/assets/e5c3b8f9-87c7-437b-afa1-59712e50955a)

![1723783399533](https://github.com/user-attachments/assets/9e2164ed-dee8-48a2-882c-186764899399)

----------------------------------------

PR #9081: fix: resize top edge
Author: fufesou
Merged at: 2024-08-15 15:58:19+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9081
Description:
## Preview

### Bug

https://github.com/user-attachments/assets/b5e84e57-5067-4ecc-a1d3-ab1ab21f7e84

### Fixed


https://github.com/user-attachments/assets/e92910b5-41fc-41d2-832e-dd52b70e96e6


#### System window


https://github.com/user-attachments/assets/4a293180-7319-425f-956b-4e014a8e7818



## Desc

On Windows, only the top and corner resize edges are set.

### More

The sizing border of a window (in black) are the red rectangles.

![image](https://github.com/user-attachments/assets/f9c095fb-09a9-4a8b-99f6-cfad6eef243f)

### window manager

Run window manager's default example, change the following three lines. Monitor scale is 150%.

https://github.com/rustdesk-org/window_manager/blob/f19acdb008645366339444a359a45c3257c8b32e/windows/window_manager_plugin.cpp#L154

```c++
      sz->rgrc[0].right -= 8;
      sz->rgrc[0].bottom -= 8;
      sz->rgrc[0].left -= -8;
```

1. Change the values to 0.

<img width="155" alt="1723734509761" src="https://github.com/user-attachments/assets/d22c7d19-e77c-40da-b6e6-b1d4b2c0213a">

2. Change the values to 11. (11 -> scale 150%, 8 -> scale 100%)

<img width="200" alt="1723734665214" src="https://github.com/user-attachments/assets/7262907c-04d6-4421-a57c-be107468a1d4">


3. Change the values to 200.

<img width="219" alt="1723734599214" src="https://github.com/user-attachments/assets/a9731ee7-380a-419c-9c08-cdd05e5b02ff">


We can see that the window has an 11-pixel transparent area for resizing.

#### TODO

We need to query and set a better value based on the current monitor scale.

1. Window manager and multi desktop window.
2. `kWindowResizeEdgeSize` for top edge in RustDesk.

## Tests

- [x] Compare to the system window
- [x] Do no affect the cursor in remote window
- [x] Fullscreen
- [x] Move cursor in/out window, trigger resizing


## Refs and useful links

1. https://learn.microsoft.com/en-us/windows/win32/winmsg/window-styles
3. https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-getsystemmetrics
6. https://learn.microsoft.com/en-us/windows/win32/api/dwmapi/nf-dwmapi-dwmgetwindowattribute

----------------------------------------

PR #9075: Update cs.rs: more corrections, new phrases translated
Author: kibeb
Merged at: 2024-08-15 09:34:39+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9075
Description:
Thanks.
----------------------------------------

PR #9074: Update cs.rs: typo corrected
Author: kibeb
Merged at: 2024-08-15 06:55:44+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9074
Description:
Thanks.
----------------------------------------

PR #9073: only main window show tabbar border, change cm tabbar color
Author: 21pages
Merged at: 2024-08-15 05:25:59+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9073
Description:
![dark](https://github.com/user-attachments/assets/6bcae2ea-5506-440d-9cc4-f5996d3c4a85)
![light](https://github.com/user-attachments/assets/61c51f04-afb6-47e0-9666-3b155de4d56d)

----------------------------------------

PR #9062: fix: windows, remote window, resizing
Author: fufesou
Merged at: 2024-08-15 05:24:42+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9062
Description:
https://github.com/rustdesk/rustdesk/discussions/9061


https://github.com/user-attachments/assets/ac7ff458-b823-445d-ab35-ef604766762b


# Tests

https://github.com/rustdesk/rustdesk/discussions/9063#discussioncomment-10338875

## Single monitor

- [x] "Minimize, Restore/Maximize, Close" buttons.
  - [x] Main window
  - [x] Remote window
- [x] Window edges, normal, maximized, fullscreen.  Whether the edges can be shown.
  - [x] Main window
  - [x] Remote window

- [x] Resizing
  - [x] Main window
  - [x] Remote window
  - [x] Corner resize
  - [x] Edge resize

- [x] Show all contents, without crops. Remote window, normal, maximized, fullscreen.


## Multiple monitors

- [x] Different arrangements.

- [x] Different main display.
  - [x] Display 1 as main display
  - [x] Display 2 as main display
  - [x] Display 3 as main display

- [x] Different scale on some monitors.
  - [x] Display 1 (100), Display 2 (150), Display 3(200)
  - [x] Display 1 (150), Display 2 (120), Display 3(100)

## Note

1. **The experience of resizing through the top edge is not good**.  History issue.


https://github.com/user-attachments/assets/b5e84e57-5067-4ecc-a1d3-ab1ab21f7e84



----------------------------------------

PR #9069: fix get_custom_server_from_string, `relay=` is not used
Author: 21pages
Merged at: 2024-08-15 01:57:12+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9069
Description:
![1723685775820](https://github.com/user-attachments/assets/6145842b-33cb-49fc-b144-d2aebd161057)

----------------------------------------

PR #9067: Update ko.rs
Author: jkh0kr
Merged at: 2024-08-15 01:25:04+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9067
Description:
Additional Korean translations
----------------------------------------

PR #9064: Translation correction
Author: flusheDData
Merged at: 2024-08-15 01:24:42+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9064
Description:
Version had a quote before the term
----------------------------------------

PR #9058: fix wallpaper get sid
Author: 21pages
Merged at: 2024-08-14 10:09:47+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9058
Description:
https://github.com/rustdesk/rustdesk/discussions/9053#discussioncomment-10335445
----------------------------------------

PR #9054: Update de.rs
Author: Mr-Update
Merged at: 2024-08-14 02:39:05+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9054
Description:
None
----------------------------------------

PR #9047: Update Italian language
Author: bovirus
Merged at: 2024-08-13 06:22:08+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9047
Description:
@rustdesk 

Please merge. Thanks.
----------------------------------------

PR #9045: Update es.rs
Author: flusheDData
Merged at: 2024-08-13 06:11:36+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9045
Description:
New translations
----------------------------------------

PR #9043: fix: remove dup translation
Author: fufesou
Merged at: 2024-08-13 03:27:39+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9043
Description:
The translation of "Trust this device" is duplicated.
----------------------------------------

PR #9038: fix: win, multi monitors, maximize, may fix 9033
Author: fufesou
Merged at: 2024-08-12 16:18:35+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9038
Description:
https://github.com/rustdesk/rustdesk/issues/9033

https://github.com/rustdesk-org/rustdesk_desktop_multi_window/pull/21
----------------------------------------

PR #9035: android telebot setting
Author: 21pages
Merged at: 2024-08-12 14:20:35+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9035
Description:

https://github.com/user-attachments/assets/e4af5636-29c7-4c45-9b7a-74a31eeb72ca


----------------------------------------

PR #9036: fix: build
Author: fufesou
Merged at: 2024-08-12 14:16:00+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9036
Description:
None
----------------------------------------

PR #9034: fix: not plug virtual dislay, non win, installed
Author: fufesou
Merged at: 2024-08-12 13:53:41+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9034
Description:
Do not send message "plug in virtual display" if peer is not windows and installed.

The peer info is parsed in UI side, flutter and sicter (additional info ignored).

We can move  `send_toggle_virtual_display_msg()` to the flutter side.

But it may be better to do in rust side.


https://github.com/user-attachments/assets/a9d46363-e2de-43a3-855c-d65bfe887cf5


----------------------------------------

PR #9012: trust this device to skip 2fa
Author: 21pages
Merged at: 2024-08-12 10:08:33+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9012
Description:
https://github.com/rustdesk/rustdesk/discussions/8513#discussioncomment-10234494

**Steps of trust one device:**

* The controlled side enables 2FA and the "Enable trusted devices" option.
* The control side connects to the controlled side, after the password is verified, if `enable_trusted_devices` proto is true,  there will be a checkbox under the 2FA input field. If the checkbox is checked and the 2FA is correct, the digest of the control side's HWID will be stored on the controlled side, and the checkbox option will be remembered in the `trust-this-device` peer option, which defaults to false.
* In the next connection, if the `trust-this-device` peer option is true, the HWID digest will be sent in the login request, and if the digest is found in the trusted devices list, the 2FA verification will be skipped

**Details**

* Trusted devices will be cleared when:
  * the permanent password is changed.
  * 2FA is disabled.
* The entire trusted devices list is encrypted, because we don't want the expiration time to be modified manually. The maximum size is 1MB, which is enough to store several thousand trusted devices.
* The expiration time is 90 days, and outdated items are removed when the trusted devices are read or set.
* The `enable_trusted_devices` proto is only set when the login error is `REQUIRE_2FA`, which can save network payload.
* In addition to HWID, the ID, platform, and name are also compared.
* When 2FA dialog is shown, the `trust-this-device peer` option is set to false. If the checkbox is selected, the `trust-this-device` peer option is set to true.

**Sciter**
* Sciter doesn't add `Enable trusted devices` option, only because `Manage trusted devices` dialog is not written, but sciter has grid example. I will add it to sciter and add bot to mobile and sciter.

**Test**
* Windows/Linux/Macos/Android

https://github.com/user-attachments/assets/30c93524-0d1d-4944-97d9-0836c99f2c4b


https://github.com/user-attachments/assets/917afd49-a233-4a8a-9824-7f46b4ac658c


https://github.com/user-attachments/assets/c891cd09-bff2-481e-bef4-640c71aba812


----------------------------------------

PR #9031: Update ptbr.rs
Author: Xp96
Merged at: 2024-08-12 09:22:00+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9031
Description:
None
----------------------------------------

PR #9027: fix: privacy mode 2, resolution changed
Author: fufesou
Merged at: 2024-08-11 15:28:02+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9027
Description:
Try send `SwitchDisplay` message to the control side when privacy mode is changed.

Because if the resolution changes, the `H265` and `H264` decoder needs to be reset.

I'm not sure if there's a better solution because `VP8`, `VP9` and `AV1` do not requires reset at this point.

@21pages 

### Bug

https://github.com/user-attachments/assets/14ee21d7-c31f-4c36-b02a-d38f7630be4a

### Fixed

https://github.com/user-attachments/assets/f8e20f6b-a502-4eb3-8b03-2106f89a786f


----------------------------------------

PR #9023: fix: win, virtual display
Author: fufesou
Merged at: 2024-08-11 11:26:41+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9023
Description:
https://github.com/rustdesk/rustdesk/discussions/8044

## Preview

### Fix "No physical displays, no need to use the privacy mode."

May fix https://github.com/rustdesk/rustdesk/discussions/8994#discussioncomment-10300985

#### Bug


https://github.com/user-attachments/assets/9d55eae0-2a6e-4973-873b-79070f49b6f7


#### Fixed


https://github.com/user-attachments/assets/72310e89-f12c-438b-9319-4fdec05cf2f7


### Default resolution 1920x1080

https://github.com/user-attachments/assets/42c39a49-2439-41d1-a739-0d6014de3586

### Restore on conn & disconn

https://github.com/user-attachments/assets/8f9c033d-0cc3-405d-a55d-f6b280c04d3c

The options is stored in the peer's configuration.


```toml
[options]
virtual-display = ''
```

or

```toml
[options]
virtual-display = ',0,0'
```

## Desc

### Fix "No physical displays, no need to use the privacy mode."

The registry value is restored, but the settings in display settings is not refreshed if no virtual displays are plugged in/out.

We can manually trigger the refresh by the following call if no vitual displays are pluged in/out. 

![image](https://github.com/user-attachments/assets/7593bf55-b25d-445d-b5e5-2d64976b1d69)


### Default resolution 1920x1080

1. Move `mod reg_display_settings` from `src/privacy_mode/win_virtual_display.rs` to `src/platform/windows.rs`.
2. Spawn a new thread to check if the virtual display is plugged in for the first time.

![image](https://github.com/user-attachments/assets/ef4b7487-5a5a-4925-8d08-eae16ff81882)

![image](https://github.com/user-attachments/assets/a1bb6601-3457-48e2-b028-321798a8c041)

### Restore on conn & disconn

1. Save option.

![image](https://github.com/user-attachments/assets/f11a8753-9632-45d5-8104-ac7df23ecb2c)

2. Remove virtual displays on disconnection.

![image](https://github.com/user-attachments/assets/79b3a0dd-5328-42c9-933a-168d6b2df1a8)

3. Restore virtual displays.

![image](https://github.com/user-attachments/assets/317243c3-c016-4fd2-9fe4-2721384e1bf6)

**Note**:
1. Virtual displays are removed when the last connection is closed on the controlled side.  
If `A`,`B` -> `C`, `A` has one virtual display. Then `A` disconnect and connect, there will be two virtual displays on `C`.
Because `B` did not disconnect, `C` will not remove virtual displays. `A` will plug in one virtual display on conn.

We cannot control the display index to plug in with amyuni idd.

2. After all connections are closed, all virtual displays of amyuni idd will be deleted.




----------------------------------------

PR #9021: Update fa.rs
Author: mehdi-song
Merged at: 2024-08-10 22:49:34+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9021
Description:
None
----------------------------------------

PR #9016: Update Italian language
Author: bovirus
Merged at: 2024-08-10 12:52:27+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9016
Description:
@rustdesk 

Please merge. Thanks.
----------------------------------------

PR #9006: fix: multi-displays, displays changed, switch idx
Author: fufesou
Merged at: 2024-08-09 13:17:06+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9006
Description:
https://github.com/rustdesk/rustdesk/discussions/8994

Use init display index as the primary index.

But when displays are changed, the primary display may also change.

No need to change the old primary index.
But we need to make sure that the old primary index does not exceed the display number. New conditions is added `pi.primaryDisplay >= pi.displays.length`.

### Reproduce steps

Windows/Linux/MacOS -> Win10/Win11

1. Controlled side, multiple displays, set main display to number other than `1`. Eg: `2`.
2. Control side, connect. Set primay display index to the second display.
3. Control side, turn on "Privacy mode 2".
4. Controlled side, plug in virtual display, turn off all physical displays.
5. The control end receives new screen display information, but only receives one screen display. However, the main screen display index is still the second one, which makes the current screen display index invalid.
----------------------------------------

PR #9004: Update de.rs
Author: Mr-Update
Merged at: 2024-08-09 00:43:18+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9004
Description:
None
----------------------------------------

PR #8997: Update ca.rs
Author: ivanbea
Merged at: 2024-08-08 15:18:01+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8997
Description:
update catalan translation
----------------------------------------

PR #9002: fix: update pub desktop_multi_window
Author: fufesou
Merged at: 2024-08-08 15:06:33+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9002
Description:
fix https://github.com/rustdesk/rustdesk/issues/8979

The other update of `desktop_multi_window` will be in another PR.
----------------------------------------

PR #9001: Fix/exe upgrade options
Author: fufesou
Merged at: 2024-08-08 14:07:06+00:00
URL: https://github.com/rustdesk/rustdesk/pull/9001
Description:
1. Msi install options, swap shortcuts positions. "Start menu shortcuts" above "Desktop icon", the same to exe installler.
2. Stores registry values ​​for installation options, same as the msi installer.

![image](https://github.com/user-attachments/assets/d7e9cbee-bc10-4c4e-8aa4-6e9f0210459b)

Install, upgrade and uninstall are tested.

**Note**:
`--silent-install` is not changed, it will create both desktop icon and start menu shortcut on Windows.
Because adding arguments may break the previous command line. https://github.com/rustdesk/rustdesk/blob/049c334db325cfe3ed9d4d9eb3dc17d3ea7214cd/src/core_main.rs#L194

Please use msi for silent install without shortcuts.

I'll add another silent install command if we have to.

----------------------------------------

PR #8992: fix: privacy mode, windows vd, init resolution
Author: fufesou
Merged at: 2024-08-08 07:31:11+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8992
Description:
https://github.com/rustdesk/rustdesk/discussions/8946

Use resolution `1920x1080` for privacy mode 2.


![a](https://github.com/user-attachments/assets/aced9eea-16cf-4eb7-8d5d-bc84bd0f1935)


The resolution of control side is not used, since `DPI` also affects the display.

Maybe we can add the `DPI` setting in the future.

----------------------------------------

PR #8987: Update ru.rs
Author: solokot
Merged at: 2024-08-08 02:24:28+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8987
Description:
None
----------------------------------------

PR #8988: Update Italian language
Author: bovirus
Merged at: 2024-08-08 02:24:15+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8988
Description:
@rustdesk 

Please merge. Thanks.
----------------------------------------

PR #8932: Use correct locale code for Ukrainian translation file name
Author: xalt7x
Merged at: 2024-08-02 14:58:45+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8932
Description:
Rename Ukrainian translation file ua.rs to uk.rs to avoid confusion.    
This complements commits [2333ee2](https://github.com/rustdesk/rustdesk/commit/2333ee2c07c6a67ed6c58ccfbc50a3bee203f90d) and [b6035fb](https://github.com/21pages/rustdesk/commit/b6035fbbdfffb9d6a083e8754e786a8abaa3feaf) which fix issue [8293](https://github.com/rustdesk/rustdesk/issues/8923)
----------------------------------------

PR #8977: unlock with PIN
Author: 21pages
Merged at: 2024-08-07 08:21:38+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8977
Description:
* If not set, use admin password; if set, use custom unlock pin.
* At least 4 characters, encrypted.
* Set with gui or command line.
* Tested on win/mac/linux.


https://github.com/user-attachments/assets/a2c41b96-b591-4e61-a1ac-1f2cfcbf0c95



https://github.com/user-attachments/assets/4df65489-76f0-4384-b41a-d18f3c139d18



----------------------------------------

PR #8974: Update ko.rs
Author: jkh0kr
Merged at: 2024-08-07 02:12:43+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8974
Description:
Additional Korean translation
----------------------------------------

PR #8968: update sysinfo rlim_max, which causing debian 13 pkexec not work
Author: 21pages
Merged at: 2024-08-06 10:19:35+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8968
Description:
https://github.com/rustdesk/rustdesk/issues/8719


https://github.com/user-attachments/assets/89523fab-cb4a-4e7d-a2e2-cf62d4156a64


----------------------------------------

PR #8965: refact: audio input, combobox instead of radio
Author: fufesou
Merged at: 2024-08-06 09:07:05+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8965
Description:

https://github.com/user-attachments/assets/39521e73-3d7e-4132-84fd-ee81460ab575


----------------------------------------

PR #8964: fix build
Author: 21pages
Merged at: 2024-08-06 04:36:39+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8964
Description:
None
----------------------------------------

PR #8961: fix: reset voice call state, on conn
Author: fufesou
Merged at: 2024-08-05 16:28:31+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8961
Description:

### Bug

https://github.com/user-attachments/assets/21eb810b-685a-448f-a683-0cc1b0ba1aca

### Fixed

https://github.com/user-attachments/assets/1165d971-d1f0-4d8d-a6b4-158113daafad


----------------------------------------

PR #8949: Refact/msi more install options
Author: fufesou
Merged at: 2024-08-05 09:49:48+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8949
Description:
1. Fix silent repair/upgrade error. `msiexec /i package.msi /qn` will cause incomplete installation.   
On other computers, this issue may even result in two versions, `1.3.0.1` and `1.3.0.2`, coexisting. The only workaround before the repair was to avoid "repair/upgrade" and instead just uninstall and then install.

https://github.com/user-attachments/assets/a356eb4f-300d-4051-9be6-980ad53a3866


https://github.com/user-attachments/assets/2537af4e-1ffc-4623-a534-af6e6f2b8dff


2. Add install options.

https://github.com/rustdesk/rustdesk/discussions/8829

https://github.com/user-attachments/assets/847d2851-3eba-41eb-9bf4-a23130deb2ae



https://github.com/user-attachments/assets/a04e5c86-8a84-4b14-99d2-054721e6c7a6




The options `CREATESTARTMENUSHORTCUTS` and `CREATEDESKTOPSHORTCUTS` support `1/0` or `Y/N`.

```
msiexec /i Package.msi /qn INSTALLFOLDER="D:\Program Files\RustDesk" CREATESTARTMENUSHORTCUTS="0" CREATEDESKTOPSHORTCUTS="1" /l*v install.log

msiexec /i Package.msi /qn INSTALLFOLDER="D:\Program Files\RustDesk" CREATESTARTMENUSHORTCUTS="N" CREATEDESKTOPSHORTCUTS="Y" /l*v install.log
```

**Priority:** 
```
UI (command line) > Previous options (registry values) -> Default values
```


----------------------------------------

PR #8943: Guard parameters for universal apk
Author: basilgello
Merged at: 2024-08-04 04:34:08+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8943
Description:
Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

----------------------------------------

PR #8947: set max audio buffer to 150ms, clear audio buffer if full
Author: 21pages
Merged at: 2024-08-04 08:11:00+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8947
Description:
The device should have the capability to play a sufficient audio buffer during each period to meet the audio config, so the playback speed is not slow.

The audio delay is caused by network jitter. The controlled  side sends audio data every 10ms, but it often happens that multiple packets are sent together. During underrun periods, the controlling side plays extra silence data instead, resulting in the device playing more audio than the configured amount.

50 ms buffer length will cause frequent clear, 150 ms is ok in test. 

Clear cause short silence rather than noise.

![70ab8e3b215a688a039275532c373bc](https://github.com/user-attachments/assets/e52db119-1a03-491c-a691-c0cdc14d97fd)

----------------------------------------

PR #8944: fix: custom client, msi, conn type
Author: fufesou
Merged at: 2024-08-03 14:29:30+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8944
Description:
Remove json param `--custom-client-props`, use `conn-type` instead.
----------------------------------------

PR #8942: Fix copy step for universal apk
Author: basilgello
Merged at: 2024-08-03 11:00:27+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8942
Description:
Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

----------------------------------------

PR #8941: Build universal apk
Author: basilgello
Merged at: 2024-08-03 10:39:12+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8941
Description:
Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

----------------------------------------

PR #8866: Update trs
Author: jxdv
Merged at: 2024-07-28 09:13:15+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8866
Description:
None
----------------------------------------

PR #8921: Update Ukrainian translation
Author: xalt7x
Merged at: 2024-08-02 01:31:38+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8921
Description:
None
----------------------------------------

PR #8930: fix: clipboard cm ipc data, raw bytes
Author: fufesou
Merged at: 2024-08-02 13:36:49+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8930
Description:
None
----------------------------------------

PR #8926: vcpkg deps
Author: basilgello
Merged at: 2024-08-02 10:43:30+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8926
Description:
- **vcpkg: bump opus to 1.5.2**
- **vcpkg: actually use cached artifacts**
- **Print all vcpkg log files on errors**

----------------------------------------

PR #8907: flutter-buid: Parameterize Android builds for easier debug release switch in mirror repos
Author: basilgello
Merged at: 2024-07-31 12:38:00+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8907
Description:
None
----------------------------------------

PR #8925: update supportedLocales
Author: 21pages
Merged at: 2024-08-02 07:12:48+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8925
Description:
https://github.com/rustdesk/rustdesk/issues/8923#issuecomment-2264673115
----------------------------------------

PR #8918: Bump Android NDK to r27
Author: basilgello
Merged at: 2024-08-01 13:33:59+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8918
Description:
Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

----------------------------------------

PR #8917: fix click cm audio permission button before auth
Author: 21pages
Merged at: 2024-08-01 10:17:02+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8917
Description:
1. When not authenticated, clicking the audio permission button on the cm will send audio data
2. Keep the cursor position code unchanged, because `show_remote_cursor` is false before auth, so subscription will not happen.
3. Keep the clipboard code unchanged, because the keyboard permission will also be determined in `try_sub_services`. If the clipboard permission is clicked before auth and the keyboard permission is clicked after auth, the clipboard service will not be subscribed.
----------------------------------------

PR #8914: Fix typo in RD copy lib step
Author: basilgello
Merged at: 2024-08-01 07:09:33+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8914
Description:
None
----------------------------------------

PR #8913: refact: msi, custom client props
Author: fufesou
Merged at: 2024-08-01 07:08:52+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8913
Description:
https://github.com/rustdesk/rustdesk-server-pro/issues/339


### Tests

No service is created.

```shell
python preprocess.py --arp -d ../../libs/portable/rustdesk --app-name test1 --custom-client-props '{"connection-type": "outgoing"}'
```

Service is created.

```shell
python preprocess.py --arp -d ../../libs/portable/rustdesk --app-name test1

python preprocess.py --arp -d ../../libs/portable/rustdesk --app-name test1 --custom-client-props '{"connection-type": "incoming"}'
```


----------------------------------------

PR #8912: fix: usage of `actions/checkout@v3`
Author: hamirmahal
Merged at: 2024-08-01 01:12:11+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8912
Description:
CI uses `actions/checkout@v3`, which uses a `deprecated` version of `Node.js`.

This pull request fixes that.
----------------------------------------

PR #8905: update repo to rustdesk-org
Author: 21pages
Merged at: 2024-07-31 09:25:11+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8905
Description:
None
----------------------------------------

PR #8901: Update ru.rs
Author: solokot
Merged at: 2024-07-31 06:16:55+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8901
Description:
None
----------------------------------------

PR #8890: add libatomic1 to linux armv7 sciter depends (libsciter-gtk.so was not found)
Author: 21pages
Merged at: 2024-07-30 06:52:06+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8890
Description:

tested with arm32v7/debian container

![image](https://github.com/user-attachments/assets/5f67bbaf-5da8-4415-a5fc-9f37b456ff27)

![image](https://github.com/user-attachments/assets/d985da28-ccac-4deb-8660-3cb7314eb35c)

----------------------------------------

PR #8888: Refact: simple changes
Author: fufesou
Merged at: 2024-07-30 05:06:37+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8888
Description:
None
----------------------------------------

PR #8885: fix: clipboard, windows, controlled side, formats
Author: fufesou
Merged at: 2024-07-30 03:35:39+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8885
Description:
Get clipboard contents from cm though ipc on Windows "--server", fallback directly get clipboard formats.

![image](https://github.com/user-attachments/assets/02d62a1f-89ec-4fed-9cea-8e74e0bf7d68)

#### Note

`1024*3` is used as the threshold to send raw in ipc for now. Maybe there's a better value.

![image](https://github.com/user-attachments/assets/80926021-5780-4386-8226-65dafd7eb9d8)


### Preview


https://github.com/user-attachments/assets/6b624251-0071-4f38-997d-fb6331bed1e8


https://github.com/user-attachments/assets/249cba58-4088-4e37-9eb3-aaacc32131e2


https://github.com/user-attachments/assets/339b418a-aa41-4d9f-a145-c2adc8a85be3

https://github.com/user-attachments/assets/13464dbc-bbdb-45dd-93af-b0792e04da89





----------------------------------------

PR #8886: Fix typo on ja.rs
Author: generalworksinc
Merged at: 2024-07-29 16:27:28+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8886
Description:
"Strong" is correctly translated as "強力" in Japanese.
"協力" means "Cooperation".
----------------------------------------

PR #8881: fix: clipboard, read as much as possible
Author: fufesou
Merged at: 2024-07-29 13:19:30+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8881
Description:
https://github.com/rustdesk-org/arboard/pull/9

Read clibpard formats, ignore errors, to read as much formats as possible.

Because sometimes reading plain text is ok, but not the other formats. (on Windows). Maybe it depend on the system settings.


----------------------------------------

PR #8873: fix: clipboard, set formats and enable option
Author: fufesou
Merged at: 2024-07-29 07:40:02+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8873
Description:
1. Fix `update_text_clipboard_required()`, because it depends on `server_keyboard_enabled`

![image](https://github.com/user-attachments/assets/7f7aaed5-c215-467d-ace1-7dc21768cf35)

2. Fix set formats on Linux. Use a global variable to hold current clipboard content. Although it is currently possible to set the pasteboard under Linux, it is not correct.

![image](https://github.com/user-attachments/assets/9107d5c2-7be1-425e-81da-cbbfb268756a)

----------------------------------------

PR #8877: Update tw.rs and cn.rs
Author: xlionjuan
Merged at: 2024-07-29 07:34:26+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8877
Description:
None
----------------------------------------

PR #8870: Update de.rs
Author: Mr-Update
Merged at: 2024-07-28 13:09:37+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8870
Description:
None
----------------------------------------

PR #8868: Refact: update file clipboard doc images 
Author: fufesou
Merged at: 2024-07-28 11:33:00+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8868
Description:
None
----------------------------------------

PR #8836: refact: embed crate mouce, uinput
Author: fufesou
Merged at: 2024-07-28 09:27:09+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8836
Description:

https://github.com/user-attachments/assets/1910c932-f36e-4e1e-a739-482daefa0168


----------------------------------------

PR #8733: feat: clipboard, multi formats
Author: fufesou
Merged at: 2024-07-28 09:26:54+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8733
Description:
Support multi clipboard formats.

Update crates `arboard` and `clipboard-master`.

## Changes

1. Bump to `1.3.0`, to distinguish the nightly(`1.2.7`) . Since clipboard use the RustDesk version to decide message to send.
2. Support `text`, `rtf`, `html`, `png`, `svg` .
3. Refact clipboard service, from `repeat()` to `run()`.
4. Send clipboard data array when `1.3.0` -> `1.3.0`.  
  Send text clipboard data when `1.3.0` -> `1.2.6`.  
  Send text clibpoard if the peer side is mobile.  

    So I introduced a new filed `my_platform`  in `LoginRequest` to check if peer is mobile.

5. Use a special format `dyn.com.rustdesk.owner` to indicate current clipboard data is set by RustDesk.  

    **Note**: The special format **must not** be used by other applications. Or we cannot check if the data is set by RustDesk. Or RustDesk may skip the clipboard data when checking if should send.
 
6. Remove **`OLD_CLIPBOARD_DATA`**.   Fix https://github.com/rustdesk/rustdesk/issues/7321
   We can send the clipboard data everytime when the clipboard is updated.
   We need to check the `dyn.com.rustdesk.owner` format to know if current clipboard data should be ignored.

7. There're many deletions in `Cargo.lock` because `resvg` is removed in `arboard`. 
8. Clipboard only sync contents from the control side to the controlled side, like mstsc.


## Preview


https://github.com/user-attachments/assets/84b032f8-ca9b-41b4-9568-e16b6bd15362


## Tests

| no | control side | controlled side | result    |
|:------:|:------:|:------:|:------:|
|   1   |   Windows   |   MacOS   |  ✅  |
|   2   |   Windows   |   Linux X11   | ✅   |
|   3   |   Windows   |   Linux Wayland   |  ✅  |
|   4   |   MacOS   |   Windows   |  ✅  |
|   5   |   MacOS   |   Linux X11   |  ✅  |
|   6   |   MacOS   |   Linux  Wayland  |  ✅  |
|   7   |   Linux X11   |   Windows   |  ✅  |
|   8   |   Linux X11  |   MacOS   |  ✅  |
|   9   |   Linux Wayland   |   Windows   |  ✅  |
|   10   |   Linux Wayland  |   MacOS   |  ✅  |
|   11  |   Windows   |   Android   |  ✅  |
|   12   |   Android   |   Windows   |  ✅  |
|   13   |   1.3.0   |   1.2.6   |  ✅  |
|   14   |   1.2.6   |   1.3.0   |  ✅  |

Initial clipboard synchronization between 1.3.0 and 1.2.6 is not stable.

----------------------------------------

PR #8867: refact: update crate tfc
Author: fufesou
Merged at: 2024-07-28 09:26:18+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8867
Description:
Win (fr-FR) -> Win,Linux,MacOS (en-US), map mode and translate mode are tested.
Normal keys, `Shift` + Others, Dead keys (`AltGr` + Others), Accet (`AltGr` + `7` + `e`) are tested.


### NOTE

The latest commit of https://github.com/rustdesk-org/The-Fat-Controller/commits/history/rebase_upstream_20240722 is not used
, because `is_aligned()` is not stable for rust `1.75`.

![image](https://github.com/user-attachments/assets/0ab28268-b6e0-451a-9ef9-fa15a5808785)



----------------------------------------

PR #8863: Update Italian language
Author: bovirus
Merged at: 2024-07-28 09:13:02+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8863
Description:
@rustdesk 

Please merge. Thanks.
----------------------------------------

PR #8862: use selectableText for some errors
Author: 21pages
Merged at: 2024-07-28 03:13:19+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8862
Description:
![rustdesk_7B0ENROQBJ](https://github.com/user-attachments/assets/b383b11a-06ae-4a3a-a54f-d3796a4ba57e)
![rustdesk_9GAZ2cXjYd](https://github.com/user-attachments/assets/97397a76-1dc5-41cc-9719-f97b04445555)
![rustdesk_5kL77OOsFw](https://github.com/user-attachments/assets/a3f1b800-201e-4912-96c8-ea03ab9b2606)

----------------------------------------

PR #8859: Use VCPKG_FORCE_SYSTEM_BINARIES in actual RD sciter build step
Author: basilgello
Merged at: 2024-07-28 00:44:16+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8859
Description:
Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

----------------------------------------

PR #8857: Try to detach /opt/artifacts from sciter
Author: basilgello
Merged at: 2024-07-27 15:57:53+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8857
Description:
Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

----------------------------------------

PR #8849: remove calling refreshCurrentUser when connect status become ready
Author: 21pages
Merged at: 2024-07-28 02:15:09+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8849
Description:
When refreshCurrentUser throw error, show check network in ab and group tab.

When network error occurs on refreshCurrentUser.

retry:

https://github.com/user-attachments/assets/c271fed8-4560-4fd0-a3b7-72ca330109e5

logout login without normal network

https://github.com/user-attachments/assets/08ff367d-ac34-405b-b7cc-4bb3e9de96bc

logout login with normal network 

https://github.com/user-attachments/assets/26abc740-b462-4822-a512-65291571106b

change server

https://github.com/user-attachments/assets/2371b8bf-1ff4-4bb7-83a2-48e9fbd29f23


----------------------------------------

PR #8855: Add built CMake to PATH in actual RD build step
Author: basilgello
Merged at: 2024-07-27 13:28:34+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8855
Description:
Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

----------------------------------------

PR #8850: Try to fix sciter-armhf build
Author: basilgello
Merged at: 2024-07-27 07:32:27+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8850
Description:
* Bootstrap CMake 3.29.7 for ubuntu/bionic/armhf

* vcpkg executable now needs GCC 8 but all product binaries are still OK with GCC 7

* Remove res/vcpkg/linux.cmake

This change needs https://github.com/basilgello/cmake to be transferred to https://github.com/rustdesk-org

----------------------------------------

PR #8852: Limit cmake buildstep to 1 threads to check OOM
Author: basilgello
Merged at: 2024-07-27 08:29:53+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8852
Description:
Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

----------------------------------------

PR #8848: avoid call refreshCurrentUser twice at startup
Author: 21pages
Merged at: 2024-07-27 01:50:06+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8848
Description:
refreshCurrentUser will be called at these 2 position:

1. runMainApp or runMobileApp in main.dart
2. when connect status is ready

Both of these two happens at startup, when connect status is ready and startup time < 5 seconds, not call refreshCurrentUser
----------------------------------------

PR #8842: tab border for desktop subwindow
Author: 21pages
Merged at: 2024-07-26 03:20:16+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8842
Description:

![image](https://github.com/user-attachments/assets/f41ff25b-e452-4ceb-b6bb-4bbbf6446674)


![1721963844752](https://github.com/user-attachments/assets/8fdf84bd-49cc-4018-a2d1-727551cf1ffd)

----------------------------------------

PR #8839: fix: remove getRadio todo and delete  contentPadding param
Author: zuiyu1998
Merged at: 2024-07-26 02:31:01+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8839
Description:
None
----------------------------------------

PR #8838: Update Italian language
Author: bovirus
Merged at: 2024-07-26 02:00:18+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8838
Description:
@rustdesk 

Please merge. Thanks.
----------------------------------------

PR #8804: Remove existing /opt/artifacts/vcpkg in sciter builds
Author: basilgello
Merged at: 2024-07-24 03:23:49+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8804
Description:
Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

----------------------------------------

PR #8834: fix: keep window pos after new conn
Author: fufesou
Merged at: 2024-07-25 13:52:57+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8834
Description:
https://github.com/rustdesk/rustdesk/discussions/8825

1. Keep window pos.  Check current session count before restore window postion.

<img width="595" alt="1721915528830" src="https://github.com/user-attachments/assets/7ecaa088-2efb-455d-bde0-7ffb918a1f36">


2. Do some init in StatefulWidget constructor. If try init in its `State` class, it may be too late. Because I see the init function is called after building the widget tree sometimes.


https://github.com/user-attachments/assets/c6e411a0-aea0-44b3-b814-2e43c2af5689



```
══╡ EXCEPTION CAUGHT BY WIDGETS LIBRARY ╞═══════════════════════════════════════════════════════════
The following message was thrown building Obx(has builder, dirty, state: ObxState#1fda9):
"RxString" not found. You need to call "Get.put(RxString())" or "Get.lazyPut(()=>RxString())"

The relevant error-causing widget was:
  Obx Obx:file:///D:/Projects/rust/rustdesk/flutter/lib/desktop/pages/remote_tab_page.dart:133:54

When the exception was thrown, this was the stack:
#0      GetInstance.find (package:get/get_instance/src/get_instance.dart:306:7)
#1      Inst.find (package:get/get_instance/src/extension_instance.dart:69:45)
#2      FingerprintState.find (package:flutter_hbb/common/shared_state.dart:145:42)
#3      _ConnectionTabPageState.build.<anonymous closure>.<anonymous closure>
(package:flutter_hbb/desktop/pages/remote_tab_page.dart:159:48)
```

### Bug


https://github.com/user-attachments/assets/0e5f474b-71b4-4c4e-b50b-b0575a1445c8



### Fixed



https://github.com/user-attachments/assets/b1d80ede-3612-41c3-92e9-fc5f21f50132


----------------------------------------

PR #8827: fix: trackpad, reverse horizontal scroll
Author: dignow
Merged at: 2024-07-25 06:44:58+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8827
Description:
1. Reverse mouse wheel besides trackpad.
2. Reverse horizontal scroll. Use Windows as the controlled side is changed. Linux and MacOS works find as the controlled side.  
    Only trackpad is tested.  
    Mouse is not tested. But according to https://github.com/rustdesk/rustdesk/issues/1169 and https://github.com/rustdesk/rustdesk/pull/8806.  Mouse is also reversed.
----------------------------------------

PR #8817: refact: init values from initState to Constractor
Author: dignow
Merged at: 2024-07-25 02:45:51+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8817
Description:
1. Move some initializations from `initState` to the `Constractor`
2. Unbind global varibals with `bind.`
----------------------------------------

PR #8820: fix: mobile, conn page, jump on exiting remote
Author: dignow
Merged at: 2024-07-24 16:43:14+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8820
Description:
The connection page jumps after exiting the remote page.

Because it also exit fullscreen at that time.



----------------------------------------

PR #8819: fix: mobile, server page, jumps on loading
Author: dignow
Merged at: 2024-07-24 16:13:23+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8819
Description:
It's a little hard to record the issue. But it's easy to reproduce, just starting and stopping the service or swithcing pages.


https://github.com/user-attachments/assets/3f555451-e63f-4221-be3c-214c7a43cb43


----------------------------------------

PR #8815: fix: video service, do not skip refresh message
Author: dignow
Merged at: 2024-07-24 13:59:25+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8815
Description:
Revert `video_service`, remove `LAST_REFRESH_TIME`. Do not skip refresh message.

The code is not the same as commit `c04f460bbdd3a4d9deb2200d82ac1bcbc3d4c101`

https://github.com/dignow/rustdesk/blob/c04f460bbdd3a4d9deb2200d82ac1bcbc3d4c101/src/server/video_service.rs


----------------------------------------

PR #8812: fix: video service
Author: dignow
Merged at: 2024-07-24 10:41:52+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8812
Description:
1. Unset refresh flag if just refreshed.
2. Reduce the scope of the lock.
----------------------------------------

PR #8810: fix: siwtching display, clear last old image
Author: dignow
Merged at: 2024-07-24 09:35:07+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8810
Description:
### Bug

Uncheck option "Use texture rendering".

https://github.com/user-attachments/assets/9c4139df-dace-4841-87e0-8cdc806ad459



### Fixed



https://github.com/user-attachments/assets/b6569444-0101-461d-ab69-c0ae3910c486



### Changes

1. Clear last old image.
2. Try refresh after switching display.
3. Add an interval check before refresh video service.
----------------------------------------

PR #8809: fix more bool options
Author: 21pages
Merged at: 2024-07-24 09:20:58+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8809
Description:
* fix more bool options
* hide sort ab tags because it's already sorted
----------------------------------------

PR #8807: fix: flutter remove setState in initState
Author: dignow
Merged at: 2024-07-24 06:00:49+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8807
Description:
Flutter, remove setState() (include obx set value) in initState().

Or it may cause error like https://github.com/rustdesk/rustdesk/pull/8796 (Point 3).

**Note**:
1. No idea only the code in https://github.com/rustdesk/rustdesk/pull/8796 (Point 3)  `mobile` raise the error.
2. Maybe a better way for obx value is to set the value without adding the `GetStream`. But I cannot find the api.

----------------------------------------

PR #8792: fix nextRgba not called when switching to texture render
Author: 21pages
Merged at: 2024-07-24 04:06:17+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8792
Description:
Because rgba buffer render doesn't support multi display, when switch to multi display, it is possible that `rgba.valid` has been set to valid but `nextRgab` is not called, when switching back to single display, `rgba.valid` is still true.


`nextRgba` not called when switching to texture render.
![0b909f43d1e2a2782e72af066600d6a](https://github.com/user-attachments/assets/23f081c1-a10d-48ae-89ee-94d665e091b0)



It happens at the end of the video.

https://github.com/user-attachments/assets/9a6c605f-6a30-45c9-94ac-66dff91fc133


----------------------------------------

PR #8803: Fix arm32 sciter build
Author: basilgello
Merged at: 2024-07-24 02:16:25+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8803
Description:
Signed-off-by: Vasyl Gello <vasek.gello@gmail.com>

----------------------------------------

PR #8800: Update Italian language
Author: bovirus
Merged at: 2024-07-24 01:41:43+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8800
Description:
@rustdesk 

Please merge. Thanks.
----------------------------------------

PR #8801: Update de.rs
Author: Mr-Update
Merged at: 2024-07-24 01:41:25+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8801
Description:
None
----------------------------------------

PR #8764: vcpkg deps
Author: basilgello
Merged at: 2024-07-23 15:31:36+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8764
Description:
None
----------------------------------------

PR #8796: fix: mobile, query onlines, on active
Author: dignow
Merged at: 2024-07-23 15:28:03+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8796
Description:
1. Add `WidgetsBindingObserver` to detect if RustDesk is active, for querying online.
2. Always set last query peers in `_queryOnlines()` to avoid wrong check of `setEquals(_curPeers, _lastQueryPeers)` (`true`).
![image](https://github.com/user-attachments/assets/76e49d52-526b-4ed5-bba7-096fc3241b34)
3. Avoid error 
![image](https://github.com/user-attachments/assets/d8505f02-ebee-4ce6-acfb-63dfa001af5b)

```
the framework builds parent widgets before children, which means a dirty descendant will always be
built. Otherwise, the framework might not visit this widget during this build phase.
The widget on which setState() or markNeedsBuild() was called was:
  ObxValue<RxList<dynamic>>
The widget which was currently being built when the offending call was made was:
  Container

The relevant error-causing widget was:
  Container
  Container:file:///home/ubuntu/workspace/rust/rustdesk/flutter/lib/common/widgets/peer_tab_page.dart:117:18

When the exception was thrown, this was the stack:
#0      Element.markNeedsBuild.<anonymous closure> (package:flutter/src/widgets/framework.dart:5042:9)
#1      Element.markNeedsBuild (package:flutter/src/widgets/framework.dart:5054:6)
#2      State.setState (package:flutter/src/widgets/framework.dart:1223:15)
#3      ObxState._updateTree (package:get/get_state_manager/src/rx_flutter/rx_obx_widget.dart:43:7)
#4      GetStream._notifyData (package:get/get_rx/src/rx_stream/get_stream.dart:47:21)
#5      GetStream.add (package:get/get_rx/src/rx_stream/get_stream.dart:97:5)
#6      NotifyManager.addListener.<anonymous closure> (package:get/get_rx/src/rx_types/rx_core/rx_impl.dart:158:40)
#7      GetStream._notifyData (package:get/get_rx/src/rx_stream/get_stream.dart:47:21)
#8      GetStream.add (package:get/get_rx/src/rx_stream/get_stream.dart:97:5)
#9      RxObjectMixin.value= (package:get/get_rx/src/rx_types/rx_core/rx_impl.dart:105:13)
#10     _PeerSortDropdownState.initState (package:flutter_hbb/common/widgets/peer_tab_page.dart:877:22)
```
----------------------------------------

PR #8795: fix hide ab tag when custom client startup
Author: 21pages
Merged at: 2024-07-23 13:35:05+00:00
URL: https://github.com/rustdesk/rustdesk/pull/8795
Description:
https://github.com/rustdesk/rustdesk/discussions/8794

not custom: 'Y', ''
custom: 'Y', 'N'
should not use isNotEmpty
----------------------------------------


FILE CHANGES
--------------------------------------------------------------------------------

File: .cargo/config.toml
Status: modified
Changes: +7 -1
Diff:
@@ -1,8 +1,14 @@
 [target.x86_64-pc-windows-msvc]
 rustflags = ["-Ctarget-feature=+crt-static"]
 [target.i686-pc-windows-msvc]
-rustflags = ["-Ctarget-feature=+crt-static"]
+rustflags = ["-C", "target-feature=+crt-static", "-C", "link-args=/NODEFAULTLIB:MSVCRT"]
 [target.'cfg(target_os="macos")']
 rustflags = [
     "-C", "link-args=-sectcreate __CGPreLoginApp __cgpreloginapp /dev/null",
 ]

----------------------------------------

File: .github/workflows/ci.yml
Status: modified
Changes: +4 -2
Diff:
@@ -4,9 +4,9 @@ env:
 #   MIN_SUPPORTED_RUST_VERSION: "1.46.0"
 #   CICD_INTERMEDIATES_DIR: "_cicd-intermediates"
   VCPKG_BINARY_SOURCES: "clear;x-gha,readwrite"
-  # vcpkg version: 2023.10.19
+  # vcpkg version: 2024.06.15
   # for multiarch gcc compatibility
-  VCPKG_COMMIT_ID: "8eb57355a4ffb410a2e94c07b4dca2dffbee8e50"
+  VCPKG_COMMIT_ID: "f7423ee180c4b7f40d43402c2feb3859161ef625"
 

----------------------------------------

File: .github/workflows/fdroid.yml
Status: modified
Changes: +6 -1
Diff:
@@ -19,7 +19,12 @@ jobs:
     steps:
       - name: Generate RustDesk version file
         run: |
-          UPSTREAM_VERNAME="$(curl https://api.github.com/repos/rustdesk/rustdesk/releases/latest  | jq -r .tag_name | sed 's/^v//')"
+          if [ "${GITHUB_REF_TYPE}" = "tag" ]; then
+            UPSTREAM_VERNAME="${GITHUB_REF##refs/tags/}"
+            UPSTREAM_VERNAME="${UPSTREAM_VERNAME##v}"
+          else
+            UPSTREAM_VERNAME="$(curl https://api.github.com/repos/rustdesk/rustdesk/releases/latest  | jq -r .tag_name | sed 's/^v//')"

----------------------------------------

File: .github/workflows/flutter-build.yml
Status: modified
Changes: +442 -99
Diff:
@@ -18,9 +18,11 @@ on:
 # in this file!
 
 env:
-  WIN_RUST_VERSION: "1.75" # https://github.com/rustdesk/rustdesk/discussions/7503, also 1.78 has ABI change which causes our sciter version not working, https://blog.rust-lang.org/2024/03/30/i128-layout-update.html
+  SCITER_RUST_VERSION: "1.75" # https://github.com/rustdesk/rustdesk/discussions/7503, also 1.78 has ABI change which causes our sciter version not working, https://blog.rust-lang.org/2024/03/30/i128-layout-update.html
   RUST_VERSION: "1.75" # sciter failed on m1 with 1.78 because of https://blog.rust-lang.org/2024/03/30/i128-layout-update.html
   CARGO_NDK_VERSION: "3.1.2"
+  SCITER_ARMV7_CMAKE_VERSION: "3.29.7"
+  SCITER_NASM_DEBVERSION: "2.14-1"
   LLVM_VERSION: "15.0.6"
   FLUTTER_VERSION: "3.19.6"
   ANDROID_FLUTTER_VERSION: "3.13.9" # >= 3.16 is very slow on my android phone, but work well on most of others. We may switch to new flutter after changing to texture rendering (I believe it can solve my problem).
@@ -29,10 +31,10 @@ env:
   FLUTTER_ELINUX_VERSION: "3.16.9"
   TAG_NAME: "${{ inputs.upload-tag }}"
   VCPKG_BINARY_SOURCES: "clear;x-gha,readwrite"
-  # vcpkg version: 2024.06.15
-  VCPKG_COMMIT_ID: "f7423ee180c4b7f40d43402c2feb3859161ef625"
-  VERSION: "1.2.7"
-  NDK_VERSION: "r26d"
+  # vcpkg version: 2024.07.12
+  VCPKG_COMMIT_ID: "1de2026f28ead93ff1773e6e680387643e914ea1"
+  VERSION: "1.3.0"
+  NDK_VERSION: "r27"
   #signing keys env variable checks
   ANDROID_SIGNING_KEY: "${{ secrets.ANDROID_SIGNING_KEY }}"
   MACOS_P12_BASE64: "${{ secrets.MACOS_P12_BASE64 }}"
@@ -56,7 +58,7 @@ jobs:
       fail-fast: false
 
   build-for-windows-flutter:
-    name: ${{ matrix.job.target }} 
+    name: ${{ matrix.job.target }}
     needs: [build-RustDeskTempTopMostWindow]
     runs-on: ${{ matrix.job.os }}
     strategy:
@@ -65,7 +67,12 @@ jobs:
         job:
           # - { target: i686-pc-windows-msvc        , os: windows-2022                  }
           # - { target: x86_64-pc-windows-gnu       , os: windows-2022                  }
-          - { target: x86_64-pc-windows-msvc, os: windows-2022, arch: x86_64, vcpkg-triplet: x64-windows-static }
+          - {
+              target: x86_64-pc-windows-msvc,
+              os: windows-2022,
+              arch: x86_64,
+              vcpkg-triplet: x64-windows-static,
+            }
           # - { target: aarch64-pc-windows-msvc, os: windows-2022, arch: aarch64 }
     steps:
       - name: Export GitHub Actions cache environment variables
@@ -93,7 +100,7 @@ jobs:
       - name: Install Rust toolchain
         uses: dtolnay/rust-toolchain@v1
         with:
-          toolchain: ${{ env.WIN_RUST_VERSION }}
+          toolchain: ${{ env.SCITER_RUST_VERSION }}
           targets: ${{ matrix.job.target }}
           components: "rustfmt"
 
@@ -113,10 +120,25 @@ jobs:
         with:
           vcpkgDirectory: C:\vcpkg
           vcpkgGitCommitId: ${{ env.VCPKG_COMMIT_ID }}
+          doNotCache: false
 
       - name: Install vcpkg dependencies
+        env:
+          VCPKG_DEFAULT_HOST_TRIPLET: ${{ matrix.job.vcpkg-triplet }}
         run: |
-          $VCPKG_ROOT/vcpkg install --triplet ${{ matrix.job.vcpkg-triplet }} --x-install-root="$VCPKG_ROOT/installed"
+          if ! $VCPKG_ROOT/vcpkg \
+            install \
+            --triplet ${{ matrix.job.vcpkg-triplet }} \
+            --x-install-root="$VCPKG_ROOT/installed"; then
+            find "${VCPKG_ROOT}/" -name "*.log" | while read -r _1; do
+              echo "$_1:"
+              echo "======"
+              cat "$_1"
+              echo "======"
+              echo ""
+            done
+            exit 1
+          fi
         shell: bash
 
       - name: Build rustdesk
@@ -156,7 +178,7 @@ jobs:
         if: env.UPLOAD_ARTIFACT == 'true'
         uses: actions/upload-artifact@master
         with:
-          name: rustdesk-unsigned-windows-${{ matrix.job.arch }}         
+          name: rustdesk-unsigned-windows-${{ matrix.job.arch }}
           path: rustdesk
 
       - name: Sign rustdesk files
@@ -219,7 +241,12 @@ jobs:
         job:
           # - { target: i686-pc-windows-msvc        , os: windows-2022                  }
           # - { target: x86_64-pc-windows-gnu       , os: windows-2022                  }
-          - { target: i686-pc-windows-msvc, os: windows-2022, arch: x86, vcpkg-triplet: x86-windows-static }
+          - {
+              target: i686-pc-windows-msvc,
+              os: windows-2022,
+              arch: x86,
+              vcpkg-triplet: x86-windows-static,
+            }
           # - { target: aarch64-pc-windows-msvc, os: windows-2022 }
     steps:
       - name: Export GitHub Actions cache environment variables
@@ -230,7 +257,7 @@ jobs:
             core.exportVariable('ACTIONS_RUNTIME_TOKEN', process.env.ACTIONS_RUNTIME_TOKEN || '');
 
       - name: Checkout source code
-        uses: actions/checkout@v3
+        uses: actions/checkout@v4
 
       - name: Install LLVM and Clang
         uses: rustdesk-org/install-llvm-action-32bit@master
@@ -253,10 +280,25 @@ jobs:
         with:
           vcpkgDirectory: C:\vcpkg
           vcpkgGitCommitId: ${{ env.VCPKG_COMMIT_ID }}
+          doNotCache: false
 
       - name: Install vcpkg dependencies
+        env:
+          VCPKG_DEFAULT_HOST_TRIPLET: ${{ matrix.job.vcpkg-triplet }}
         run: |
-          $VCPKG_ROOT/vcpkg install --triplet ${{ matrix.job.vcpkg-triplet }} --x-install-root="$VCPKG_ROOT/installed"
+          if ! $VCPKG_ROOT/vcpkg \
+            install \
+            --triplet ${{ matrix.job.vcpkg-triplet }} \
+            --x-install-root="$VCPKG_ROOT/installed"; then
+            find "${VCPKG_ROOT}/" -name "*.log" | while read -r _1; do
+              echo "$_1:"
+              echo "======"
+              cat "$_1"
+              echo "======"
+              echo ""
+            done
+            exit 1
+          fi
         shell: bash
 
       - name: Build rustdesk
@@ -276,7 +318,7 @@ jobs:
           # Do not remove x64 files, because the user may run the 32bit version on a 64bit system.
           # Do not remove ./usbmmidd_v2/deviceinstaller64.exe, as x86 exe cannot install and uninstall drivers when running on x64,
           # we need the x64 exe to install and uninstall the driver.
-          rm -rf ./usbmmidd_v2/deviceinstaller.exe ./usbmmidd_v2/usbmmidd.bat 
+          rm -rf ./usbmmidd_v2/deviceinstaller.exe ./usbmmidd_v2/usbmmidd.bat
           mv ./usbmmidd_v2 ./Release || true
 
       - name: find Runner.res
@@ -341,7 +383,7 @@ jobs:
             core.exportVariable('ACTIONS_RUNTIME_TOKEN', process.env.ACTIONS_RUNTIME_TOKEN || '');
 
       - name: Checkout source code
-        uses: actions/checkout@v3
+        uses: actions/checkout@v4
 
       - name: Install flutter rust bridge deps
         shell: bash
@@ -424,9 +466,9 @@ jobs:
 
       - name: Install dependencies
         run: |
-          brew install nasm
+          brew install nasm yasm
       - name: Checkout source code
-        uses: actions/checkout@v3
+        uses: actions/checkout@v4
       - name: Install flutter
         uses: subosito/flutter-action@v2
         with:
@@ -437,10 +479,23 @@ jobs:
         uses: lukka/run-vcpkg@v11
         with:
           vcpkgGitCommitId: ${{ env.VCPKG_COMMIT_ID }}
+          doNotCache: false
 
       - name: Install vcpkg dependencies
         run: |
-          $VCPKG_ROOT/vcpkg install --triplet ${{ matrix.job.vcpkg-triplet }} --x-install-root="$VCPKG_ROOT/installed"
+          if ! $VCPKG_ROOT/vcpkg \
+            install \
+            --triplet ${{ matrix.job.vcpkg-triplet }} \
+            --x-install-root="$VCPKG_ROOT/installed"; then
+            find "${VCPKG_ROOT}/" -name "*.log" | while read -r _1; do
+              echo "$_1:"
+              echo "======"
+              cat "$_1"
+              echo "======"
+              echo ""
+            done
+            exit 1
+          fi
         shell: bash
 
       - name: Install Rust toolchain
@@ -506,7 +561,7 @@ jobs:
             core.exportVariable('ACTIONS_RUNTIME_TOKEN', process.env.ACTIONS_RUNTIME_TOKEN || '');
 
       - name: Checkout source code
-        uses: actions/checkout@v3
+        uses: actions/checkout@v4
 
       # $VCPKG_ROOT/vcpkg install --triplet arm64-ios --x-install-root="$VCPKG_ROOT/installed"
 
@@ -576,7 +631,7 @@ jobs:
             core.exportVariable('ACTIONS_RUNTIME_TOKEN', process.env.ACTIONS_RUNTIME_TOKEN || '');
 
       - name: Checkout source code
-        uses: actions/checkout@v3
+        uses: actions/checkout@v4
 
       - name: Import the codesign cert
         if: env.MACOS_P12_BASE64 != null
@@ -651,10 +706,22 @@ jobs:
         uses: lukka/run-vcpkg@v11
         with:
           vcpkgGitCommitId: ${{ env.VCPKG_COMMIT_ID }}
+          doNotCache: false
 
       - name: Install vcpkg dependencies
         run: |
-          $VCPKG_ROOT/vcpkg install --x-install-root="$VCPKG_ROOT/installed"
+          if ! $VCPKG_ROOT/vcpkg \
+            install \
+            --x-install-root="$VCPKG_ROOT/installed"; then
+            find "${VCPKG_ROOT}/" -name "*.log" | while read -r _1; do
+              echo "$_1:"
+              echo "======"
+              cat "$_1"
+              echo "======"
+              echo ""
+            done
+            exit 1
+          fi
 
       - name: Show version information (Rust, cargo, Clang)
         shell: bash
@@ -770,15 +837,35 @@ jobs:
               arch: aarch64,
               target: aarch64-linux-android,
               os: ubuntu-20.04,
-              openssl-arch: android-arm64,
+              reltype: release,
+              suffix: "",
             }
           - {
               arch: armv7,
               target: armv7-linux-androideabi,
               os: ubuntu-20.04,
-              openssl-arch: android-arm,
+              reltype: release,
+              suffix: "",
+            }
+          - {
+              arch: x86_64,
+              target: x86_64-linux-android,
+              os: ubuntu-20.04,
+              reltype: release,
+              suffix: "",
             }
     steps:
+      - name: Free Disk Space (Ubuntu)
+        uses: jlumbroso/free-disk-space@main
+        with:
+          tool-cache: false
+          android: false
+          dotnet: true
+          haskell: true
+          large-packages: false
+          docker-images: true
+          swap-storage: false
+
       - name: Export GitHub Actions cache environment variables
         uses: actions/github-script@v6
         with:
@@ -822,7 +909,7 @@ jobs:
                wget
 
       - name: Checkout source code
-        uses: actions/checkout@v3
+        uses: actions/checkout@v4
       - name: Install flutter
         uses: subosito/flutter-action@v2
         with:
@@ -839,17 +926,34 @@ jobs:
         with:
           vcpkgDirectory: /opt/artifacts/vcpkg
           vcpkgGitCommitId: ${{ env.VCPKG_COMMIT_ID }}
+          doNotCache: false
 
       - name: Install vcpkg dependencies
         run: |
           case ${{ matrix.job.target }} in

----------------------------------------

File: .github/workflows/playground.yml
Status: modified
Changes: +1 -1
Diff:
@@ -18,7 +18,7 @@ env:
   VCPKG_BINARY_SOURCES: "clear;x-gha,readwrite"
   # vcpkg version: 2024.06.15
   VCPKG_COMMIT_ID: "f7423ee180c4b7f40d43402c2feb3859161ef625"
-  VERSION: "1.2.7"
+  VERSION: "1.3.0"
   NDK_VERSION: "r26d"
   #signing keys env variable checks
   ANDROID_SIGNING_KEY: "${{ secrets.ANDROID_SIGNING_KEY }}"

----------------------------------------

File: Cargo.lock
Status: modified
Changes: +49 -314
Diff:
@@ -123,7 +123,7 @@ checksum = "e999941b234f3131b00bc13c22d06e8c5ff726d1b6318ac7eb276997bbb4fef0"
 [[package]]
 name = "android-wakelock"
 version = "0.1.0"
-source = "git+https://github.com/21pages/android-wakelock#d0292e5a367e627c4fa6f1ca6bdfad005dca7d90"
+source = "git+https://github.com/rustdesk-org/android-wakelock#d0292e5a367e627c4fa6f1ca6bdfad005dca7d90"
 dependencies = [
  "jni 0.21.1",
  "log",
@@ -224,7 +224,7 @@ checksum = "b3d1d046238990b9cf5bcde22a3fb3584ee5cf65fb2765f454ed428c7a0063da"
 [[package]]
 name = "arboard"
 version = "3.4.0"
-source = "git+https://github.com/rustdesk-org/arboard#27b4e503caa70ec6306e5270461429f2cf907ad6"
+source = "git+https://github.com/rustdesk-org/arboard#a04bdb1b368a99691822c33bf0f7ed497d6a7a35"
 dependencies = [
  "clipboard-win",
  "core-graphics 0.23.2",
@@ -234,24 +234,13 @@ dependencies = [
  "objc2-app-kit",
  "objc2-foundation",
  "parking_lot",
- "resvg",
+ "serde 1.0.203",
+ "serde_derive",
  "windows-sys 0.48.0",
  "wl-clipboard-rs",
  "x11rb 0.13.1",
 ]
 
-[[package]]
-name = "arrayref"
-version = "0.3.7"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "6b4930d2cb77ce62f89ee5d5289b4ac049559b1c45539271f5ed4fdc7db34545"
-
-[[package]]
-name = "arrayvec"
-version = "0.7.4"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "96d30a06541fbafbc7f82ed10c06164cfbd2c401138f6addd8404629c4b16711"
-
 [[package]]
 name = "async-broadcast"
 version = "0.5.1"
@@ -987,11 +976,14 @@ dependencies = [
 [[package]]
 name = "clipboard-master"
 version = "4.0.0-beta.6"
-source = "git+https://github.com/rustdesk-org/clipboard-master#5268c7b3d7728699566ad863da0911f249706f8c"
+source = "git+https://github.com/rustdesk-org/clipboard-master#4fb62e5b62fb6350d82b571ec7ba94b3cd466695"
 dependencies = [
  "objc",
  "objc-foundation",
  "objc_id",
+ "wayland-client",
+ "wayland-protocols",
+ "wayland-protocols-wlr",
  "windows-win",
  "wl-clipboard-rs",
  "x11-clipboard 0.9.2",
@@ -1000,9 +992,9 @@ dependencies = [
 
 [[package]]
 name = "clipboard-win"
-version = "5.3.1"
+version = "5.4.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "79f4473f5144e20d9aceaf2972478f06ddf687831eafeeb434fbaf0acc4144ad"
+checksum = "15efe7a882b08f34e38556b14f2fb3daa98769d06c7f0c1b076dfd0d983bc892"
 dependencies = [
  "error-code",
 ]
@@ -1526,12 +1518,6 @@ dependencies = [
  "dasp_sample",
 ]
 
-[[package]]
-name = "data-url"
-version = "0.3.1"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "5c297a1c74b71ae29df00c3e22dd9534821d60eb9af5a0192823fa2acea70c2a"
-
 [[package]]
 name = "dbus"
 version = "0.9.7"
@@ -1691,7 +1677,7 @@ version = "0.5.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "330c60081dcc4c72131f8eb70510f1ac07223e5d4163db481a04a0befcffa412"
 dependencies = [
- "libloading 0.7.4",
+ "libloading 0.8.4",
 ]
 
 [[package]]
@@ -2081,12 +2067,6 @@ dependencies = [
  "thiserror",
 ]
 
-[[package]]
-name = "float-cmp"
-version = "0.9.0"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "98de4bbd547a563b716d8dfa9aad1cb19bfab00f4fa09a6a4ed21dbcf44ce9c4"
-
 [[package]]
 name = "flume"
 version = "0.11.0"
@@ -2143,29 +2123,6 @@ dependencies = [
  "libm",
 ]
 
-[[package]]
-name = "fontconfig-parser"
-version = "0.5.6"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "6a595cb550439a117696039dfc69830492058211b771a2a165379f2a1a53d84d"
-dependencies = [
- "roxmltree 0.19.0",
-]
-
-[[package]]
-name = "fontdb"
-version = "0.18.0"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "e32eac81c1135c1df01d4e6d4233c47ba11f6a6d07f33e0bba09d18797077770"
-dependencies = [
- "fontconfig-parser",
- "log",
- "memmap2",
- "slotmap",
- "tinyvec",
- "ttf-parser",
-]
-
 [[package]]
 name = "foreign-types"
 version = "0.3.2"
@@ -3087,8 +3044,8 @@ checksum = "9a3a5bfb195931eeb336b2a7b4d761daec841b97f947d34394601737a7bba5e4"
 
 [[package]]
 name = "hwcodec"
-version = "0.6.0"
-source = "git+https://github.com/21pages/hwcodec#89879f2f02c6f74e88a4a43744a1153aec5b7e7f"
+version = "0.7.0"
+source = "git+https://github.com/rustdesk-org/hwcodec#6abd1898f3a03481ed0c038507b5218d6ea94267"
 dependencies = [
  "bindgen 0.59.2",
  "cc",
@@ -3213,16 +3170,10 @@ dependencies = [
  "tiff",
 ]
 
-[[package]]
-name = "imagesize"
-version = "0.12.0"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "029d73f573d8e8d63e6d5020011d3255b28c3ba85d6cf870a07184ed23de9284"
-
 [[package]]
 name = "impersonate_system"
 version = "0.1.0"
-source = "git+https://github.com/21pages/impersonate-system#2f429010a5a10b1fe5eceb553c6672fd53d20167"
+source = "git+https://github.com/rustdesk-org/impersonate-system#2f429010a5a10b1fe5eceb553c6672fd53d20167"
 dependencies = [
  "cc",
 ]
@@ -3462,16 +3413,6 @@ dependencies = [
  "unicode-segmentation",
 ]
 
-[[package]]
-name = "kurbo"
-version = "0.11.0"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "6e5aa9f0f96a938266bdb12928a67169e8d22c6a786fda8ed984b85e6ba93c3c"
-dependencies = [
- "arrayvec",
- "smallvec",
-]
-
 [[package]]
 name = "lazy_static"
 version = "1.5.0"
@@ -3558,7 +3499,7 @@ source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "e310b3a6b5907f99202fcdb4960ff45b93735d7c7d96b760fcff8db2dc0e103d"
 dependencies = [
  "cfg-if 1.0.0",
- "windows-targets 0.48.5",
+ "windows-targets 0.52.5",
 ]
 
 [[package]]
@@ -3733,7 +3674,7 @@ dependencies = [
 [[package]]
 name = "machine-uid"
 version = "0.3.0"
-source = "git+https://github.com/21pages/machine-uid#381ff579c1dc3a6c54db9dfec47c44bcb0246542"
+source = "git+https://github.com/rustdesk-org/machine-uid#381ff579c1dc3a6c54db9dfec47c44bcb0246542"
 dependencies = [
  "bindgen 0.59.2",
  "cc",
@@ -3777,15 +3718,6 @@ version = "2.7.4"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "78ca9ab1a0babb1e7d5695e3530886289c18cf2f87ec19a575a0abdce112e3a3"
 
-[[package]]
-name = "memmap2"
-version = "0.9.4"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "fe751422e4a8caa417e13c3ea66452215d7d63e19e604f4980461212f3ae1322"
-dependencies = [
- "libc",
-]
-
 [[package]]
 name = "memoffset"
 version = "0.6.5"
@@ -3847,14 +3779,6 @@ dependencies = [
  "windows-sys 0.48.0",
 ]
 
-[[package]]
-name = "mouce"
-version = "0.2.1"
-source = "git+https://github.com/rustdesk-org/mouce.git#177625a395cd8fa73964714d0039535cb9b47893"
-dependencies = [
- "glob",
-]
-
 [[package]]
 name = "muda"
 version = "0.13.5"
@@ -4732,15 +4656,9 @@ version = "0.7.24"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "234f71a15de2288bcb7e3b6515828d22af7ec8598ee6d24c3b526fa0a80b67a0"
 dependencies = [
- "siphasher 0.2.3",
+ "siphasher",
 ]

----------------------------------------

File: Cargo.toml
Status: modified
Changes: +5 -6
Diff:
@@ -1,6 +1,6 @@
 [package]
 name = "rustdesk"
-version = "1.2.7"
+version = "1.3.0"
 authors = ["rustdesk <info@rustdesk.com>"]
 edition = "2021"
 build= "build.rs"
@@ -90,7 +90,7 @@ enigo = { path = "libs/enigo", features = [ "with_serde" ] }
 clipboard = { path = "libs/clipboard" }
 ctrlc = "3.2"
 # arboard = { version = "3.4.0", features = ["wayland-data-control"] }
-arboard = { git = "https://github.com/rustdesk-org/arboard", features = ["wayland-data-control", "image-data"] }
+arboard = { git = "https://github.com/rustdesk-org/arboard", features = ["wayland-data-control"] }
 clipboard-master = { git = "https://github.com/rustdesk-org/clipboard-master" }
 
 system_shutdown = "4.0"

----------------------------------------

File: README.md
Status: modified
Changes: +3 -3
Diff:
@@ -59,19 +59,19 @@ Please download Sciter dynamic library yourself.
 ```sh
 sudo apt install -y zip g++ gcc git curl wget nasm yasm libgtk-3-dev clang libxcb-randr0-dev libxdo-dev \
         libxfixes-dev libxcb-shape0-dev libxcb-xfixes0-dev libasound2-dev libpulse-dev cmake make \
-        libclang-dev ninja-build libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev
+        libclang-dev ninja-build libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev libpam0g-dev
 ```
 
 ### openSUSE Tumbleweed
 

----------------------------------------

File: appimage/AppImageBuilder-aarch64.yml
Status: modified
Changes: +1 -1
Diff:
@@ -18,7 +18,7 @@ AppDir:
     id: rustdesk
     name: rustdesk
     icon: rustdesk
-    version: 1.2.7
+    version: 1.3.0
     exec: usr/lib/rustdesk/rustdesk
     exec_args: $@
   apt:

----------------------------------------

File: appimage/AppImageBuilder-x86_64.yml
Status: modified
Changes: +4 -1
Diff:
@@ -18,7 +18,7 @@ AppDir:
     id: rustdesk
     name: rustdesk
     icon: rustdesk
-    version: 1.2.7
+    version: 1.3.0
     exec: usr/lib/rustdesk/rustdesk
     exec_args: $@
   apt:
@@ -37,6 +37,9 @@ AppDir:

----------------------------------------

File: build.py
Status: modified
Changes: +7 -2
Diff:
@@ -31,6 +31,11 @@ def get_deb_arch() -> str:
         return "amd64"
     return custom_arch
 
+def get_deb_extra_depends() -> str:
+    custom_arch = os.environ.get("DEB_ARCH")
+    if custom_arch == "armhf": # for arm32v7 libsciter-gtk.so
+        return ", libatomic1"
+    return ""
 

----------------------------------------

File: flutter/build_fdroid.sh
Status: modified
Changes: +2 -4
Diff:
@@ -43,15 +43,13 @@ arm64-v8a)
 	FLUTTER_TARGET=android-arm64
 	NDK_TARGET=aarch64-linux-android
 	RUST_TARGET=aarch64-linux-android
-#	RUSTDESK_FEATURES='flutter,hwcodec'
-	RUSTDESK_FEATURES='flutter'
+	RUSTDESK_FEATURES='flutter,hwcodec'
 	;;
 armeabi-v7a)
 	FLUTTER_TARGET=android-arm

----------------------------------------

File: flutter/lib/common.dart
Status: modified
Changes: +170 -44
Diff:
@@ -31,7 +31,6 @@ import 'mobile/pages/file_manager_page.dart';
 import 'mobile/pages/remote_page.dart';
 import 'desktop/pages/remote_page.dart' as desktop_remote;
 import 'package:flutter_hbb/desktop/widgets/remote_toolbar.dart';
-import 'models/input_model.dart';
 import 'models/model.dart';
 import 'models/platform_model.dart';
 
@@ -630,10 +629,30 @@ List<Locale> supportedLocales = const [
   Locale('da'),
   Locale('eo'),
   Locale('tr'),
-  Locale('vi'),
-  Locale('pl'),
   Locale('kz'),
   Locale('es'),
+  Locale('nl'),
+  Locale('nb'),
+  Locale('et'),
+  Locale('eu'),
+  Locale('bg'),
+  Locale('be'),
+  Locale('vn'),
+  Locale('uk'),
+  Locale('fa'),
+  Locale('ca'),
+  Locale('el'),
+  Locale('sv'),
+  Locale('sq'),
+  Locale('sr'),
+  Locale('th'),
+  Locale('sl'),
+  Locale('ro'),
+  Locale('lt'),
+  Locale('lv'),
+  Locale('ar'),
+  Locale('he'),
+  Locale('hr'),
 ];
 
 String formatDurationToTime(Duration duration) {
@@ -647,8 +666,12 @@ String formatDurationToTime(Duration duration) {
 
 closeConnection({String? id}) {
   if (isAndroid || isIOS) {
-    gFFI.chatModel.hideChatOverlay();
-    Navigator.popUntil(globalKey.currentContext!, ModalRoute.withName("/"));
+    () async {
+      await SystemChrome.setEnabledSystemUIMode(SystemUiMode.manual,
+          overlays: SystemUiOverlay.values);
+      gFFI.chatModel.hideChatOverlay();
+      Navigator.popUntil(globalKey.currentContext!, ModalRoute.withName("/"));
+    }();
   } else {
     if (isWeb) {
       Navigator.popUntil(globalKey.currentContext!, ModalRoute.withName("/"));
@@ -1054,6 +1077,49 @@ class CustomAlertDialog extends StatelessWidget {
   }
 }
 
+Widget createDialogContent(String text) {
+  final RegExp linkRegExp = RegExp(r'(https?://[^\s]+)');
+  final List<TextSpan> spans = [];
+  int start = 0;
+  bool hasLink = false;
+
+  linkRegExp.allMatches(text).forEach((match) {
+    hasLink = true;
+    if (match.start > start) {
+      spans.add(TextSpan(text: text.substring(start, match.start)));
+    }
+    spans.add(TextSpan(
+      text: match.group(0) ?? '',
+      style: TextStyle(
+        color: Colors.blue,
+        decoration: TextDecoration.underline,
+      ),
+      recognizer: TapGestureRecognizer()
+        ..onTap = () {
+          String linkText = match.group(0) ?? '';
+          linkText = linkText.replaceAll(RegExp(r'[.,;!?]+$'), '');
+          launchUrl(Uri.parse(linkText));
+        },
+    ));
+    start = match.end;
+  });
+
+  if (start < text.length) {
+    spans.add(TextSpan(text: text.substring(start)));
+  }
+
+  if (!hasLink) {
+    return SelectableText(text, style: const TextStyle(fontSize: 15));
+  }
+
+  return SelectableText.rich(
+    TextSpan(
+      style: TextStyle(color: Colors.black, fontSize: 15),
+      children: spans,
+    ),
+  );
+}
+
 void msgBox(SessionID sessionId, String type, String title, String text,
     String link, OverlayDialogManager dialogManager,

----------------------------------------

File: flutter/lib/common/widgets/address_book.dart
Status: modified
Changes: +4 -6
Diff:
@@ -35,17 +35,14 @@ class AddressBook extends StatefulWidget {
 class _AddressBookState extends State<AddressBook> {
   var menuPos = RelativeRect.fill;
 
-  @override
-  void initState() {
-    super.initState();
-  }
-
   @override

----------------------------------------

File: flutter/lib/common/widgets/dialog.dart
Status: modified
Changes: +274 -3
Diff:
@@ -679,13 +679,15 @@ class PasswordWidget extends StatefulWidget {
     this.reRequestFocus = false,
     this.hintText,
     this.errorText,
+    this.title,
   }) : super(key: key);
 
   final TextEditingController controller;
   final bool autoFocus;
   final bool reRequestFocus;
   final String? hintText;
   final String? errorText;
+  final String? title;
 
   @override
   State<PasswordWidget> createState() => _PasswordWidgetState();
@@ -729,7 +731,7 @@ class _PasswordWidgetState extends State<PasswordWidget> {
   @override
   Widget build(BuildContext context) {
     return DialogTextField(
-      title: translate(DialogTextField.kPasswordTitle),
+      title: translate(widget.title ?? DialogTextField.kPasswordTitle),
       hintText: translate(widget.hintText ?? 'Enter your password'),
       controller: widget.controller,
       prefixIcon: DialogTextField.kPasswordIcon,
@@ -1829,6 +1831,7 @@ void changeBot({Function()? callback}) async {
 void change2fa({Function()? callback}) async {
   if (bind.mainHasValid2FaSync()) {
     await bind.mainSetOption(key: "2fa", value: "");
+    await bind.mainClearTrustedDevices();
     callback?.call();
     return;
   }
@@ -1896,6 +1899,7 @@ void enter2FaDialog(
     SessionID sessionId, OverlayDialogManager dialogManager) async {
   final controller = TextEditingController();
   final RxBool submitReady = false.obs;
+  final RxBool trustThisDevice = false.obs;
 
   dialogManager.dismissAll();
   dialogManager.show((setState, close, context) {
@@ -1905,7 +1909,7 @@ void enter2FaDialog(
     }
 
     submit() {
-      gFFI.send2FA(sessionId, controller.text.trim());
+      gFFI.send2FA(sessionId, controller.text.trim(), trustThisDevice.value);
       close();
       dialogManager.showLoading(translate('Logging in...'),
           onCancel: closeConnection);
@@ -1919,9 +1923,27 @@ void enter2FaDialog(
       onChanged: () => submitReady.value = codeField.isReady,
     );
 
+    final trustField = Obx(() => CheckboxListTile(
+          contentPadding: const EdgeInsets.all(0),
+          dense: true,
+          controlAffinity: ListTileControlAffinity.leading,
+          title: Text(translate("Trust this device")),
+          value: trustThisDevice.value,
+          onChanged: (value) {
+            if (value == null) return;
+            trustThisDevice.value = value;
+          },
+        ));
+
     return CustomAlertDialog(
         title: Text(translate('enter-2fa-title')),
-        content: codeField,
+        content: Column(
+          children: [
+            codeField,
+            if (bind.sessionGetEnableTrustedDevices(sessionId: sessionId))
+              trustField,
+          ],
+        ),
         actions: [
           dialogButton('Cancel',
               onPressed: cancel,
@@ -2216,3 +2238,252 @@ void CommonConfirmDialog(OverlayDialogManager dialogManager, String content,
     );
   });
 }
+
+void changeUnlockPinDialog(String oldPin, Function() callback) {
+  final pinController = TextEditingController(text: oldPin);
+  final confirmController = TextEditingController(text: oldPin);
+  String? pinErrorText;
+  String? confirmationErrorText;
+  gFFI.dialogManager.show((setState, close, context) {
+    submit() async {
+      pinErrorText = null;
+      confirmationErrorText = null;
+      final pin = pinController.text.trim();
+      final confirm = confirmController.text.trim();
+      if (pin != confirm) {
+        setState(() {
+          confirmationErrorText =
+              translate('The confirmation is not identical.');
+        });
+        return;
+      }
+      final errorMsg = bind.mainSetUnlockPin(pin: pin);
+      if (errorMsg != '') {
+        setState(() {
+          pinErrorText = translate(errorMsg);
+        });
+        return;
+      }
+      callback.call();

----------------------------------------

File: flutter/lib/common/widgets/login.dart
Status: modified
Changes: +0 -5
Diff:
@@ -142,11 +142,6 @@ class _WidgetOPState extends State<WidgetOP> {
   String _failedMsg = '';
   String _url = '';
 
-  @override
-  void initState() {
-    super.initState();
-  }
-
   @override

----------------------------------------

File: flutter/lib/common/widgets/my_group.dart
Status: modified
Changes: +2 -5
Diff:
@@ -23,18 +23,15 @@ class _MyGroupState extends State<MyGroup> {
   RxString get searchUserText => gFFI.groupModel.searchUserText;
   static TextEditingController searchUserController = TextEditingController();
 
-  @override
-  void initState() {
-    super.initState();
-  }
-
   @override

----------------------------------------

File: flutter/lib/common/widgets/overlay.dart
Status: modified
Changes: +9 -12
Diff:
@@ -353,7 +353,7 @@ class Draggable extends StatefulWidget {
   final Widget Function(BuildContext, GestureDragUpdateCallback) builder;
 
   @override
-  State<StatefulWidget> createState() => _DraggableState();
+  State<StatefulWidget> createState() => _DraggableState(chatModel);
 }
 
 class _DraggableState extends State<Draggable> {
@@ -362,10 +362,8 @@ class _DraggableState extends State<Draggable> {
   double _saveHeight = 0;
   double _lastBottomHeight = 0;
 
-  @override
-  void initState() {
-    super.initState();

----------------------------------------

File: flutter/lib/common/widgets/peer_card.dart
Status: modified
Changes: +2 -2
Diff:
@@ -636,8 +636,8 @@ abstract class BasePeerCard extends StatelessWidget {
 
   @protected
   Future<bool> _isForceAlwaysRelay(String id) async {
-    return (await bind.mainGetPeerOption(id: id, key: kOptionForceAlwaysRelay))
-        .isNotEmpty;
+    return option2bool(kOptionForceAlwaysRelay,
+        (await bind.mainGetPeerOption(id: id, key: kOptionForceAlwaysRelay)));
   }
 

----------------------------------------

File: flutter/lib/common/widgets/peer_tab_page.dart
Status: modified
Changes: +16 -12
Diff:
@@ -76,8 +76,11 @@ class _PeerTabPageState extends State<PeerTabPage>
 
   final isOptVisiableFixed = isOptionFixed(kOptionPeerTabVisible);
 
-  @override
-  void initState() {
+  _PeerTabPageState() {
+    _loadLocalOptions();
+  }
+
+  void _loadLocalOptions() {
     final uiType = bind.getLocalFlutterOption(k: kOptionPeerCardUiType);
     if (uiType != '') {
       peerCardUiType.value = int.parse(uiType) == 0
@@ -87,8 +90,7 @@ class _PeerTabPageState extends State<PeerTabPage>
               : PeerUiType.list;
     }

----------------------------------------

File: flutter/lib/common/widgets/peers_view.dart
Status: modified
Changes: +32 -10
Diff:
@@ -45,10 +45,14 @@ class LoadEvent {
 final peerSearchText = "".obs;
 
 /// for peer sort, global obs value
-final peerSort = bind.getLocalFlutterOption(k: kOptionPeerSorting).obs;
+RxString? _peerSort;
+RxString get peerSort {
+  _peerSort ??= bind.getLocalFlutterOption(k: kOptionPeerSorting).obs;
+  return _peerSort!;
+}
 
 // list for listener
-final obslist = [peerSearchText, peerSort].obs;
+RxList<RxString> get obslist => [peerSearchText, peerSort].obs;
 
 final peerSearchTextController =
     TextEditingController(text: peerSearchText.value);
@@ -70,7 +74,8 @@ class _PeersView extends StatefulWidget {
 }
 
 /// State for the peer widget.
-class _PeersViewState extends State<_PeersView> with WindowListener {
+class _PeersViewState extends State<_PeersView>
+    with WindowListener, WidgetsBindingObserver {
   static const int _maxQueryCount = 3;
   final HashMap<String, String> _emptyMessages = HashMap.from({
     LoadEvent.recent: 'empty_recent_tip',
@@ -85,6 +90,7 @@ class _PeersViewState extends State<_PeersView> with WindowListener {
   var _lastQueryTime = DateTime.now();
   var _queryCount = 0;
   var _exit = false;
+  bool _isActive = true;
 

----------------------------------------

File: flutter/lib/common/widgets/toolbar.dart
Status: modified
Changes: +2 -5
Diff:
@@ -130,12 +130,9 @@ List<TTextMenu> toolbarControls(BuildContext context, String id, FFI ffi) {
     );
   }
   // paste
-  if (isMobile &&
-      pi.platform != kPeerPlatformAndroid &&
-      perms['keyboard'] != false &&
-      perms['clipboard'] != false) {
+  if (pi.platform != kPeerPlatformAndroid && perms['keyboard'] != false) {
     v.add(TTextMenu(

----------------------------------------

File: flutter/lib/consts.dart
Status: modified
Changes: +4 -3
Diff:
@@ -136,6 +136,7 @@ const String kOptionAllowRemoveWallpaper = "allow-remove-wallpaper";
 const String kOptionStopService = "stop-service";
 const String kOptionDirectxCapture = "enable-directx-capture";
 const String kOptionAllowRemoteCmModification = "allow-remote-cm-modification";
+const String kOptionEnableTrustedDevices = "enable-trusted-devices";
 
 // buildin opitons
 const String kOptionHideServerSetting = "hide-server-settings";
@@ -240,9 +241,9 @@ const kDefaultScrollDuration = Duration(milliseconds: 50);
 const kDefaultMouseWheelThrottleDuration = Duration(milliseconds: 50);

----------------------------------------

File: flutter/lib/desktop/pages/connection_page.dart
Status: modified
Changes: +5 -8
Diff:
@@ -169,16 +169,12 @@ class _OnlineStatusWidgetState extends State<OnlineStatusWidget> {
     final status =
         jsonDecode(await bind.mainGetConnectStatus()) as Map<String, dynamic>;
     final statusNum = status['status_num'] as int;
-    final preStatus = stateGlobal.svcStatus.value;
     if (statusNum == 0) {
       stateGlobal.svcStatus.value = SvcStatus.connecting;
     } else if (statusNum == -1) {
       stateGlobal.svcStatus.value = SvcStatus.notReady;
     } else if (statusNum == 1) {
       stateGlobal.svcStatus.value = SvcStatus.ready;
-      if (preStatus != SvcStatus.ready) {
-        gFFI.userModel.refreshCurrentUser();
-      }
     } else {

----------------------------------------

File: flutter/lib/desktop/pages/desktop_setting_page.dart
Status: modified
Changes: +83 -19
Diff:
@@ -78,7 +78,8 @@ class DesktopSettingPage extends StatefulWidget {
   DesktopSettingPage({Key? key, required this.initialTabkey}) : super(key: key);
 
   @override
-  State<DesktopSettingPage> createState() => _DesktopSettingPageState();
+  State<DesktopSettingPage> createState() =>
+      _DesktopSettingPageState(initialTabkey);
 
   static void switch2page(SettingsTabKey page) {
     try {
@@ -111,10 +112,8 @@ class _DesktopSettingPageState extends State<DesktopSettingPage>
   @override
   bool get wantKeepAlive => true;
 
-  @override
-  void initState() {
-    super.initState();
-    var initialIndex = DesktopSettingPage.tabKeys.indexOf(widget.initialTabkey);
+  _DesktopSettingPageState(SettingsTabKey initialTabkey) {
+    var initialIndex = DesktopSettingPage.tabKeys.indexOf(initialTabkey);
     if (initialIndex == -1) {
       initialIndex = 0;
     }
@@ -516,16 +515,16 @@ class _GeneralState extends State<_General> {
     }
 
     builder(devices, currentDevice, setDevice) {
-      return _Card(title: 'Audio Input Device', children: [
-        ...devices.map((device) => _Radio<String>(context,
-                value: device,
-                groupValue: currentDevice,
-                autoNewLine: false,
-                label: device, onChanged: (value) {
-              setDevice(value);
-              setState(() {});
-            }))
-      ]);
+      final child = ComboBox(
+        keys: devices,
+        values: devices,
+        initialKey: currentDevice,
+        onChanged: (key) async {
+          setDevice(key);
+          setState(() {});
+        },
+      ).marginOnly(left: _kContentHMargin);
+      return _Card(title: 'Audio Input Device', children: [child]);
     }
 
     return AudioInput(builder: builder, isCm: false, isVoiceCall: false);

----------------------------------------

File: flutter/lib/desktop/pages/desktop_tab_page.dart
Status: modified
Changes: +18 -14
Diff:
@@ -44,21 +44,9 @@ class _DesktopTabPageState extends State<DesktopTabPage>
   final RxBool _block = false.obs;
   // bool mouseIn = false;
 
-  @override
-  void didChangeAppLifecycleState(AppLifecycleState state) {
-    super.didChangeAppLifecycleState(state);
-    if (state == AppLifecycleState.resumed) {
-      shouldBeBlocked(_block, canBeBlocked);
-    } else if (state == AppLifecycleState.inactive) {}
-  }
-
-  @override
-  void initState() {
-    super.initState();
-    // HardwareKeyboard.instance.addHandler(_handleKeyEvent);
-    WidgetsBinding.instance.addObserver(this);
-    Get.put<DesktopTabController>(tabController);

----------------------------------------

File: flutter/lib/desktop/pages/file_manager_page.dart
Status: modified
Changes: +61 -1
Diff:
@@ -98,7 +98,10 @@ class _FileManagerPageState extends State<FileManagerPage>
     }
     debugPrint("File manager page init success with id ${widget.id}");
     _ffi.dialogManager.setOverlayState(_overlayKeyState);
-    widget.tabController.onSelected?.call(widget.id);
+    // Call onSelected in post frame callback, since we cannot guarantee that the callback will not call setState.
+    WidgetsBinding.instance.addPostFrameCallback((_) {
+      widget.tabController.onSelected?.call(widget.id);
+    });
   }
 
   @override
@@ -259,6 +262,7 @@ class _FileManagerPageState extends State<FileManagerPage>
                             Offstage(
                               offstage: item.state != JobState.paused,
                               child: MenuButton(
+                                tooltip: translate("Resume"),
                                 onPressed: () {
                                   jobController.resumeJob(item.id);
                                 },
@@ -271,6 +275,7 @@ class _FileManagerPageState extends State<FileManagerPage>
                               ),
                             ),
                             MenuButton(
+                              tooltip: translate("Delete"),
                               padding: EdgeInsets.only(right: 15),
                               child: SvgPicture.asset(
                                 "assets/close.svg",
@@ -518,6 +523,7 @@ class _FileManagerViewState extends State<FileManagerView> {
               Row(
                 children: [
                   MenuButton(
+                    tooltip: translate('Back'),
                     padding: EdgeInsets.only(
                       right: 3,
                     ),
@@ -537,6 +543,7 @@ class _FileManagerViewState extends State<FileManagerView> {
                     },
                   ),
                   MenuButton(
+                    tooltip: translate('Parent directory'),
                     child: RotatedBox(
                       quarterTurns: 3,
                       child: SvgPicture.asset(
@@ -601,6 +608,7 @@ class _FileManagerViewState extends State<FileManagerView> {
                 switch (_locationStatus.value) {
                   case LocationStatus.bread:
                     return MenuButton(
+                      tooltip: translate('Search'),
                       onPressed: () {
                         _locationStatus.value = LocationStatus.fileSearchBar;
                         Future.delayed(
@@ -627,6 +635,7 @@ class _FileManagerViewState extends State<FileManagerView> {
                     );
                   case LocationStatus.fileSearchBar:
                     return MenuButton(
+                      tooltip: translate('Clear'),

----------------------------------------

File: flutter/lib/desktop/pages/file_manager_tab_page.dart
Status: modified
Changes: +3 -2
Diff:
@@ -34,6 +34,7 @@ class _FileManagerTabPageState extends State<FileManagerTabPage> {
       WindowController.fromWindowId(windowId())
           .setTitle(getWindowNameWithId(id));
     };
+    tabController.onRemoved = (_, id) => onRemoveId(id);
     tabController.add(TabInfo(
         key: params['id'],
         label: params['id'],
@@ -54,8 +55,6 @@ class _FileManagerTabPageState extends State<FileManagerTabPage> {
   void initState() {
     super.initState();

----------------------------------------

File: flutter/lib/desktop/pages/install_page.dart
Status: modified
Changes: +12 -4
Diff:
@@ -1,3 +1,5 @@
+import 'dart:convert';
+
 import 'package:file_picker/file_picker.dart';
 import 'package:flutter/material.dart';
 import 'package:flutter_hbb/common.dart';
@@ -19,9 +21,7 @@ class InstallPage extends StatefulWidget {
 class _InstallPageState extends State<InstallPage> {
   final tabController = DesktopTabController(tabType: DesktopTabType.main);
 
-  @override
-  void initState() {
-    super.initState();
+  _InstallPageState() {
     Get.put<DesktopTabController>(tabController);
     const label = "install";
     tabController.add(TabInfo(

----------------------------------------

File: flutter/lib/desktop/pages/port_forward_page.dart
Status: modified
Changes: +4 -1
Diff:
@@ -65,7 +65,10 @@ class _PortForwardPageState extends State<PortForwardPage>
         isRdp: widget.isRDP);
     Get.put<FFI>(_ffi, tag: 'pf_${widget.id}');
     debugPrint("Port forward page init success with id ${widget.id}");
-    widget.tabController.onSelected?.call(widget.id);
+    // Call onSelected in post frame callback, since we cannot guarantee that the callback will not call setState.
+    WidgetsBinding.instance.addPostFrameCallback((_) {
+      widget.tabController.onSelected?.call(widget.id);
+    });
   }

----------------------------------------

File: flutter/lib/desktop/pages/port_forward_tab_page.dart
Status: modified
Changes: +3 -2
Diff:
@@ -34,6 +34,7 @@ class _PortForwardTabPageState extends State<PortForwardTabPage> {
       WindowController.fromWindowId(windowId())
           .setTitle(getWindowNameWithId(id));
     };
+    tabController.onRemoved = (_, id) => onRemoveId(id);
     tabController.add(TabInfo(
         key: params['id'],
         label: params['id'],
@@ -54,8 +55,6 @@ class _PortForwardTabPageState extends State<PortForwardTabPage> {
   void initState() {
     super.initState();

----------------------------------------

File: flutter/lib/desktop/pages/remote_page.dart
Status: modified
Changes: +19 -15
Diff:
@@ -45,7 +45,9 @@ class RemotePage extends StatefulWidget {
     this.switchUuid,
     this.forceRelay,
     this.isSharedPassword,
-  }) : super(key: key);
+  }) : super(key: key) {
+    initSharedStates(id);
+  }
 
   final String id;
   final SessionID? sessionId;
@@ -64,7 +66,7 @@ class RemotePage extends StatefulWidget {
 
   @override
   State<RemotePage> createState() {
-    final state = _RemotePageState();
+    final state = _RemotePageState(id);
     _lastState.value = state;
     return state;
   }
@@ -94,8 +96,11 @@ class _RemotePageState extends State<RemotePage>
 
   SessionID get sessionId => _ffi.sessionId;
 
+  _RemotePageState(String id) {
+    _initStates(id);
+  }
+

----------------------------------------

File: flutter/lib/desktop/pages/remote_tab_page.dart
Status: modified
Changes: +8 -10
Diff:
@@ -71,7 +71,7 @@ class _ConnectionTabPageState extends State<ConnectionTabPage> {
           final ffi = remotePage.ffi;
           bind.setCurSessionId(sessionId: ffi.sessionId);
         }
-        WindowController.fromWindowId(windowId())
+        WindowController.fromWindowId(params['windowId'])
             .setTitle(getWindowNameWithId(id));
         UnreadChatCountState.find(id).value = 0;
       };
@@ -98,15 +98,14 @@ class _ConnectionTabPageState extends State<ConnectionTabPage> {
       ));
       _update_remote_count();
     }
+    tabController.onRemoved = (_, id) => onRemoveId(id);
+    rustDeskWinManager.setMethodHandler(_remoteMethodHandler);
   }
 
   @override
   void initState() {
     super.initState();
 
-    tabController.onRemoved = (_, id) => onRemoveId(id);
-

----------------------------------------

File: flutter/lib/desktop/pages/server_page.dart
Status: modified
Changes: +48 -24
Diff:
@@ -32,14 +32,18 @@ class DesktopServerPage extends StatefulWidget {
 class _DesktopServerPageState extends State<DesktopServerPage>
     with WindowListener, AutomaticKeepAliveClientMixin {
   final tabController = gFFI.serverModel.tabController;
-  @override
-  void initState() {
+
+  _DesktopServerPageState() {
     gFFI.ffiModel.updateEventListener(gFFI.sessionId, "");
-    windowManager.addListener(this);
     Get.put<DesktopTabController>(tabController);
     tabController.onRemoved = (_, id) {
       onRemoveId(id);
     };
+  }
+
+  @override
+  void initState() {
+    windowManager.addListener(this);
     super.initState();
   }
 
@@ -79,7 +83,7 @@ class _DesktopServerPageState extends State<DesktopServerPage>
       child: Consumer<ServerModel>(
         builder: (context, serverModel, child) {
           final body = Scaffold(
-            backgroundColor: Theme.of(context).scaffoldBackgroundColor,
+            backgroundColor: Theme.of(context).colorScheme.background,
             body: ConnectionManager(),
           );
           return isLinux
@@ -108,19 +112,7 @@ class ConnectionManagerState extends State<ConnectionManager>
     with WidgetsBindingObserver {
   final RxBool _block = false.obs;
 
-  @override
-  void didChangeAppLifecycleState(AppLifecycleState state) {
-    super.didChangeAppLifecycleState(state);
-    if (state == AppLifecycleState.resumed) {
-      if (!allowRemoteCMModification()) {
-        shouldBeBlocked(_block, null);
-      }
-    }
-  }
-
-  @override
-  void initState() {
-    gFFI.serverModel.updateClientState();
+  ConnectionManagerState() {
     gFFI.serverModel.tabController.onSelected = (client_id_str) {
       final client_id = int.tryParse(client_id_str);
       if (client_id != null) {
@@ -129,7 +121,7 @@ class ConnectionManagerState extends State<ConnectionManager>

----------------------------------------

File: flutter/lib/desktop/widgets/menu_button.dart
Status: modified
Changes: +1 -0
Diff:
@@ -34,6 +34,7 @@ class _MenuButtonState extends State<MenuButton> {
     return Padding(
       padding: widget.padding,
       child: Tooltip(
+        waitDuration: Duration(milliseconds: 300),
         message: widget.tooltip,
         child: Material(
           type: MaterialType.transparency,

----------------------------------------

File: flutter/lib/desktop/widgets/popup_menu.dart
Status: modified
Changes: +4 -6
Diff:
@@ -38,18 +38,16 @@ class PopupMenuChildrenItem<T> extends mod_menu.PopupMenuEntry<T> {
 
   @override
   MyPopupMenuItemState<T, PopupMenuChildrenItem<T>> createState() =>
-      MyPopupMenuItemState<T, PopupMenuChildrenItem<T>>();
+      MyPopupMenuItemState<T, PopupMenuChildrenItem<T>>(enabled?.value);
 }
 
 class MyPopupMenuItemState<T, W extends PopupMenuChildrenItem<T>>
     extends State<W> {

----------------------------------------

File: flutter/lib/desktop/widgets/remote_toolbar.dart
Status: modified
Changes: +4 -7
Diff:
@@ -372,7 +372,7 @@ class _RemoteToolbarState extends State<RemoteToolbar> {
   initState() {
     super.initState();
 
-    Future.delayed(Duration.zero, () async {
+    WidgetsBinding.instance.addPostFrameCallback((_) async {
       _fractionX.value = double.tryParse(await bind.sessionGetOption(
                   sessionId: widget.ffi.sessionId,
                   arg: 'remote-menubar-drag-x') ??
@@ -1032,11 +1032,6 @@ class _DisplayMenuState extends State<_DisplayMenu> {

----------------------------------------

File: flutter/lib/desktop/widgets/tabbar_widget.dart
Status: modified
Changes: +17 -24
Diff:
@@ -227,8 +227,7 @@ typedef TabMenuBuilder = Widget Function(String key);
 typedef LabelGetter = Rx<String> Function(String key);
 
 /// [_lastClickTime], help to handle double click
-int _lastClickTime =
-    DateTime.now().millisecondsSinceEpoch - bind.getDoubleClickTime() - 1000;
+int _lastClickTime = 0;
 
 class DesktopTab extends StatefulWidget {
   final bool showLogo;
@@ -506,17 +505,20 @@ class _DesktopTabState extends State<DesktopTab>
       Obx(() {
         if (stateGlobal.showTabBar.isTrue &&
             !(kUseCompatibleUiMode && isHideSingleItem())) {
+          final showBottomDivider = _showTabBarBottomDivider(tabType);
           return SizedBox(
             height: _kTabBarHeight,
             child: Column(
               children: [
                 SizedBox(
-                  height: _kTabBarHeight - 1,
+                  height:
+                      showBottomDivider ? _kTabBarHeight - 1 : _kTabBarHeight,
                   child: _buildBar(),
                 ),
-                const Divider(
-                  height: 1,
-                ),
+                if (showBottomDivider)
+                  const Divider(

----------------------------------------

File: flutter/lib/main.dart
Status: modified
Changes: +3 -3
Diff:
@@ -260,7 +260,7 @@ showCmWindow({bool isStartup = false}) async {
     WindowOptions windowOptions = getHiddenTitleBarWindowOptions(
         size: kConnectionManagerWindowSizeClosedChat, alwaysOnTop: true);
     await windowManager.waitUntilReadyToShow(windowOptions, null);
-    bind.mainHideDocker();
+    bind.mainHideDock();
     await Future.wait([
       windowManager.show(),
       windowManager.focus(),
@@ -288,14 +288,14 @@ hideCmWindow({bool isStartup = false}) async {

----------------------------------------

File: flutter/lib/mobile/pages/connection_page.dart
Status: modified
Changes: +10 -8
Diff:
@@ -50,19 +50,26 @@ class _ConnectionPageState extends State<ConnectionPage> {
   bool isPeersLoaded = false;
   StreamSubscription? _uniLinksSubscription;
 
+  _ConnectionPageState() {
+    if (!isWeb) _uniLinksSubscription = listenUniLinks();
+    _idController.addListener(() {
+      _idEmpty.value = _idController.text.isEmpty;
+    });
+    Get.put<IDTextEditingController>(_idController);
+  }
+
   @override
   void initState() {

----------------------------------------

File: flutter/lib/mobile/pages/file_manager_page.dart
Status: modified
Changes: +59 -30
Diff:
@@ -204,36 +204,54 @@ class _FileManagerPageState extends State<FileManagerPage> {
                     setState(() {});
                   } else if (v == "folder") {
                     final name = TextEditingController();
-                    gFFI.dialogManager
-                        .show((setState, close, context) => CustomAlertDialog(
-                                title: Text(translate("Create Folder")),
-                                content: Column(
-                                  mainAxisSize: MainAxisSize.min,
-                                  children: [
-                                    TextFormField(
-                                      decoration: InputDecoration(
-                                        labelText: translate(
-                                            "Please enter the folder name"),
-                                      ),
-                                      controller: name,
-                                    ),
-                                  ],
+                    String? errorText;
+                    gFFI.dialogManager.show((setState, close, context) {
+                      name.addListener(() {
+                        if (errorText != null) {
+                          setState(() {
+                            errorText = null;
+                          });
+                        }
+                      });
+                      return CustomAlertDialog(
+                          title: Text(translate("Create Folder")),
+                          content: Column(
+                            mainAxisSize: MainAxisSize.min,
+                            children: [
+                              TextFormField(
+                                decoration: InputDecoration(
+                                  labelText:
+                                      translate("Please enter the folder name"),
+                                  errorText: errorText,

----------------------------------------

File: flutter/lib/mobile/pages/remote_page.dart
Status: modified
Changes: +7 -9
Diff:
@@ -34,7 +34,7 @@ class RemotePage extends StatefulWidget {
   final bool? isSharedPassword;
 
   @override
-  State<RemotePage> createState() => _RemotePageState();
+  State<RemotePage> createState() => _RemotePageState(id);
 }
 
 class _RemotePageState extends State<RemotePage> {
@@ -58,6 +58,12 @@ class _RemotePageState extends State<RemotePage> {
   final TextEditingController _textController =
       TextEditingController(text: initText);
 
+  _RemotePageState(String id) {
+    initSharedStates(id);

----------------------------------------

File: flutter/lib/mobile/pages/server_page.dart
Status: modified
Changes: +1 -1
Diff:
@@ -187,7 +187,7 @@ class _ServerPageState extends State<ServerPage> {
                     child: Column(
                       mainAxisAlignment: MainAxisAlignment.start,
                       children: [
-                        buildPresetPasswordWarning(),
+                        buildPresetPasswordWarningMobile(),
                         gFFI.serverModel.isStart
                             ? ServerInfo()
                             : ServiceNotRunningNotification(),

----------------------------------------

File: flutter/lib/mobile/pages/settings_page.dart
Status: modified
Changes: +124 -11
Diff:
@@ -1,5 +1,6 @@
 import 'dart:async';
 import 'dart:convert';
+import 'dart:typed_data';
 
 import 'package:flutter/material.dart';
 import 'package:flutter_hbb/common/widgets/setting_widgets.dart';
@@ -87,12 +88,9 @@ class _SettingsState extends State<SettingsPage> with WidgetsBindingObserver {
   var _hideServer = false;
   var _hideProxy = false;
   var _hideNetwork = false;
+  var _enableTrustedDevices = false;
 
-  @override
-  void initState() {
-    super.initState();
-    WidgetsBinding.instance.addObserver(this);
-
+  _SettingsState() {
     _enableAbr = option2bool(
         kOptionEnableAbr, bind.mainGetOptionSync(key: kOptionEnableAbr));
     _denyLANDiscovery = !option2bool(kOptionEnableLanDiscovery,
@@ -117,8 +115,15 @@ class _SettingsState extends State<SettingsPage> with WidgetsBindingObserver {
     _hideProxy = bind.mainGetBuildinOption(key: kOptionHideProxySetting) == 'Y';
     _hideNetwork =
         bind.mainGetBuildinOption(key: kOptionHideNetworkSetting) == 'Y';
+    _enableTrustedDevices = mainGetBoolOptionSync(kOptionEnableTrustedDevices);
+  }
+
+  @override
+  void initState() {
+    super.initState();
+    WidgetsBinding.instance.addObserver(this);
 
-    () async {
+    WidgetsBinding.instance.addPostFrameCallback((_) async {
       var update = false;
 
       if (_hasIgnoreBattery) {
@@ -177,7 +182,7 @@ class _SettingsState extends State<SettingsPage> with WidgetsBindingObserver {
       if (update) {
         setState(() {});
       }
-    }();
+    });
   }
 
   @override
@@ -241,18 +246,76 @@ class _SettingsState extends State<SettingsPage> with WidgetsBindingObserver {
       ],
     ));
     final List<AbstractSettingsTile> enhancementsTiles = [];
-    final List<AbstractSettingsTile> shareScreenTiles = [
+    final enable2fa = bind.mainHasValid2FaSync();
+    final List<AbstractSettingsTile> tfaTiles = [
       SettingsTile.switchTile(
         title: Text(translate('enable-2fa-title')),
-        initialValue: bind.mainHasValid2FaSync(),
-        onToggle: (_) async {
+        initialValue: enable2fa,
+        onToggle: (v) async {
           update() async {
             setState(() {});
           }

----------------------------------------

File: flutter/lib/mobile/widgets/gesture_help.dart
Status: modified
Changes: +5 -7
Diff:
@@ -41,18 +41,16 @@ class GestureHelp extends StatefulWidget {
   final OnTouchModeChange onTouchModeChange;
 
   @override
-  State<StatefulWidget> createState() => _GestureHelpState();
+  State<StatefulWidget> createState() => _GestureHelpState(touchMode);
 }
 
 class _GestureHelpState extends State<GestureHelp> {
-  var _selectedIndex;

----------------------------------------

File: flutter/lib/models/ab_model.dart
Status: modified
Changes: +5 -8
Diff:
@@ -17,17 +17,17 @@ import '../common.dart';
 
 final syncAbOption = 'sync-ab-with-recent-sessions';
 bool shouldSyncAb() {
-  return bind.mainGetLocalOption(key: syncAbOption).isNotEmpty;
+  return bind.mainGetLocalOption(key: syncAbOption) == 'Y';
 }
 
 final sortAbTagsOption = 'sync-ab-tags';
 bool shouldSortTags() {
-  return bind.mainGetLocalOption(key: sortAbTagsOption).isNotEmpty;
+  return bind.mainGetLocalOption(key: sortAbTagsOption) == 'Y';
 }
 
 final filterAbTagOption = 'filter-ab-by-intersection';
 bool filterAbTagByIntersection() {
-  return bind.mainGetLocalOption(key: filterAbTagOption).isNotEmpty;

----------------------------------------

File: flutter/lib/models/cm_file_model.dart
Status: modified
Changes: +56 -15
Diff:
@@ -33,6 +33,8 @@ class CmFileModel {
       _onFileRemove(evt['remove']);
     } else if (evt['create_dir'] != null) {
       _onDirCreate(evt['create_dir']);
+    } else if (evt['rename'] != null) {
+      _onRename(evt['rename']);
     }
   }
 
@@ -59,8 +61,6 @@ class CmFileModel {
 
   _dealOneJob(dynamic l, bool calcSpeed) {
     final data = TransferJobSerdeData.fromJson(l);
-    Client? client =
-        gFFI.serverModel.clients.firstWhereOrNull((e) => e.id == data.connId);
     var jobTable = _jobTables[data.connId];
     if (jobTable == null) {
       debugPrint("jobTable should not be null");
@@ -70,12 +70,7 @@ class CmFileModel {
     if (job == null) {
       job = CmFileLog();
       jobTable.add(job);
-      final currentSelectedTab =
-          gFFI.serverModel.tabController.state.value.selectedTabInfo;
-      if (!(gFFI.chatModel.isShowCMSidePage &&
-          currentSelectedTab.key == data.connId.toString())) {
-        client?.unreadChatMessageCount.value += 1;
-      }
+      _addUnread(data.connId);
     }
     job.id = data.id;
     job.action =
@@ -167,8 +162,6 @@ class CmFileModel {
     try {
       dynamic d = jsonDecode(log);
       FileActionLog data = FileActionLog.fromJson(d);
-      Client? client =
-          gFFI.serverModel.clients.firstWhereOrNull((e) => e.id == data.connId);
       var jobTable = _jobTables[data.connId];
       if (jobTable == null) {
         debugPrint("jobTable should not be null");

----------------------------------------

File: flutter/lib/models/file_model.dart
Status: modified
Changes: +79 -0
Diff:
@@ -3,6 +3,7 @@ import 'dart:convert';
 
 import 'package:flutter/material.dart';
 import 'package:flutter_hbb/common.dart';
+import 'package:flutter_hbb/common/widgets/dialog.dart';
 import 'package:flutter_hbb/utils/event_loop.dart';
 import 'package:get/get.dart';
 import 'package:path/path.dart' as path;
@@ -642,6 +643,77 @@ class FileController {
         path: path,
         isRemote: !isLocal);
   }
+
+  Future<void> renameAction(Entry item, bool isLocal) async {
+    final textEditingController = TextEditingController(text: item.name);
+    String? errorText;
+    dialogManager?.show((setState, close, context) {
+      textEditingController.addListener(() {
+        if (errorText != null) {
+          setState(() {
+            errorText = null;
+          });
+        }
+      });
+      submit() async {
+        final newName = textEditingController.text;
+        if (newName.isEmpty || newName == item.name) {
+          close();
+          return;
+        }
+        if (directory.value.entries.any((e) => e.name == newName)) {
+          setState(() {
+            errorText = translate("Already exists");

----------------------------------------

File: flutter/lib/models/group_model.dart
Status: modified
Changes: +1 -0
Diff:
@@ -28,6 +28,7 @@ class GroupModel {
   Future<void> pull({force = true, quiet = false}) async {
     if (bind.isDisableGroupPanel()) return;
     if (!gFFI.userModel.isLogin || groupLoading.value) return;
+    if (gFFI.userModel.networkError.isNotEmpty) return;
     if (!force && initialized) return;
     if (!quiet) {
       groupLoading.value = true;

----------------------------------------

File: flutter/lib/models/model.dart
Status: modified
Changes: +51 -47
Diff:
@@ -384,7 +384,7 @@ class FfiModel with ChangeNotifier {
       } else if (name == 'use_texture_render') {
         _handleUseTextureRender(evt, sessionId, peerId);
       } else {
-        debugPrint('Unknown event name: $name');
+        debugPrint('Event is not handled in the fixed branch: $name');
       }
     };
   }
@@ -723,6 +723,8 @@ class FfiModel with ChangeNotifier {
 
   /// Handle the peer info event based on [evt].
   handlePeerInfo(Map<String, dynamic> evt, String peerId, bool isCache) async {
+    parent.target?.chatModel.voiceCallStatus.value = VoiceCallStatus.notStarted;
+
     // This call is to ensuer the keyboard mode is updated depending on the peer version.
     parent.target?.inputModel.updateKeyboardMode();
 
@@ -1001,14 +1003,15 @@ class FfiModel with ChangeNotifier {
             // Notify to switch display
             msgBox(sessionId, 'custom-nook-nocancel-hasclose-info', 'Prompt',
                 'display_is_plugged_out_msg', '', parent.target!.dialogManager);
-            final newDisplay = pi.primaryDisplay == kInvalidDisplayIndex
-                ? 0
-                : pi.primaryDisplay;
-            final displays = newDisplay;
+            final isPeerPrimaryDisplayValid =
+                pi.primaryDisplay == kInvalidDisplayIndex ||
+                    pi.primaryDisplay >= pi.displays.length;
+            final newDisplay =
+                isPeerPrimaryDisplayValid ? 0 : pi.primaryDisplay;
             bind.sessionSwitchDisplay(
               isDesktop: isDesktop,
               sessionId: sessionId,
-              value: Int32List.fromList([displays]),
+              value: Int32List.fromList([newDisplay]),
             );
 
             if (_pi.isSupportMultiUiSession) {
@@ -1173,26 +1176,28 @@ class ImageModel with ChangeNotifier {
 
   addCallbackOnFirstImage(Function(String) cb) => callbacksOnFirstImage.add(cb);
 
-  onRgba(int display, Uint8List rgba) {
+  clearImage() => _image = null;
+
+  onRgba(int display, Uint8List rgba) async {
+    try {
+      await decodeAndUpdate(display, rgba);
+    } catch (e) {
+      debugPrint('onRgba error: $e');
+    }

----------------------------------------

File: flutter/lib/models/server_model.dart
Status: modified
Changes: +2 -2
Diff:
@@ -196,7 +196,7 @@ class ServerModel with ChangeNotifier {
       bind.mainSetOption(key: kOptionEnableAudio, value: "N");
     } else {
       final audioOption = await bind.mainGetOption(key: kOptionEnableAudio);
-      _audioOk = audioOption.isEmpty;
+      _audioOk = audioOption != 'N';
     }
 
     // file
@@ -206,7 +206,7 @@ class ServerModel with ChangeNotifier {

----------------------------------------

File: flutter/lib/models/state_model.dart
Status: modified
Changes: +2 -2
Diff:
@@ -14,7 +14,7 @@ class StateGlobal {
   bool _isMinimized = false;
   final RxBool isMaximized = false.obs;
   final RxBool _showTabBar = true.obs;
-  final RxDouble _resizeEdgeSize = RxDouble(windowEdgeSize);
+  final RxDouble _resizeEdgeSize = RxDouble(windowResizeEdgeSize);
   final RxDouble _windowBorderWidth = RxDouble(kWindowBorderWidth);
   final RxBool showRemoteToolBar = false.obs;
   final svcStatus = SvcStatus.notReady.obs;
@@ -93,7 +93,7 @@ class StateGlobal {

----------------------------------------

File: flutter/lib/models/user_model.dart
Status: modified
Changes: +23 -7
Diff:
@@ -17,13 +17,23 @@ bool refreshingUser = false;
 class UserModel {
   final RxString userName = ''.obs;
   final RxBool isAdmin = false.obs;
+  final RxString networkError = ''.obs;
   bool get isLogin => userName.isNotEmpty;
   WeakReference<FFI> parent;
 
-  UserModel(this.parent);
+  UserModel(this.parent) {
+    userName.listen((p0) {
+      // When user name becomes empty, show login button
+      // When user name becomes non-empty:
+      //  For _updateLocalUserInfo, network error will be set later
+      //  For login success, should clear network error
+      networkError.value = '';

----------------------------------------

File: flutter/lib/utils/image.dart
Status: modified
Changes: +0 -5
Diff:
@@ -13,32 +13,27 @@ Future<ui.Image?> decodeImageFromPixels(
   int? rowBytes,
   int? targetWidth,
   int? targetHeight,
-  VoidCallback? onPixelsCopied, // must ensure onPixelsCopied is called no matter this function succeeds
   bool allowUpscaling = true,
 }) async {
   if (targetWidth != null) {
     assert(allowUpscaling || targetWidth <= width);
     if (!(allowUpscaling || targetWidth <= width)) {
       print("not allow upscaling but targetWidth > width");

----------------------------------------

File: flutter/lib/web/bridge.dart
Status: modified
Changes: +30 -2
Diff:
@@ -142,7 +142,10 @@ class RustdeskImpl {
   }
 
   Future<void> sessionSend2Fa(
-      {required UuidValue sessionId, required String code, dynamic hint}) {
+      {required UuidValue sessionId,
+      required String code,
+      required bool trustThisDevice,
+      dynamic hint}) {
     return Future(() => js.context.callMethod('setByName', ['send_2fa', code]));
   }
 
@@ -1412,7 +1415,7 @@ class RustdeskImpl {
     return false;
   }
 
-  bool mainHideDocker({dynamic hint}) {

----------------------------------------

File: flutter/macos/Runner/Info.plist
Status: modified
Changes: +2 -0
Diff:
@@ -45,5 +45,7 @@
 	<string>Record the sound from microphone for the purpose of the remote desktop.</string>
 	<key>NSPrincipalClass</key>
 	<string>NSApplication</string>
+    <key>LSUIElement</key>
+    <string>1</string>
 </dict>
 </plist>

----------------------------------------

File: flutter/ndk_x86.sh
Status: added
Changes: +2 -0
Diff:
@@ -0,0 +1,2 @@
+#!/usr/bin/env bash
+cargo ndk --platform 21 --target i686-linux-android build --release --features flutter

----------------------------------------

File: flutter/pubspec.lock
Status: modified
Changes: +3 -3
Diff:
@@ -335,7 +335,7 @@ packages:
     description:
       path: "."
       ref: HEAD
-      resolved-ref: "336308d86ec8b9640504a371b50ba500eb779363"
+      resolved-ref: "80b063b9d4e015f62e17f42a5aa0b3d20a365926"
       url: "https://github.com/rustdesk-org/rustdesk_desktop_multi_window"
     source: git
     version: "0.1.0"
@@ -377,7 +377,7 @@ packages:

----------------------------------------

File: flutter/pubspec.yaml
Status: modified
Changes: +3 -3
Diff:
@@ -16,7 +16,7 @@ publish_to: "none" # Remove this line if you wish to publish to pub.dev
 # Read more about iOS versioning at
 # https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CoreFoundationKeys.html
 # 1.1.9-1 works for android, but for ios it becomes 1.1.91, need to set it to 1.1.9-a.1 for iOS, will get 1.1.9.1, but iOS store not allow 4 numbers
-version: 1.2.7+46
+version: 1.3.0+46
 
 environment:
   sdk: '^3.1.0'
@@ -92,14 +92,14 @@ dependencies:

----------------------------------------

File: libs/clipboard/docs/assets/win_A_B.png
Status: modified
Changes: +0 -0

----------------------------------------

File: libs/clipboard/docs/assets/win_B_A.png
Status: modified
Changes: +0 -0

----------------------------------------

File: libs/clipboard/src/platform/mod.rs
Status: modified
Changes: +3 -0
Diff:
@@ -1,3 +1,4 @@
+#[cfg(any(target_os = "linux", target_os = "macos"))]
 use crate::{CliprdrError, CliprdrServiceContext};
 
 #[cfg(target_os = "windows")]
@@ -63,8 +64,10 @@ pub fn create_cliprdr_context(
     return Ok(Box::new(DummyCliprdrContext {}) as Box<_>);
 }
 
+#[cfg(any(target_os = "linux", target_os = "macos"))]

----------------------------------------

File: libs/enigo/Cargo.toml
Status: modified
Changes: +1 -1
Diff:
@@ -23,7 +23,7 @@ serde = { version = "1.0", optional = true }
 serde_derive = { version = "1.0", optional = true }
 log = "0.4"
 rdev = { git = "https://github.com/rustdesk-org/rdev" }
-tfc = { git = "https://github.com/rustdesk-org/The-Fat-Controller" }
+tfc = { git = "https://github.com/rustdesk-org/The-Fat-Controller", branch = "history/rebase_upstream_20240722" }
 hbb_common = { path = "../hbb_common" }
 
 [features]

----------------------------------------

File: libs/hbb_common/Cargo.toml
Status: modified
Changes: +3 -3
Diff:
@@ -37,16 +37,16 @@ libc = "0.2"
 dlopen = "0.1"
 toml = "0.7"
 uuid = { version = "1.3", features = ["v4"] }
-# crash, versions >= 0.29.1 are affected by #GuillaumeGomez/sysinfo/1052
-sysinfo = { git = "https://github.com/rustdesk-org/sysinfo" }
+# new sysinfo issue: https://github.com/rustdesk/rustdesk/pull/6330#issuecomment-2270871442
+sysinfo = { git = "https://github.com/rustdesk-org/sysinfo", branch = "rlim_max" }
 thiserror = "1.0"
 httparse = "1.5"

----------------------------------------

File: libs/hbb_common/protos/message.proto
Status: modified
Changes: +24 -0
Diff:
@@ -81,10 +81,13 @@ message LoginRequest {
   uint64 session_id = 10;
   string version = 11;
   OSLogin os_login = 12;
+  string my_platform = 13;
+  bytes hwid = 14;
 }
 
 message Auth2FA {
   string code = 1;
+  bytes hwid = 2;
 }
 
 message ChatMessage { string text = 1; }
@@ -136,6 +139,7 @@ message LoginResponse {
     string error = 1;
     PeerInfo peer_info = 2;
   }
+  bool enable_trusted_devices = 3;
 }
 
 message TouchScaleUpdate {
@@ -315,13 +319,25 @@ message Hash {
   string challenge = 2;
 }

----------------------------------------

File: libs/hbb_common/src/config.rs
Status: modified
Changes: +111 -5
Diff:
@@ -10,6 +10,7 @@ use std::{
 };
 
 use anyhow::Result;
+use bytes::Bytes;
 use rand::Rng;
 use regex::Regex;
 use serde as de;
@@ -52,6 +53,7 @@ lazy_static::lazy_static! {
     static ref CONFIG: RwLock<Config> = RwLock::new(Config::load());
     static ref CONFIG2: RwLock<Config2> = RwLock::new(Config2::load());
     static ref LOCAL_CONFIG: RwLock<LocalConfig> = RwLock::new(LocalConfig::load());
+    static ref TRUSTED_DEVICES: RwLock<(Vec<TrustedDevice>, bool)> = Default::default();
     static ref ONLINE: Mutex<HashMap<String, i64>> = Default::default();
     pub static ref PROD_RENDEZVOUS_SERVER: RwLock<String> = RwLock::new(match option_env!("RENDEZVOUS_SERVER") {
         Some(key) if !key.is_empty() => key,
@@ -69,7 +71,7 @@ lazy_static::lazy_static! {
     pub static ref DEFAULT_LOCAL_SETTINGS: RwLock<HashMap<String, String>> = Default::default();
     pub static ref OVERWRITE_LOCAL_SETTINGS: RwLock<HashMap<String, String>> = Default::default();
     pub static ref HARD_SETTINGS: RwLock<HashMap<String, String>> = Default::default();
-    pub static ref BUILDIN_SETTINGS: RwLock<HashMap<String, String>> = Default::default();
+    pub static ref BUILTIN_SETTINGS: RwLock<HashMap<String, String>> = Default::default();
 }
 
 lazy_static::lazy_static! {
@@ -208,6 +210,10 @@ pub struct Config2 {
     nat_type: i32,
     #[serde(default, deserialize_with = "deserialize_i32")]
     serial: i32,
+    #[serde(default, deserialize_with = "deserialize_string")]
+    unlock_pin: String,
+    #[serde(default, deserialize_with = "deserialize_string")]
+    trusted_devices: String,
 
     #[serde(default)]
     socks: Option<Socks5Server>,
@@ -427,14 +433,20 @@ fn patch(path: PathBuf) -> PathBuf {
 impl Config2 {
     fn load() -> Config2 {
         let mut config = Config::load_::<Config2>("2");
+        let mut store = false;
         if let Some(mut socks) = config.socks {
-            let (password, _, store) =
+            let (password, _, store2) =
                 decrypt_str_or_original(&socks.password, PASSWORD_ENC_VERSION);
             socks.password = password;
             config.socks = Some(socks);
-            if store {
-                config.store();
-            }
+            store |= store2;
+        }
+        let (unlock_pin, _, store2) =
+            decrypt_str_or_original(&config.unlock_pin, PASSWORD_ENC_VERSION);
+        config.unlock_pin = unlock_pin;
+        store |= store2;
+        if store {
+            config.store();
         }
         config
     }
@@ -450,6 +462,8 @@ impl Config2 {
                 encrypt_str_or_original(&socks.password, PASSWORD_ENC_VERSION, ENCRYPT_MAX_LEN);
             config.socks = Some(socks);
         }
+        config.unlock_pin =
+            encrypt_str_or_original(&config.unlock_pin, PASSWORD_ENC_VERSION, ENCRYPT_MAX_LEN);
         Config::store_(&config, "2");
     }
 

----------------------------------------

File: libs/hbb_common/src/fs.rs
Status: modified
Changes: +15 -0
Diff:
@@ -838,6 +838,21 @@ pub fn create_dir(dir: &str) -> ResultType<()> {
     Ok(())
 }
 
+#[inline]
+pub fn rename_file(path: &str, new_name: &str) -> ResultType<()> {
+    let path = std::path::Path::new(&path);
+    if path.exists() {
+        let dir = path
+            .parent()

----------------------------------------

File: libs/portable/Cargo.toml
Status: modified
Changes: +1 -1
Diff:
@@ -1,6 +1,6 @@
 [package]
 name = "rustdesk-portable-packer"
-version = "1.2.7"
+version = "1.3.0"
 edition = "2021"
 description = "RustDesk Remote Desktop"
 

----------------------------------------

File: libs/scrap/Cargo.toml
Status: modified
Changes: +2 -2
Diff:
@@ -21,7 +21,7 @@ cfg-if = "1.0"
 num_cpus = "1.15"
 lazy_static = "1.4"
 hbb_common = { path = "../hbb_common" }
-webm = { git = "https://github.com/21pages/rust-webm" }
+webm = { git = "https://github.com/rustdesk-org/rust-webm" }
 serde = {version="1.0", features=["derive"]}
 
 [dependencies.winapi]
@@ -59,7 +59,7 @@ gstreamer-app = { version = "0.16", features = ["v1_10"], optional = true }

----------------------------------------

File: libs/scrap/build.rs
Status: modified
Changes: +47 -0
Diff:
@@ -188,6 +188,52 @@ fn gen_vcpkg_package(package: &str, ffi_header: &str, generated: &str, regex: &s
     generate_bindings(&ffi_header, &includes, &ffi_rs, &exact_file, regex);
 }
 
+// If you have problems installing ffmpeg, you can download $VCPKG_ROOT/installed from ci
+// Linux require link in hwcodec
+/*
+fn ffmpeg() {
+    // ffmpeg
+    let target_os = std::env::var("CARGO_CFG_TARGET_OS").unwrap();
+    let target_arch = std::env::var("CARGO_CFG_TARGET_ARCH").unwrap();
+    let static_libs = vec!["avcodec", "avutil", "avformat"];
+    static_libs.iter().for_each(|lib| {
+        find_package(lib);
+    });
+    if target_os == "windows" {
+        println!("cargo:rustc-link-lib=static=libmfx");
+    }
+
+    // os

----------------------------------------

File: libs/scrap/src/android/ffi.rs
Status: modified
Changes: +4 -0
Diff:
@@ -349,6 +349,10 @@ fn init_ndk_context() -> JniResult<()> {
                 jvm.get_java_vm_pointer() as _,
                 ctx.as_obj().as_raw() as _,
             );
+            #[cfg(feature = "hwcodec")]
+            hwcodec::android::ffmpeg_set_java_vm(
+                jvm.get_java_vm_pointer() as _,
+            );
         }
         *lock = true;

----------------------------------------

File: libs/scrap/src/wayland/pipewire.rs
Status: modified
Changes: +1 -1
Diff:
@@ -593,7 +593,7 @@ pub fn request_remote_desktop() -> Result<
         }
     }
     Err(Box::new(DBusError(
-        "Failed to obtain screen capture.".into(),
+"Failed to obtain screen capture. You may need to upgrade the PipeWire library for better compatibility. Please check https://github.com/rustdesk/rustdesk/issues/8600#issuecomment-2254720954 for more details.".into()
     )))
 }
 

----------------------------------------

File: res/PKGBUILD
Status: modified
Changes: +1 -1
Diff:
@@ -1,5 +1,5 @@
 pkgname=rustdesk
-pkgver=1.2.7
+pkgver=1.3.0
 pkgrel=0
 epoch=
 pkgdesc=""

----------------------------------------

File: res/devices.py
Status: modified
Changes: +3 -1
Diff:
@@ -46,7 +46,7 @@ def view(
                 devices.append(device)
                 continue
             last_online = datetime.strptime(
-                device["last_online"], "%Y-%m-%dT%H:%M:%S"
+                device["last_online"].split(".")[0], "%Y-%m-%dT%H:%M:%S"
             )  # assuming date is in this format
             if (datetime.utcnow() - last_online).days >= offline_days:
                 devices.append(device)
@@ -128,6 +128,8 @@ def main():

----------------------------------------

File: res/msi/CustomActions/CustomActions.cpp
Status: modified
Changes: +11 -4
Diff:
@@ -31,6 +31,11 @@ UINT __stdcall CustomActionHello(
     return WcaFinalize(er);
 }
 
+// CAUTION: We can't simply remove the install folder here, because silent repair/upgrade will fail.
+// `RemoveInstallFolder()` is a deferred custom action, it will be executed after the files are copied.
+// `msiexec /i package.msi /qn`
+//
+// So we need to delete the files separately in install folder.
 UINT __stdcall RemoveInstallFolder(
     __in MSIHANDLE hInstall)
 {
@@ -41,6 +46,7 @@ UINT __stdcall RemoveInstallFolder(
     LPWSTR installFolder = NULL;
     LPWSTR pwz = NULL;

----------------------------------------

File: res/msi/Package/Components/Folders.wxs
Status: modified
Changes: +19 -1
Diff:
@@ -3,8 +3,26 @@
 	<?include ../Includes.wxi?>
 
 	<Fragment>
+		<!-- For compatibility with command line values from previous versions -->
+		<Property Id="INSTALLFOLDER" Secure="yes">
+      		<RegistrySearch Id="InstallFolderSearch" Root="HKCR" Key="$(var.RegKeyRoot)" Name="INSTALLFOLDER" Type="raw" />
+    	</Property>
+
+		<!-- If a property value has been passed via the command line (which includes when set from the bundle), the registry search will

----------------------------------------

File: res/msi/Package/Components/Regs.wxs
Status: modified
Changes: +6 -6
Diff:
@@ -5,24 +5,24 @@
 	<Fragment>
 		<!-- Regs for shortcuts are defined in "Fragments/ShortcutProperties.wxs" -->
 		<!-- Component that persists the property values to the registry so they are available during an upgrade/modify -->
-		<DirectoryRef Id="INSTALLFOLDER">
-			<Component Id="Product.Registry.InstallDir" Guid="3196EDA7-9AEF-4705-A0C8-E3F3ECCCB153">
+		<DirectoryRef Id="INSTALLFOLDER_INNER">
+			<Component Id="Product.Registry.InstallFolder" Guid="3196EDA7-9AEF-4705-A0C8-E3F3ECCCB153">
 				<RegistryKey Root="HKCR" Key="$(var.RegKeyRoot)">
-					<RegistryValue Type="string" Name="INSTALLFOLDER" Value="[INSTALLFOLDER]" />
+					<RegistryValue Type="string" Name="INSTALLFOLDER" Value="[INSTALLFOLDER_INNER]" />
 				</RegistryKey>
 			</Component>

----------------------------------------

File: res/msi/Package/Components/RustDesk.wxs
Status: modified
Changes: +21 -21
Diff:
@@ -4,20 +4,20 @@
 
 		<?include ../Includes.wxi?>
 
-		<DirectoryRef Id="INSTALLFOLDER" FileSource="$(var.BuildDir)">
+		<DirectoryRef Id="INSTALLFOLDER_INNER" FileSource="$(var.BuildDir)">
 			<Component Id="App.exe" Guid="620F0F69-4C17-4320-A619-495E329712A4">
 				<File Id="App.exe" Name="$(var.Product).exe" KeyPath="yes" Checksum="yes">
 					<!--<fire:FirewallException Id="AppEx" Name="$(var.Product) Service" Scope="any" IgnoreFailure="yes" />-->
 				</File>
 			</Component>
 		</DirectoryRef>
 
-		<CustomAction Id="RemoveInstallFolder.SetParam" Return="check" Property="RemoveInstallFolder" Value="[INSTALLFOLDER]" />
-		<CustomAction Id="AddFirewallRules.SetParam" Return="check" Property="AddFirewallRules" Value="1[INSTALLFOLDER]$(var.Product).exe" />
-		<CustomAction Id="RemoveFirewallRules.SetParam" Return="check" Property="RemoveFirewallRules" Value="0[INSTALLFOLDER]$(var.Product).exe" />
-		<CustomAction Id="CreateStartService.SetParam" Return="check" Property="CreateStartService" Value="$(var.Product);&quot;[INSTALLFOLDER]$(var.Product).exe&quot; --service" />
+		<CustomAction Id="RemoveInstallFolder.SetParam" Return="check" Property="RemoveInstallFolder" Value="[INSTALLFOLDER_INNER]" />
+		<CustomAction Id="AddFirewallRules.SetParam" Return="check" Property="AddFirewallRules" Value="1[INSTALLFOLDER_INNER]$(var.Product).exe" />
+		<CustomAction Id="RemoveFirewallRules.SetParam" Return="check" Property="RemoveFirewallRules" Value="0[INSTALLFOLDER_INNER]$(var.Product).exe" />
+		<CustomAction Id="CreateStartService.SetParam" Return="check" Property="CreateStartService" Value="$(var.Product);&quot;[INSTALLFOLDER_INNER]$(var.Product).exe&quot; --service" />
 		<CustomAction Id="TryStopDeleteService.SetParam" Return="check" Property="TryStopDeleteService" Value="$(var.Product)" />
-		
+
 		<CustomAction Id="LaunchApp" ExeCommand="" Return="asyncNoWait" FileRef="App.exe" />
 		<CustomAction Id="LaunchAppTray" ExeCommand=" --tray" Return="asyncNoWait" FileRef="App.exe" />
 		<Property Id="TerminateProcesses" Value="AppTest.exe" />
@@ -29,7 +29,7 @@
 		<CustomAction Id="SetPropertyServiceStop.SetParam.ConfigKey" Return="check" Property="ConfigKey" Value="stop-service" />
 		<CustomAction Id="SetPropertyServiceStop.SetParam.PropertyName" Return="check" Property="PropertyName" Value="STOP_SERVICE" />
 		<CustomAction Id="TryDeleteStartupShortcut.SetParam" Return="check" Property="ShortcutName" Value="$(var.Product) Tray" />
-		<CustomAction Id="RemoveAmyuniIdd.SetParam" Return="check" Property="RemoveAmyuniIdd" Value="[INSTALLFOLDER]" />
+		<CustomAction Id="RemoveAmyuniIdd.SetParam" Return="check" Property="RemoveAmyuniIdd" Value="[INSTALLFOLDER_INNER]" />
 		<InstallExecuteSequence>
 
 			<Custom Action="SetPropertyIsServiceRunning" After="InstallInitialize" Condition="Installed" />
@@ -40,11 +40,11 @@
 			<Custom Action="SetPropertyServiceStop.SetParam.ConfigFile" Before="SetPropertyServiceStop" Condition="NOT Installed" />
 			<Custom Action="SetPropertyServiceStop.SetParam.ConfigKey" Before="SetPropertyServiceStop" Condition="NOT Installed" />

----------------------------------------

File: res/msi/Package/Fragments/AddRemoveProperties.wxs
Status: modified
Changes: +3 -0
Diff:
@@ -25,6 +25,9 @@
 		<!--$ArpStart$-->
 		<!--$ArpEnd$-->
 
+		<!--$CustomClientPropsStart$-->
+		<!--$CustomClientPropsEnd$-->
+
 		<Property Id="APP_WINDOWS_INSTALLER">
 			<RegistrySearch Id="AppWindowsInstallerFolderSearch" Root="HKLM" Key="Software\Microsoft\Windows\CurrentVersion\Uninstall\$(var.Product)" Name="WindowsInstaller" Type="raw" />
 		</Property>

----------------------------------------

File: res/msi/Package/Fragments/ShortcutProperties.wxs
Status: modified
Changes: +20 -6
Diff:
@@ -25,11 +25,25 @@
 		</Property>
 
 		<!-- Component that persists the property values to the registry so they are available during an upgrade/modify -->
-		<DirectoryRef Id="INSTALLFOLDER">
-			<Component Id="Product.Registry.PersistedShortcutProperties" Guid="1BBAD054-6EC2-4362-BF1B-E8BDE988B597">
+		<DirectoryRef Id="INSTALLFOLDER_INNER">
+			<Component Id="Product.Registry.PersistedStartMenuShortcutProperties1" Guid="62F79BCF-3367-4ACF-950F-F8BCABACDDC0" Condition="STARTMENUSHORTCUTS = 1 OR STARTMENUSHORTCUTS = &quot;Y&quot; OR STARTMENUSHORTCUTS = &quot;y&quot;">
 				<RegistryKey Root="HKCR" Key="$(var.RegKeyRoot)">
-					<RegistryValue Type="string" Name="STARTMENUSHORTCUTS" Value="[STARTMENUSHORTCUTS]" KeyPath="yes" />
-					<RegistryValue Type="string" Name="DESKTOPSHORTCUTS" Value="[DESKTOPSHORTCUTS]" />
+					<RegistryValue Type="string" Name="STARTMENUSHORTCUTS" Value="1" KeyPath="yes" />
+				</RegistryKey>

----------------------------------------

File: res/msi/Package/Language/Package.en-us.wxl
Status: modified
Changes: +3 -0
Diff:
@@ -49,4 +49,7 @@ This file contains the declaration of all the localizable strings.
 	<String Id="AnotherAppDialogTitle" Value="Cancel installation."/>
 	<String Id="AnotherAppDialogDescription" Value="The application is installed by self-installation method, please uninstall it first."/>
 
+	<String Id="MyInstallDirDlgDesktopShortcuts" Value="Create desktop icon" />
+	<String Id="MyInstallDirDlgStartMenuShortcuts" Value="Create start menu shortcuts" />
+
 </WixLocalization>

----------------------------------------

File: res/msi/Package/Package.wxs
Status: modified
Changes: +7 -4
Diff:
@@ -18,11 +18,11 @@
 		<!-- User Interface -->
 		<WixVariable Id="WixUILicenseRtf" Value="License.rtf" />
 
-		<ui:WixUI Id="WixUI_InstallDir" InstallDirectory="INSTALLFOLDER" />
+		<ui:WixUI Id="UI_MyInstallDialog" InstallDirectory="INSTALLFOLDER_INNER" />
 		<UIRef Id="WixUI_ErrorProgressText" />
 
 		<InstallUISequence>
-			<Show Dialog="AnotherAppDialog" Before="WelcomeDlg" Condition="Not installed AND APP_WINDOWS_INSTALLER=&quot;#0&quot;"/>
+			<Show Dialog="UI_AnotherAppDialog" Before="WelcomeDlg" Condition="Not installed AND APP_WINDOWS_INSTALLER=&quot;#0&quot;"/>

----------------------------------------

File: res/msi/Package/UI/AnotherApp.wxs
Status: modified
Changes: +1 -1
Diff:
@@ -1,7 +1,7 @@
 <Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
 	<Fragment>
 		<UI>
-			<Dialog Id="AnotherAppDialog" Width="370" Height="270" Title="!(loc.ExitDialog_Title)">
+			<Dialog Id="UI_AnotherAppDialog" Width="370" Height="270" Title="!(loc.ExitDialog_Title)">
 				<Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Default="yes" Cancel="yes" Text="!(loc.WixUICancel)">
 					<Publish Event="EndDialog" Value="ErrorAbort" />
 				</Control>

----------------------------------------

File: res/msi/Package/UI/MyInstallDirDlg.wxs
Status: added
Changes: +31 -0
Diff:
@@ -0,0 +1,31 @@
+<!-- https://github.com/wixtoolset/wix/blob/ce73352b1fa1d4f9cded10a0ee410f2e786bd326/src/ext/UI/wixlib/InstallDirDlg.wxs -->
+
+<!-- Copyright (c) .NET Foundation and contributors. All rights reserved. Licensed under the Microsoft Reciprocal License. See LICENSE.TXT file in the project root for full license information. -->
+
+
+<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
+    <Fragment>
+        <UI>
+            <Dialog Id="MyInstallDirDlg" Width="370" Height="270" Title="!(loc.InstallDirDlg_Title)">

----------------------------------------

File: res/msi/Package/UI/MyInstallDlg.wxs
Status: added
Changes: +87 -0
Diff:
@@ -0,0 +1,87 @@
+<!-- From https://github.com/wixtoolset/wix/blob/ce73352b1fa1d4f9cded10a0ee410f2e786bd326/src/ext/UI/wixlib/WixUI_InstallDir.wxs -->
+
+<!-- Copyright (c) .NET Foundation and contributors. All rights reserved. Licensed under the Microsoft Reciprocal License. See LICENSE.TXT file in the project root for full license information. -->
+
+<!--
+First-time install dialog sequence:
+ - WixUI_WelcomeDlg
+ - WixUI_LicenseAgreementDlg
+ - WixUI_InstallDirDlg
+ - WixUI_VerifyReadyDlg
+ - WixUI_DiskCostDlg
+
+Maintenance dialog sequence:
+ - WixUI_MaintenanceWelcomeDlg
+ - WixUI_MaintenanceTypeDlg
+ - WixUI_InstallDirDlg
+ - WixUI_VerifyReadyDlg
+
+Patch dialog sequence:
+ - WixUI_WelcomeDlg
+ - WixUI_VerifyReadyDlg
+
+-->
+
+<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs" xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">
+    <?foreach WIXUIARCH in X86;X64;A64 ?>
+    <Fragment>
+        <UI Id="UI_MyInstallDialog_$(WIXUIARCH)">

----------------------------------------

File: res/msi/preprocess.py
Status: modified
Changes: +39 -10
Diff:
@@ -64,6 +64,12 @@ def make_parser():
     parser.add_argument(
         "-c", "--custom", action="store_true", help="Is custom client", default=False
     )
+    parser.add_argument(
+        "--conn-type",
+        type=str,
+        default="",
+        help='Connection type, e.g. "incoming", "outgoing". Default is empty, means incoming-outgoing',
+    )
     parser.add_argument(
         "--app-name", type=str, default="RustDesk", help="The app name."
     )
@@ -84,7 +90,7 @@ def make_parser():
 
 
 def read_lines_and_start_index(file_path, tag_start, tag_end):
-    with open(file_path, "r") as f:
+    with open(file_path, "r", encoding="utf-8") as f:
         lines = f.readlines()
     index_start = -1
     index_end = -1
@@ -174,11 +180,11 @@ def func(lines, index_start):
 def replace_app_name_in_langs(app_name):
     langs_dir = Path(sys.argv[0]).parent.joinpath("Package/Language")
     for file_path in langs_dir.glob("*.wxl"):
-        with open(file_path, "r") as f:
+        with open(file_path, "r", encoding="utf-8") as f:
             lines = f.readlines()
         for i, line in enumerate(lines):
             lines[i] = line.replace("RustDesk", app_name)
-        with open(file_path, "w") as f:
+        with open(file_path, "w", encoding="utf-8") as f:
             f.writelines(lines)
 
 
@@ -295,7 +301,7 @@ def func(lines, index_start):
             f'{indent}<RegistryValue Type="string" Name="DisplayName" Value="{args.app_name}" />\n'
         )
         lines_new.append(
-            f'{indent}<RegistryValue Type="string" Name="DisplayIcon" Value="[INSTALLFOLDER]{args.app_name}.exe" />\n'
+            f'{indent}<RegistryValue Type="string" Name="DisplayIcon" Value="[INSTALLFOLDER_INNER]{args.app_name}.exe" />\n'
         )
         lines_new.append(

----------------------------------------

File: res/rpm-flutter-suse.spec
Status: modified
Changes: +1 -1
Diff:
@@ -1,5 +1,5 @@
 Name:       rustdesk
-Version:    1.2.7
+Version:    1.3.0
 Release:    0
 Summary:    RPM package
 License:    GPL-3.0

----------------------------------------

File: res/rpm-flutter.spec
Status: modified
Changes: +1 -1
Diff:
@@ -1,5 +1,5 @@
 Name:       rustdesk
-Version:    1.2.7
+Version:    1.3.0
 Release:    0
 Summary:    RPM package
 License:    GPL-3.0

----------------------------------------

File: res/rpm.spec
Status: modified
Changes: +1 -1
Diff:
@@ -1,5 +1,5 @@
 Name:       rustdesk
-Version:    1.2.7
+Version:    1.3.0
 Release:    0
 Summary:    RPM package
 License:    GPL-3.0

----------------------------------------

File: res/users.py
Status: added
Changes: +123 -0
Diff:
@@ -0,0 +1,123 @@
+#!/usr/bin/env python3
+
+import requests
+import argparse
+from datetime import datetime, timedelta
+
+
+def view(
+    url,
+    token,
+    name=None,
+    group_name=None,
+):
+    headers = {"Authorization": f"Bearer {token}"}
+    pageSize = 30
+    params = {
+        "name": name,
+        "group_name": group_name,
+    }
+
+    params = {
+        k: "%" + v + "%" if (v != "-" and "%" not in v) else v
+        for k, v in params.items()
+        if v is not None
+    }
+    params["pageSize"] = pageSize
+
+    users = []
+
+    current = 1
+
+    while True:
+        params["current"] = current
+        response = requests.get(f"{url}/api/users", headers=headers, params=params)
+        response_json = response.json()
+
+        data = response_json.get("data", [])
+        users.extend(data)
+
+        total = response_json.get("total", 0)

----------------------------------------

File: res/vcpkg/aom/aom-avx2.diff
Status: added
Changes: +60 -0
Diff:
@@ -0,0 +1,60 @@
+diff --git a/build/cmake/cpu.cmake b/build/cmake/cpu.cmake
+index acebe20..8c67d89 100644
+--- a/build/cmake/cpu.cmake
++++ b/build/cmake/cpu.cmake
+@@ -120,6 +120,19 @@ elseif("${AOM_TARGET_CPU}" MATCHES "^x86")
+     set(RTCD_ARCH_X86_64 "yes")
+   endif()
+ 
++  # AVX2 requires __m256i definition starting v3.9.0
++
++  if(ENABLE_AVX2)
++    aom_check_source_compiles("x86_64_avx2_m256i_available" "
++#include <emmintrin.h>
++#ifndef __m256i
++#error 1
++#endif" HAVE_AVX2_M256I)
++    if(HAVE_AVX2_M256I EQUAL 0)
++      set(ENABLE_AVX2 0)
++    endif()

----------------------------------------

File: res/vcpkg/aom/portfile.cmake
Status: modified
Changes: +1 -0
Diff:
@@ -14,6 +14,7 @@ vcpkg_from_git(
     REF 8ad484f8a18ed1853c094e7d3a4e023b2a92df28 # 3.9.1
     PATCHES
         aom-uninitialized-pointer.diff
+        aom-avx2.diff
         # Can be dropped when https://bugs.chromium.org/p/aomedia/issues/detail?id=3029 is merged into the upstream
         aom-install.diff
 )

----------------------------------------

File: res/vcpkg/ffmpeg/0002-fix-msvc-link.patch
Status: added
Changes: +11 -0
Diff:
@@ -0,0 +1,11 @@
+diff --git a/configure b/configure
+--- a/configure
++++ b/configure
+@@ -6162,6 +6162,7 @@ EOF
+         test -n "$extern_prefix"  && append X86ASMFLAGS "-DPREFIX"
+         case "$objformat" in
+             elf*) enabled debug && append X86ASMFLAGS $x86asm_debug ;;
++            win*) enabled debug && append X86ASMFLAGS "-g" ;;
+         esac

----------------------------------------

File: res/vcpkg/ffmpeg/0003-fix-windowsinclude.patch
Status: added
Changes: +13 -0
Diff:
@@ -0,0 +1,13 @@
+diff --git a/fftools/cmdutils.c b/fftools/cmdutils.c
+--- a/fftools/cmdutils.c
++++ b/fftools/cmdutils.c
+@@ -51,6 +51,8 @@
+ #include "fopen_utf8.h"
+ #include "opt_common.h"
+ #ifdef _WIN32
++#define _WIN32_WINNT 0x0502
++#define WIN32_LEAN_AND_MEAN

----------------------------------------

File: res/vcpkg/ffmpeg/0005-fix-nasm.patch
Status: added
Changes: +55 -0
Diff:
@@ -0,0 +1,55 @@
+diff --git a/libavcodec/x86/Makefile b/libavcodec/x86/Makefile
+--- a/libavcodec/x86/Makefile
++++ b/libavcodec/x86/Makefile
+@@ -158,6 +158,8 @@ X86ASM-OBJS-$(CONFIG_ALAC_DECODER)     += x86/alacdsp.o
+ X86ASM-OBJS-$(CONFIG_APNG_DECODER)     += x86/pngdsp.o
+ X86ASM-OBJS-$(CONFIG_CAVS_DECODER)     += x86/cavsidct.o
++ifdef ARCH_X86_64
+ X86ASM-OBJS-$(CONFIG_CFHD_ENCODER)     += x86/cfhdencdsp.o
++endif
+ X86ASM-OBJS-$(CONFIG_CFHD_DECODER)     += x86/cfhddsp.o
+ X86ASM-OBJS-$(CONFIG_DCA_DECODER)      += x86/dcadsp.o x86/synth_filter.o
+ X86ASM-OBJS-$(CONFIG_DIRAC_DECODER)    += x86/diracdsp.o                \
+@@ -175,15 +177,21 @@                                           x86/hevc_sao_10bit.o
+ X86ASM-OBJS-$(CONFIG_JPEG2000_DECODER) += x86/jpeg2000dsp.o
+ X86ASM-OBJS-$(CONFIG_LSCR_DECODER)     += x86/pngdsp.o
++ifdef ARCH_X86_64
+ X86ASM-OBJS-$(CONFIG_MLP_DECODER)      += x86/mlpdsp.o

----------------------------------------

File: res/vcpkg/ffmpeg/0012-Fix-ssl-110-detection.patch
Status: added
Changes: +14 -0
Diff:
@@ -0,0 +1,14 @@
+diff --git a/configure b/configure
+index 2be953f7e7..e075949ffc 100755
+--- a/configure
++++ b/configure
+@@ -6497,6 +6497,7 @@ enabled openssl           && { { check_pkg_config openssl "openssl >= 3.0.0
+                                  { enabled gplv3 || ! enabled gpl || enabled nonfree || die "ERROR: OpenSSL >=3.0.0 requires --enable-version3"; }; } ||
+                                { enabled gpl && ! enabled nonfree && die "ERROR: OpenSSL <3.0.0 is incompatible with the gpl"; } ||
+                                check_pkg_config openssl openssl openssl/ssl.h OPENSSL_init_ssl ||
+                                check_pkg_config openssl openssl openssl/ssl.h SSL_library_init ||

----------------------------------------

File: res/vcpkg/ffmpeg/0013-define-WINVER.patch
Status: added
Changes: +15 -0
Diff:
@@ -0,0 +1,15 @@
+diff --color -Naur src_old/libavcodec/mf_utils.c src/libavcodec/mf_utils.c
+--- src_old/libavcodec/mf_utils.c	2020-07-11 05:26:17.000000000 +0700
++++ src/libavcodec/mf_utils.c	2020-11-13 12:55:57.226976400 +0700
+@@ -22,6 +22,11 @@
+ #define _WIN32_WINNT 0x0602
+ #endif
+ 
++#if !defined(WINVER) || WINVER < 0x0602
++#undef WINVER

----------------------------------------

File: res/vcpkg/ffmpeg/5.1/0001-avcodec-amfenc-add-query_timeout-option-for-h264-hev.patch
Status: added
Changes: +71 -0
Diff:
@@ -0,0 +1,71 @@
+From f0b694749b38b2cfd94df4eed10e667342c234e5 Mon Sep 17 00:00:00 2001
+From: 21pages <pages21@163.com>
+Date: Sat, 24 Feb 2024 15:33:24 +0800
+Subject: [PATCH 1/2] avcodec/amfenc: add query_timeout option for h264/hevc
+
+Signed-off-by: 21pages <pages21@163.com>
+---
+ libavcodec/amfenc.h      | 1 +
+ libavcodec/amfenc_h264.c | 4 ++++
+ libavcodec/amfenc_hevc.c | 4 ++++
+ 3 files changed, 9 insertions(+)
+
+diff --git a/libavcodec/amfenc.h b/libavcodec/amfenc.h
+index 1ab98d2f78..e92120ea39 100644
+--- a/libavcodec/amfenc.h
++++ b/libavcodec/amfenc.h
+@@ -87,6 +87,7 @@ typedef struct AmfContext {
+     int                 quality;
+     int                 b_frame_delta_qp;
+     int                 ref_b_frame_delta_qp;
++    int64_t             query_timeout;
+ 
+     // Dynamic options, can be set after Init() call

----------------------------------------

File: res/vcpkg/ffmpeg/5.1/0002-libavcodec-amfenc-reconfig-when-bitrate-change.patch
Status: added
Changes: +71 -0
Diff:
@@ -0,0 +1,71 @@
+From 4d0d20d96ad458cfec0444b9be0182ca6085ee0c Mon Sep 17 00:00:00 2001
+From: 21pages <pages21@163.com>
+Date: Sat, 24 Feb 2024 16:02:44 +0800
+Subject: [PATCH 2/2] libavcodec/amfenc: reconfig when bitrate change
+
+Signed-off-by: 21pages <pages21@163.com>
+---
+ libavcodec/amfenc.c | 20 ++++++++++++++++++++
+ libavcodec/amfenc.h |  1 +
+ 2 files changed, 21 insertions(+)
+
+diff --git a/libavcodec/amfenc.c b/libavcodec/amfenc.c
+index a033e1220e..3eab01a903 100644
+--- a/libavcodec/amfenc.c
++++ b/libavcodec/amfenc.c
+@@ -222,6 +222,7 @@ static int amf_init_context(AVCodecContext *avctx)
+ 
+     ctx->hwsurfaces_in_queue = 0;
+     ctx->hwsurfaces_in_queue_max = 16;
++    ctx->av_bitrate = avctx->bit_rate;
+ 
+     // configure AMF logger
+     // the return of these functions indicates old state and do not affect behaviour

----------------------------------------

File: res/vcpkg/ffmpeg/5.1/0003-use-release-7.0-s-qsvenc-update_bitrate.patch
Status: added
Changes: +95 -0
Diff:
@@ -0,0 +1,95 @@
+From afe89a70f6bc7ebd0a6a0a31101801b88cbd60ee Mon Sep 17 00:00:00 2001
+From: 21pages <pages21@163.com>
+Date: Sun, 5 May 2024 12:45:23 +0800
+Subject: [PATCH] use release/7.0's update_bitrate
+
+Signed-off-by: 21pages <pages21@163.com>
+---
+ libavcodec/qsvenc.c | 39 +++++++++++++++++++++++++++++++++++++++
+ libavcodec/qsvenc.h |  6 ++++++
+ 2 files changed, 45 insertions(+)
+
+diff --git a/libavcodec/qsvenc.c b/libavcodec/qsvenc.c
+index 2382c2f5f7..9b34f37eb3 100644
+--- a/libavcodec/qsvenc.c
++++ b/libavcodec/qsvenc.c
+@@ -714,6 +714,11 @@ static int init_video_param(AVCodecContext *avctx, QSVEncContext *q)
+     brc_param_multiplier       = (FFMAX(FFMAX3(target_bitrate_kbps, max_bitrate_kbps, buffer_size_in_kilobytes),
+                                   initial_delay_in_kilobytes) + 0x10000) / 0x10000;
+ 
++    q->old_rc_buffer_size = avctx->rc_buffer_size;
++    q->old_rc_initial_buffer_occupancy = avctx->rc_initial_buffer_occupancy;
++    q->old_bit_rate = avctx->bit_rate;
++    q->old_rc_max_rate = avctx->rc_max_rate;
++
+     switch (q->param.mfx.RateControlMethod) {
+     case MFX_RATECONTROL_CBR:
+     case MFX_RATECONTROL_VBR:
+@@ -1657,6 +1662,39 @@ static int update_qp(AVCodecContext *avctx, QSVEncContext *q,
+     return updated;
+ }
+ 

----------------------------------------

File: res/vcpkg/ffmpeg/5.1/0004-amf-colorspace.patch
Status: added
Changes: +161 -0
Diff:
@@ -0,0 +1,161 @@
+From 8fd62e4ecd058b09abf8847be5fbbf0eef44a90f Mon Sep 17 00:00:00 2001
+From: 21pages <sunboeasy@gmail.com>
+Date: Tue, 16 Jul 2024 14:58:33 +0800
+Subject: [PATCH] amf colorspace
+
+Signed-off-by: 21pages <sunboeasy@gmail.com>
+---
+ libavcodec/amfenc.h      |  1 +
+ libavcodec/amfenc_h264.c | 39 +++++++++++++++++++++++++++++++++
+ libavcodec/amfenc_hevc.c | 47 ++++++++++++++++++++++++++++++++++++++++
+ 3 files changed, 87 insertions(+)
+
+diff --git a/libavcodec/amfenc.h b/libavcodec/amfenc.h
+index 31172645f2..493e01603d 100644
+--- a/libavcodec/amfenc.h
++++ b/libavcodec/amfenc.h
+@@ -23,6 +23,7 @@
+ 
+ #include <AMF/components/VideoEncoderVCE.h>
+ #include <AMF/components/VideoEncoderHEVC.h>
++#include <AMF/components/ColorSpace.h>
+ 
+ #include "libavutil/fifo.h"
+ 
+diff --git a/libavcodec/amfenc_h264.c b/libavcodec/amfenc_h264.c
+index f55dbc80f0..5a6b6e164f 100644
+--- a/libavcodec/amfenc_h264.c
++++ b/libavcodec/amfenc_h264.c
+@@ -139,6 +139,9 @@ static av_cold int amf_encode_init_h264(AVCodecContext *avctx)
+     AMFRate                          framerate;
+     AMFSize                          framesize = AMFConstructSize(avctx->width, avctx->height);
+     int                              deblocking_filter = (avctx->flags & AV_CODEC_FLAG_LOOP_FILTER) ? 1 : 0;
++    amf_int64                        color_depth;
++    amf_int64                        color_profile;
++    enum                             AVPixelFormat pix_fmt;
+ 
+     if (avctx->framerate.num > 0 && avctx->framerate.den > 0) {
+         framerate = AMFConstructRate(avctx->framerate.num, avctx->framerate.den);
+@@ -199,11 +202,47 @@ static av_cold int amf_encode_init_h264(AVCodecContext *avctx)
+         AMF_ASSIGN_PROPERTY_RATIO(res, ctx->encoder, AMF_VIDEO_ENCODER_ASPECT_RATIO, ratio);
+     }
+ 
++    color_profile = AMF_VIDEO_CONVERTER_COLOR_PROFILE_UNKNOWN;
+     /// Color Range (Partial/TV/MPEG or Full/PC/JPEG)
+     if (avctx->color_range == AVCOL_RANGE_JPEG) {
+         AMF_ASSIGN_PROPERTY_BOOL(res, ctx->encoder, AMF_VIDEO_ENCODER_FULL_RANGE_COLOR, 1);
++        switch (avctx->colorspace) {
++        case AVCOL_SPC_SMPTE170M:
++            color_profile = AMF_VIDEO_CONVERTER_COLOR_PROFILE_FULL_601;
++            break;
++        case AVCOL_SPC_BT709:
++            color_profile = AMF_VIDEO_CONVERTER_COLOR_PROFILE_FULL_709;
++            break;

----------------------------------------

File: res/vcpkg/ffmpeg/7.0/0001-android-mediacodec-encode-align-64.patch
Status: added
Changes: +40 -0
Diff:
@@ -0,0 +1,40 @@
+From be3d9d8092720bbe4239212648d2e9c4ffd7f40c Mon Sep 17 00:00:00 2001
+From: 21pages <pages21@163.com>
+Date: Wed, 22 May 2024 17:09:28 +0800
+Subject: [PATCH] android mediacodec encode align 64
+
+Signed-off-by: 21pages <pages21@163.com>
+---
+ libavcodec/mediacodecenc.c | 11 ++++++-----
+ 1 file changed, 6 insertions(+), 5 deletions(-)
+
+diff --git a/libavcodec/mediacodecenc.c b/libavcodec/mediacodecenc.c
+index 984014f1b1..8dcd3dcd64 100644

----------------------------------------

File: res/vcpkg/ffmpeg/build.sh.in
Status: added
Changes: +152 -0
Diff:
@@ -0,0 +1,152 @@
+#!/usr/bin/env bash
+
+set -e
+
+export PATH="$PATH:/usr/bin"
+
+command -v cygpath >/dev/null && have_cygpath=1
+
+cygpath() {
+    if [ -n "$have_cygpath" ]; then
+        command cygpath "$@"
+    else
+        eval _p='$'$#
+        printf '%s\n' "$_p"
+    fi
+}
+
+move_binary() {
+    SOURCE=$1
+    TARGET=$2
+    BINARY=$3
+
+    # run lipo over the command to check whether it really
+    # is a binary that we need to merge architectures
+    lipo $SOURCE/$BINARY -info &> /dev/null || return 0
+
+    # get the directory name the file is in
+    DIRNAME=$(dirname $BINARY)
+
+    # ensure the directory to move the binary to exists
+    mkdir -p $TARGET/$DIRNAME
+
+    # now finally move the binary
+    mv $SOURCE/$BINARY $TARGET/$BINARY
+}
+
+move_binaries() {
+    SOURCE=$1
+    TARGET=$2
+
+    [ ! -d $SOURCE ] && return 0
+    pushd $SOURCE
+
+    for BINARY in $(find . -type f); do
+        move_binary $SOURCE $TARGET $BINARY
+    done
+
+    popd
+}
+

----------------------------------------

File: res/vcpkg/ffmpeg/portfile.cmake
Status: added
Changes: +689 -0
Diff:
@@ -0,0 +1,689 @@
+if(VCPKG_TARGET_IS_WINDOWS OR VCPKG_TARGET_IS_LINUX)
+    set(FF_VERSION "n5.1.5")
+    set(FF_SHA512 "a933f18e53207ccc277b42c9a68db00f31cefec555e6d5d7c57db3409023b2c38fd93ebe2ccfcd17ba2397adb912e93f2388241ca970b7d8bd005ccfe86d5679")
+else()
+    set(FF_VERSION "n7.0.1")
+    set(FF_SHA512 "1212ebcb78fdaa103b0304373d374e41bf1fe680e1fa4ce0f60624857491c26b4dda004c490c3ef32d4a0e10f42ae6b54546f9f318e2dcfbaa116117f687bc88")
+endif()
+
+vcpkg_from_github(
+    OUT_SOURCE_PATH SOURCE_PATH
+    REPO ffmpeg/ffmpeg
+    REF "${FF_VERSION}"
+    SHA512 "${FF_SHA512}"
+    HEAD_REF master
+    PATCHES
+    0002-fix-msvc-link.patch # upstreamed in future version
+    0003-fix-windowsinclude.patch
+    0005-fix-nasm.patch # upstreamed in future version
+    0012-Fix-ssl-110-detection.patch
+    0013-define-WINVER.patch
+)
+
+if(VCPKG_TARGET_IS_WINDOWS OR VCPKG_TARGET_IS_LINUX)
+    vcpkg_apply_patches(
+        SOURCE_PATH ${SOURCE_PATH}
+        PATCHES
+            ${CMAKE_CURRENT_LIST_DIR}/5.1/0001-avcodec-amfenc-add-query_timeout-option-for-h264-hev.patch
+            ${CMAKE_CURRENT_LIST_DIR}/5.1/0002-libavcodec-amfenc-reconfig-when-bitrate-change.patch
+            ${CMAKE_CURRENT_LIST_DIR}/5.1/0003-use-release-7.0-s-qsvenc-update_bitrate.patch
+            ${CMAKE_CURRENT_LIST_DIR}/5.1/0004-amf-colorspace.patch
+    )
+elseif(VCPKG_TARGET_IS_ANDROID)
+    vcpkg_apply_patches(
+        SOURCE_PATH ${SOURCE_PATH}
+        PATCHES
+            ${CMAKE_CURRENT_LIST_DIR}/7.0/0001-android-mediacodec-encode-align-64.patch
+    )
+endif()
+
+if(SOURCE_PATH MATCHES " ")
+    message(FATAL_ERROR "Error: ffmpeg will not build with spaces in the path. Please use a directory with no spaces")
+endif()
+
+if(NOT VCPKG_TARGET_ARCHITECTURE STREQUAL "wasm32")
+    vcpkg_find_acquire_program(NASM)
+    get_filename_component(NASM_EXE_PATH "${NASM}" DIRECTORY)
+    vcpkg_add_to_path("${NASM_EXE_PATH}")
+endif()
+
+set(OPTIONS "\
+--disable-shared \
+--enable-static \
+--enable-pic \
+--disable-everything \
+--disable-programs \
+--disable-doc \
+--disable-htmlpages \
+--disable-manpages \
+--disable-podpages \
+--disable-txtpages \
+--disable-network \
+--disable-appkit \
+--disable-coreimage \
+--disable-metal \
+--disable-sdl2 \
+--disable-securetransport \
+--disable-vulkan \
+--disable-audiotoolbox \
+--disable-v4l2-m2m \
+--disable-debug \
+--disable-valgrind-backtrace \
+--disable-large-tests \
+--disable-avdevice \
+--enable-avcodec \
+--enable-avformat \
+--disable-avfilter \
+--disable-swresample \
+--disable-swscale \
+--disable-postproc \
+--enable-decoder=h264 \
+--enable-decoder=hevc \
+--enable-parser=h264 \
+--enable-parser=hevc \
+--enable-bsf=h264_mp4toannexb \
+--enable-bsf=hevc_mp4toannexb  \
+--enable-bsf=h264_metadata \
+--enable-bsf=hevc_metadata \
+--enable-muxer=mp4 \
+--enable-protocol=file \
+")
+
+if(VCPKG_HOST_IS_WINDOWS)
+    vcpkg_acquire_msys(MSYS_ROOT PACKAGES automake1.16)
+    set(SHELL "${MSYS_ROOT}/usr/bin/bash.exe")
+    vcpkg_add_to_path("${MSYS_ROOT}/usr/share/automake-1.16")
+    string(APPEND OPTIONS " --pkg-config=${CURRENT_HOST_INSTALLED_DIR}/tools/pkgconf/pkgconf${VCPKG_HOST_EXECUTABLE_SUFFIX}")
+else()
+    find_program(SHELL bash)
+endif()
+
+if(VCPKG_TARGET_IS_LINUX)
+    string(APPEND OPTIONS  "\
+--target-os=linux \
+--enable-pthreads \
+")
+    if(VCPKG_TARGET_ARCHITECTURE STREQUAL "arm")
+    else()
+        string(APPEND OPTIONS  "\
+--enable-cuda \
+--enable-ffnvcodec \
+--enable-encoder=h264_nvenc \
+--enable-encoder=hevc_nvenc \
+--enable-hwaccel=h264_nvdec \
+--enable-hwaccel=hevc_nvdec \
+--enable-amf  \
+--enable-encoder=h264_amf \
+--enable-encoder=hevc_amf \
+--enable-hwaccel=h264_vaapi \
+--enable-hwaccel=hevc_vaapi \
+--enable-encoder=h264_vaapi \
+--enable-encoder=hevc_vaapi \
+")
+        if(VCPKG_TARGET_ARCHITECTURE STREQUAL "x64")
+            string(APPEND OPTIONS  "\
+    --enable-cuda_llvm \
+")
+        endif()
+    endif()
+elseif(VCPKG_TARGET_IS_WINDOWS)
+    string(APPEND OPTIONS "\
+--target-os=win32 \
+--toolchain=msvc \
+--enable-gpl \
+--enable-d3d11va \
+--enable-cuda \
+--enable-ffnvcodec \
+--enable-hwaccel=h264_nvdec \
+--enable-hwaccel=hevc_nvdec \
+--enable-hwaccel=h264_d3d11va \
+--enable-hwaccel=hevc_d3d11va \
+--enable-hwaccel=h264_d3d11va2 \
+--enable-hwaccel=hevc_d3d11va2 \
+--enable-amf \
+--enable-encoder=h264_amf \
+--enable-encoder=hevc_amf \
+--enable-encoder=h264_nvenc \
+--enable-encoder=hevc_nvenc \
+--enable-libmfx \
+--enable-encoder=h264_qsv \
+--enable-encoder=hevc_qsv \
+")    
+    if(VCPKG_TARGET_ARCHITECTURE STREQUAL "x86")
+        set(LIB_MACHINE_ARG /machine:x86)
+        string(APPEND OPTIONS " --arch=i686 --enable-cross-compile")
+    elseif(VCPKG_TARGET_ARCHITECTURE STREQUAL "x64")
+        set(LIB_MACHINE_ARG /machine:x64)
+        string(APPEND OPTIONS " --arch=x86_64")
+    else()
+        message(FATAL_ERROR "Unsupported target architecture")
+    endif()
+elseif(VCPKG_TARGET_IS_OSX)
+    string(APPEND OPTIONS "\
+--disable-autodetect \
+--enable-videotoolbox \
+--enable-encoder=h264_videotoolbox,hevc_videotoolbox \
+--enable-hwaccel=h264_videotoolbox,hevc_videotoolbox \
+")
+elseif(VCPKG_TARGET_IS_IOS)
+    string(APPEND OPTIONS "\
+--arch=arm64 \
+--disable-autodetect \
+--disable-hwaccels \
+--disable-encoders \
+--disable-videotoolbox \
+--extra-cflags=\"-arch arm64 -mios-version-min=8.0 -fembed-bitcode\" \
+--extra-ldflags=\"-arch arm64 -mios-version-min=8.0 -fembed-bitcode\" \
+")
+elseif(VCPKG_CMAKE_SYSTEM_NAME STREQUAL "Android")
+    string(APPEND OPTIONS "\
+--target-os=android \
+--disable-asm \
+--enable-jni \
+--enable-mediacodec \
+--disable-hwaccels \
+--enable-encoder=h264_mediacodec \
+--enable-encoder=hevc_mediacodec \
+--enable-decoder=h264_mediacodec \
+--enable-decoder=hevc_mediacodec \
+")
+endif()
+
+if(VCPKG_TARGET_IS_OSX)
+    list(JOIN VCPKG_OSX_ARCHITECTURES " " OSX_ARCHS)
+    list(LENGTH VCPKG_OSX_ARCHITECTURES OSX_ARCH_COUNT)
+endif()
+
+vcpkg_cmake_get_vars(cmake_vars_file)
+include("${cmake_vars_file}")
+
+if(VCPKG_DETECTED_MSVC)
+    string(APPEND OPTIONS " --disable-inline-asm") # clang-cl has inline assembly but this leads to undefined symbols.
+    set(OPTIONS "--toolchain=msvc ${OPTIONS}")
+
+    # This is required because ffmpeg depends upon optimizations to link correctly
+    string(APPEND VCPKG_COMBINED_C_FLAGS_DEBUG " -O2")
+    string(REGEX REPLACE "(^| )-RTC1( |$)" " " VCPKG_COMBINED_C_FLAGS_DEBUG "${VCPKG_COMBINED_C_FLAGS_DEBUG}")
+    string(REGEX REPLACE "(^| )-Od( |$)" " " VCPKG_COMBINED_C_FLAGS_DEBUG "${VCPKG_COMBINED_C_FLAGS_DEBUG}")
+    string(REGEX REPLACE "(^| )-Ob0( |$)" " " VCPKG_COMBINED_C_FLAGS_DEBUG "${VCPKG_COMBINED_C_FLAGS_DEBUG}")
+endif()
+
+string(APPEND VCPKG_COMBINED_C_FLAGS_DEBUG " -I \"${CURRENT_INSTALLED_DIR}/include\"")
+string(APPEND VCPKG_COMBINED_C_FLAGS_RELEASE " -I \"${CURRENT_INSTALLED_DIR}/include\"")
+
+# # Setup vcpkg toolchain
+set(prog_env "")
+
+if(VCPKG_DETECTED_CMAKE_C_COMPILER)
+    get_filename_component(CC_path "${VCPKG_DETECTED_CMAKE_C_COMPILER}" DIRECTORY)
+    get_filename_component(CC_filename "${VCPKG_DETECTED_CMAKE_C_COMPILER}" NAME)
+    set(ENV{CC} "${CC_filename}")
+    string(APPEND OPTIONS " --cc=${CC_filename}")
+
+    # string(APPEND OPTIONS " --host_cc=${CC_filename}") ffmpeg not yet setup for cross builds?
+    list(APPEND prog_env "${CC_path}")
+endif()
+
+if(VCPKG_DETECTED_CMAKE_CXX_COMPILER)
+    get_filename_component(CXX_path "${VCPKG_DETECTED_CMAKE_CXX_COMPILER}" DIRECTORY)
+    get_filename_component(CXX_filename "${VCPKG_DETECTED_CMAKE_CXX_COMPILER}" NAME)

----------------------------------------

File: res/vcpkg/ffmpeg/vcpkg-cmake-wrapper.cmake
Status: added
Changes: +47 -0
Diff:
@@ -0,0 +1,47 @@
+set(FFMPEG_PREV_MODULE_PATH ${CMAKE_MODULE_PATH})
+list(APPEND CMAKE_MODULE_PATH ${CMAKE_CURRENT_LIST_DIR})
+
+include(SelectLibraryConfigurations)
+
+cmake_policy(SET CMP0012 NEW)
+
+set(vcpkg_no_avcodec_target ON)
+set(vcpkg_no_avformat_target ON)
+set(vcpkg_no_avutil_target ON)
+if(TARGET FFmpeg::avcodec)
+  set(vcpkg_no_avcodec_target OFF)
+endif()
+if(TARGET FFmpeg::avformat)
+  set(vcpkg_no_avformat_target OFF)

----------------------------------------

File: res/vcpkg/ffmpeg/vcpkg.json
Status: added
Changes: +44 -0
Diff:
@@ -0,0 +1,44 @@
+{
+  "name": "ffmpeg",
+  "version": "7.0.1",
+  "port-version": 0,
+  "description": [
+    "a library to decode, encode, transcode, mux, demux, stream, filter and play pretty much anything that humans and machines have created.",
+    "FFmpeg is the leading multimedia framework, able to decode, encode, transcode, mux, demux, stream, filter and play pretty much anything that humans and machines have created. It supports the most obscure ancient formats up to the cutting edge. No matter if they were designed by some standards committee, the community or a corporation. It is also highly portable: FFmpeg compiles, runs, and passes our testing infrastructure FATE across Linux, Mac OS X, Microsoft Windows, the BSDs, Solaris, etc. under a wide variety of build environments, machine architectures, and configurations."
+  ],
+  "homepage": "https://ffmpeg.org",
+  "license": null,
+  "dependencies": [
+    {
+      "name": "vcpkg-cmake-get-vars",
+      "host": true

----------------------------------------

File: res/vcpkg/libyuv/fix-cmakelists.patch
Status: added
Changes: +80 -0
Diff:
@@ -0,0 +1,80 @@
+diff --git a/CMakeLists.txt b/CMakeLists.txt
+index bc641685..42e72a39 100644
+--- a/CMakeLists.txt
++++ b/CMakeLists.txt
+@@ -1,19 +1,22 @@
++CMAKE_MINIMUM_REQUIRED( VERSION 3.12 )
++
+ # CMakeLists for libyuv
+ # Originally created for "roxlu build system" to compile libyuv on windows
+ # Run with -DTEST=ON to build unit tests
+ 
+ PROJECT ( YUV C CXX )	# "C" is required even for C++ projects
+-CMAKE_MINIMUM_REQUIRED( VERSION 2.8.12 )
+ OPTION( TEST "Built unit tests" OFF )
+ 
++SET( CMAKE_INCLUDE_CURRENT_DIR_IN_INTERFACE ON )
++
+ SET ( ly_base_dir	${PROJECT_SOURCE_DIR} )
+ SET ( ly_src_dir	${ly_base_dir}/source )
+ SET ( ly_inc_dir	${ly_base_dir}/include )
+ SET ( ly_tst_dir	${ly_base_dir}/unit_test )
+ SET ( ly_lib_name	yuv )
+ SET ( ly_lib_static	${ly_lib_name} )
+-SET ( ly_lib_shared	${ly_lib_name}_shared )
+ 
++FILE ( GLOB_RECURSE ly_include_files ${ly_inc_dir}/libyuv/*.h )

----------------------------------------

File: res/vcpkg/libyuv/libyuv-config.cmake
Status: added
Changes: +5 -0
Diff:
@@ -0,0 +1,5 @@
+include(CMakeFindDependencyMacro)
+find_dependency(JPEG)
+
+set(libyuv_INCLUDE_DIRS "${CMAKE_CURRENT_LIST_DIR}/../../include")
+include("${CMAKE_CURRENT_LIST_DIR}/libyuv-targets.cmake")

----------------------------------------

File: res/vcpkg/libyuv/portfile.cmake
Status: added
Changes: +81 -0
Diff:
@@ -0,0 +1,81 @@
+vcpkg_check_linkage(ONLY_STATIC_LIBRARY)
+
+vcpkg_from_git(
+    OUT_SOURCE_PATH SOURCE_PATH
+    URL https://chromium.googlesource.com/libyuv/libyuv
+    REF 0faf8dd0e004520a61a603a4d2996d5ecc80dc3f
+    # Check https://chromium.googlesource.com/libyuv/libyuv/+/refs/heads/main/include/libyuv/version.h for a version!
+    PATCHES
+        fix-cmakelists.patch
+)
+
+vcpkg_cmake_get_vars(cmake_vars_file)
+include("${cmake_vars_file}")
+if (VCPKG_DETECTED_CMAKE_CXX_COMPILER_ID STREQUAL "MSVC" AND NOT VCPKG_TARGET_IS_UWP)
+    # Most of libyuv accelerated features need to be compiled by clang/gcc, so force use clang-cl, otherwise the performance is too poor.
+    # Manually build the port with clang-cl when using MSVC as compiler
+
+    message(STATUS "Set compiler to clang-cl when using MSVC")
+
+    # https://github.com/microsoft/vcpkg/pull/10398
+    set(VCPKG_POLICY_SKIP_ARCHITECTURE_CHECK enabled)
+
+    vcpkg_find_acquire_program(CLANG)
+    if (CLANG MATCHES "-NOTFOUND")
+        message(FATAL_ERROR "Clang is required.")
+    endif ()

----------------------------------------

File: res/vcpkg/libyuv/usage
Status: added
Changes: +4 -0
Diff:
@@ -0,0 +1,4 @@
+libyuv provides CMake targets:
+
+    find_package(libyuv CONFIG REQUIRED)
+    target_link_libraries(main PRIVATE yuv)
\ No newline at end of file

----------------------------------------

File: res/vcpkg/libyuv/usage-msvc
Status: added
Changes: +9 -0
Diff:
@@ -0,0 +1,9 @@
+libyuv provides CMake targets:
+
+    find_package(libyuv CONFIG REQUIRED)
+    target_link_libraries(main PRIVATE yuv)
+
+    # WARNING
+    # You are using MSVC to compile libyuv, which results in a very slow library.
+    # MSVC won't compile any of the acceleration codes.
+    # See workarounds: https://github.com/microsoft/vcpkg/issues/28446

----------------------------------------

File: res/vcpkg/libyuv/vcpkg.json
Status: added
Changes: +22 -0
Diff:
@@ -0,0 +1,22 @@
+{
+  "name": "libyuv",
+  "version": "1857",
+  "description": "libyuv is an open source project that includes YUV scaling and conversion functionality",
+  "homepage": "https://chromium.googlesource.com/libyuv/libyuv",
+  "license": null,
+  "dependencies": [
+    "libjpeg-turbo",
+    {

----------------------------------------

File: res/vcpkg/linux.cmake
Status: removed
Changes: +0 -74
Diff:
@@ -1,74 +0,0 @@
-if(NOT _VCPKG_LINUX_TOOLCHAIN)
-set(_VCPKG_LINUX_TOOLCHAIN 1)
-if(CMAKE_HOST_SYSTEM_NAME STREQUAL "Linux")
-    set(CMAKE_CROSSCOMPILING OFF CACHE BOOL "")
-endif()
-set(CMAKE_SYSTEM_NAME Linux CACHE STRING "")
-if(VCPKG_TARGET_ARCHITECTURE STREQUAL "x64")
-   set(CMAKE_SYSTEM_PROCESSOR x86_64 CACHE STRING "")
-elseif(VCPKG_TARGET_ARCHITECTURE STREQUAL "x86")
-   set(CMAKE_SYSTEM_PROCESSOR x86 CACHE STRING "")
-   string(APPEND VCPKG_C_FLAGS " -m32")
-   string(APPEND VCPKG_CXX_FLAGS " -m32")
-   string(APPEND VCPKG_LINKER_FLAGS " -m32")
-elseif(VCPKG_TARGET_ARCHITECTURE STREQUAL "arm")
-    set(CMAKE_SYSTEM_PROCESSOR armv7l CACHE STRING "")
-    if(CMAKE_HOST_SYSTEM_NAME STREQUAL "Linux")
-        if(NOT DEFINED CMAKE_CXX_COMPILER)
-            set(CMAKE_CXX_COMPILER "arm-linux-gnueabihf-g++")
-        endif()
-        if(NOT DEFINED CMAKE_C_COMPILER)
-            set(CMAKE_C_COMPILER "arm-linux-gnueabihf-gcc")
-        endif()
-        if(NOT DEFINED CMAKE_ASM_COMPILER)
-            set(CMAKE_ASM_COMPILER "arm-linux-gnueabihf-gcc")

----------------------------------------

File: res/vcpkg/opus/portfile.cmake
Status: modified
Changes: +1 -1
Diff:
@@ -2,7 +2,7 @@ vcpkg_from_github(
     OUT_SOURCE_PATH SOURCE_PATH
     REPO xiph/opus
     REF "v${VERSION}"
-    SHA512 ba79ad035993e7bc4c09b7d77964ba913eb0b2be33305e8a04a8c49aaab21c4d96ac828e31ae45484896105851fdfc8c305c63c8400e4481dd76c62a1c12286b
+    SHA512 4ffefd9c035671024f9720c5129bfe395dea04f0d6b730041c2804e89b1db6e4d19633ad1ae58855afc355034233537361e707f26dc53adac916554830038fab
     HEAD_REF main
     PATCHES fix-pkgconfig-version.patch
 )

----------------------------------------

File: res/vcpkg/opus/vcpkg.json
Status: modified
Changes: +1 -1
Diff:
@@ -1,6 +1,6 @@
 {
   "name": "opus",
-  "version": "1.5.1",
+  "version": "1.5.2",
   "description": "Totally open, royalty-free, highly versatile audio codec",
   "homepage": "https://github.com/xiph/opus",
   "license": "BSD-3-Clause",

----------------------------------------

File: src/auth_2fa.rs
Status: modified
Changes: +2 -4
Diff:
@@ -4,7 +4,7 @@ use hbb_common::{
     config::Config,
     get_time,
     password_security::{decrypt_vec_or_original, encrypt_vec_or_original},
-    tokio, ResultType,
+    ResultType,
 };
 use serde_derive::{Deserialize, Serialize};
 use std::sync::Mutex;
@@ -165,9 +165,7 @@ pub async fn send_2fa_code_to_telegram(text: &str, bot: TelegramBot) -> ResultTy

----------------------------------------

File: src/client.rs
Status: modified
Changes: +193 -51
Diff:
@@ -1,14 +1,7 @@
-use std::{
-    collections::HashMap,
-    ffi::c_void,
-    net::SocketAddr,
-    ops::Deref,
-    str::FromStr,
-    sync::{mpsc, Arc, Mutex, RwLock},
-};
-
 use async_trait::async_trait;
 use bytes::Bytes;
+#[cfg(not(any(target_os = "android", target_os = "ios")))]
+use clipboard_master::{CallbackResult, ClipboardHandler};
 #[cfg(not(any(target_os = "android", target_os = "linux")))]
 use cpal::{
     traits::{DeviceTrait, HostTrait, StreamTrait},
@@ -19,6 +12,18 @@ use magnum_opus::{Channels::*, Decoder as AudioDecoder};
 #[cfg(not(any(target_os = "android", target_os = "linux")))]
 use ringbuf::{ring_buffer::RbBase, Rb};
 use sha2::{Digest, Sha256};
+use std::{
+    collections::HashMap,
+    ffi::c_void,
+    io,
+    net::SocketAddr,
+    ops::Deref,
+    str::FromStr,
+    sync::{
+        mpsc::{self, RecvTimeoutError, Sender},
+        Arc, Mutex, RwLock,
+    },
+};
 use uuid::Uuid;
 
 pub use file_trait::FileManager;
@@ -60,12 +65,12 @@ use crate::{
     check_port,
     common::input::{MOUSE_BUTTON_LEFT, MOUSE_BUTTON_RIGHT, MOUSE_TYPE_DOWN, MOUSE_TYPE_UP},
     create_symmetric_key_msg, decode_id_pk, get_rs_pk, is_keyboard_mode_supported, secure_tcp,
-    ui_interface::{get_buildin_option, use_texture_render},
+    ui_interface::{get_builtin_option, use_texture_render},
     ui_session_interface::{InvokeUiSession, Session},
 };
 
 #[cfg(not(any(target_os = "android", target_os = "ios")))]
-use crate::clipboard::{check_clipboard, CLIPBOARD_INTERVAL};
+use crate::clipboard::{check_clipboard, ClipboardSide, CLIPBOARD_INTERVAL};
 #[cfg(not(feature = "flutter"))]
 #[cfg(not(any(target_os = "android", target_os = "ios")))]
 use crate::ui_session_interface::SessionPermissionConfig;
@@ -108,6 +113,9 @@ pub const SCRAP_OTHER_VERSION_OR_X11_REQUIRED: &str =
 pub const SCRAP_X11_REQUIRED: &str = "x11 expected";
 pub const SCRAP_X11_REF_URL: &str = "https://rustdesk.com/docs/en/manual/linux/#x11-required";
 
+#[cfg(not(any(target_os = "android", target_os = "linux")))]
+pub const AUDIO_BUFFER_MS: usize = 150;
+
 #[cfg(feature = "flutter")]
 #[cfg(not(any(target_os = "android", target_os = "ios")))]
 pub(crate) struct ClientClipboardContext;
@@ -136,18 +144,11 @@ lazy_static::lazy_static! {
 #[cfg(not(any(target_os = "android", target_os = "ios")))]
 lazy_static::lazy_static! {
     static ref ENIGO: Arc<Mutex<enigo::Enigo>> = Arc::new(Mutex::new(enigo::Enigo::new()));
-    static ref OLD_CLIPBOARD_DATA: Arc<Mutex<crate::clipboard::ClipboardData>> = Default::default();
     static ref TEXT_CLIPBOARD_STATE: Arc<Mutex<TextClipboardState>> = Arc::new(Mutex::new(TextClipboardState::new()));
 }
 
 const PUBLIC_SERVER: &str = "public";
 
-#[inline]
-#[cfg(not(any(target_os = "android", target_os = "ios")))]
-pub fn get_old_clipboard_text() -> Arc<Mutex<crate::clipboard::ClipboardData>> {
-    OLD_CLIPBOARD_DATA.clone()
-}
-
 #[cfg(not(any(target_os = "android", target_os = "ios")))]
 pub fn get_key_state(key: enigo::Key) -> bool {
     use enigo::KeyboardControllable;
@@ -714,6 +715,13 @@ impl Client {
 
     #[cfg(not(any(target_os = "android", target_os = "ios")))]
     fn try_stop_clipboard() {
+        // There's a bug here.
+        // If session is closed by the peer, `has_sessions_running()` will always return true.
+        // It's better to check if the active session number.
+        // But it's not a problem, because the clipboard thread does not consume CPU.
+        //
+        // If we want to fix it, we can add a flag to indicate if session is active.
+        // But I think it's not necessary to introduce complexity at this point.
         #[cfg(feature = "flutter")]
         if crate::flutter::sessions::has_sessions_running(ConnType::DEFAULT_CONN) {
             return;
@@ -727,18 +735,44 @@ impl Client {
     //
     // If clipboard update is detected, the text will be sent to all sessions by `send_text_clipboard_msg`.
     #[cfg(not(any(target_os = "android", target_os = "ios")))]
-    fn try_start_clipboard(_ctx: Option<ClientClipboardContext>) -> Option<UnboundedReceiver<()>> {
+    fn try_start_clipboard(
+        _client_clip_ctx: Option<ClientClipboardContext>,
+    ) -> Option<UnboundedReceiver<()>> {
         let mut clipboard_lock = TEXT_CLIPBOARD_STATE.lock().unwrap();
         if clipboard_lock.running {
             return None;
         }
+
+        let (tx_cb_result, rx_cb_result) = mpsc::channel();
+        let handler = ClientClipboardHandler {
+            ctx: None,
+            tx_cb_result,
+            #[cfg(not(feature = "flutter"))]
+            client_clip_ctx: _client_clip_ctx,
+        };
+
+        let (tx_start_res, rx_start_res) = mpsc::channel();
+        let h = crate::clipboard::start_clipbard_master_thread(handler, tx_start_res);
+        let shutdown = match rx_start_res.recv() {
+            Ok((Some(s), _)) => s,
+            Ok((None, err)) => {
+                log::error!("{}", err);
+                return None;
+            }
+            Err(e) => {
+                log::error!("Failed to create clipboard listener: {}", e);
+                return None;
+            }
+        };
+
         clipboard_lock.running = true;
-        let (tx, rx) = unbounded_channel();
+
+        let (tx_started, rx_started) = unbounded_channel();
 
         log::info!("Start text clipboard loop");
         std::thread::spawn(move || {
             let mut is_sent = false;
-            let mut ctx = None;
+
             loop {

----------------------------------------

File: src/client/file_trait.rs
Status: modified
Changes: +17 -3
Diff:
@@ -1,4 +1,4 @@
-use hbb_common::{fs, message_proto::*, log};
+use hbb_common::{fs, log, message_proto::*};
 
 use super::{Data, Interface};
 
@@ -7,7 +7,12 @@ pub trait FileManager: Interface {
         fs::get_home_as_string()
     }
 
-    #[cfg(not(any(target_os = "android", target_os = "ios", feature = "cli", feature = "flutter")))]
+    #[cfg(not(any(
+        target_os = "android",
+        target_os = "ios",

----------------------------------------

File: src/client/io_loop.rs
Status: modified
Changes: +116 -21
Diff:
@@ -7,11 +7,21 @@ use std::{
     },
 };
 
+#[cfg(not(any(target_os = "android", target_os = "ios")))]
+use crate::clipboard::{update_clipboard, ClipboardSide, CLIPBOARD_INTERVAL};
+#[cfg(not(any(target_os = "ios")))]
+use crate::{audio_service, ConnInner, CLIENT_SERVER};
+use crate::{
+    client::{
+        self, new_voice_call_request, Client, Data, Interface, MediaData, MediaSender,
+        QualityStatus, MILLI1, SEC30,
+    },
+    common::get_default_sound_input,
+    ui_session_interface::{InvokeUiSession, Session},
+};
 #[cfg(any(target_os = "windows", target_os = "linux", target_os = "macos"))]
 use clipboard::ContextSend;
 use crossbeam_queue::ArrayQueue;
-#[cfg(not(any(target_os = "android", target_os = "ios")))]
-use hbb_common::sleep;
 #[cfg(not(target_os = "ios"))]
 use hbb_common::tokio::sync::mpsc::error::TryRecvError;
 use hbb_common::{
@@ -37,17 +47,6 @@ use hbb_common::{
 use hbb_common::{tokio::sync::Mutex as TokioMutex, ResultType};
 use scrap::CodecFormat;
 
-use crate::client::{
-    self, new_voice_call_request, Client, MediaData, MediaSender, QualityStatus, MILLI1, SEC30,
-};
-#[cfg(not(any(target_os = "android", target_os = "ios")))]
-use crate::clipboard::{update_clipboard, CLIPBOARD_INTERVAL};
-use crate::common::get_default_sound_input;
-use crate::ui_session_interface::{InvokeUiSession, Session};
-#[cfg(not(any(target_os = "ios")))]
-use crate::{audio_service, ConnInner, CLIENT_SERVER};
-use crate::{client::Data, client::Interface};
-
 pub struct Remote<T: InvokeUiSession> {
     handler: Session<T>,
     video_queue_map: Arc<RwLock<HashMap<usize, ArrayQueue<VideoFrame>>>>,
@@ -74,6 +73,22 @@ pub struct Remote<T: InvokeUiSession> {
     fps_control: FpsControl,
     decode_fps: Arc<RwLock<Option<usize>>>,
     chroma: Arc<RwLock<Option<Chroma>>>,
+    peer_info: ParsedPeerInfo,
+}
+
+#[derive(Default)]
+struct ParsedPeerInfo {
+    platform: String,
+    is_installed: bool,
+    idd_impl: String,
+}
+
+impl ParsedPeerInfo {
+    fn is_support_virtual_display(&self) -> bool {
+        self.is_installed
+            && self.platform == "Windows"
+            && (self.idd_impl == "rustdesk_idd" || self.idd_impl == "amyuni_idd")
+    }
 }
 
 impl<T: InvokeUiSession> Remote<T> {
@@ -113,6 +128,7 @@ impl<T: InvokeUiSession> Remote<T> {
             fps_control: Default::default(),
             decode_fps,
             chroma,
+            peer_info: Default::default(),
         }
     }
 
@@ -173,8 +189,7 @@ impl<T: InvokeUiSession> Remote<T> {
                     crate::rustdesk_interval(time::interval(Duration::new(1, 0)));
                 let mut fps_instant = Instant::now();
 
-                let _keep_it =
-                    client::hc_connection(feedback, rendezvous_server, token).await;
+                let _keep_it = client::hc_connection(feedback, rendezvous_server, token).await;
 
                 loop {
                     tokio::select! {
@@ -802,6 +817,25 @@ impl<T: InvokeUiSession> Remote<T> {
                     }
                 }
             }

----------------------------------------

File: src/clipboard.rs
Status: modified
Changes: +332 -246
Diff:
@@ -1,26 +1,38 @@
-use std::sync::{
-    atomic::{AtomicU64, Ordering},
-    Arc, Mutex,
-};
-
-use clipboard_master::{CallbackResult, ClipboardHandler, Master, Shutdown};
-use hbb_common::{
-    allow_err,
-    compress::{compress as compress_func, decompress},
-    log,
-    message_proto::*,
-    ResultType,
+use arboard::{ClipboardData, ClipboardFormat};
+use clipboard_master::{ClipboardHandler, Master, Shutdown};
+use hbb_common::{log, message_proto::*, ResultType};
+use std::{
+    sync::{mpsc::Sender, Arc, Mutex},
+    thread::JoinHandle,
 };
 
 pub const CLIPBOARD_NAME: &'static str = "clipboard";
 pub const CLIPBOARD_INTERVAL: u64 = 333;
-const FAKE_SVG_WIDTH: usize = 999999;
+
+// This format is used to store the flag in the clipboard.
+const RUSTDESK_CLIPBOARD_OWNER_FORMAT: &'static str = "dyn.com.rustdesk.owner";
 
 lazy_static::lazy_static! {
-    pub static ref CONTENT: Arc<Mutex<ClipboardData>> = Default::default();
     static ref ARBOARD_MTX: Arc<Mutex<()>> = Arc::new(Mutex::new(()));
+    // cache the clipboard msg
+    static ref LAST_MULTI_CLIPBOARDS: Arc<Mutex<MultiClipboards>> = Arc::new(Mutex::new(MultiClipboards::new()));
+    // For updating in server and getting content in cm.
+    // Clipboard on Linux is "server--clients" mode.
+    // The clipboard content is owned by the server and passed to the clients when requested.
+    // Plain text is the only exception, it does not require the server to be present.
+    static ref CLIPBOARD_CTX: Arc<Mutex<Option<ClipboardContext>>> = Arc::new(Mutex::new(None));
 }
 
+const SUPPORTED_FORMATS: &[ClipboardFormat] = &[
+    ClipboardFormat::Text,
+    ClipboardFormat::Html,
+    ClipboardFormat::Rtf,
+    ClipboardFormat::ImageRgba,
+    ClipboardFormat::ImagePng,
+    ClipboardFormat::ImageSvg,
+    ClipboardFormat::Special(RUSTDESK_CLIPBOARD_OWNER_FORMAT),
+];
+
 #[cfg(all(target_os = "linux", feature = "unix-file-copy-paste"))]
 static X11_CLIPBOARD: once_cell::sync::OnceCell<x11_clipboard::Clipboard> =
     once_cell::sync::OnceCell::new();
@@ -61,7 +73,7 @@ fn parse_plain_uri_list(v: Vec<u8>) -> Result<String, String> {
 
 #[cfg(all(target_os = "linux", feature = "unix-file-copy-paste"))]
 impl ClipboardContext {
-    pub fn new(_listen: bool) -> Result<Self, String> {
+    pub fn new() -> Result<Self, String> {
         let clipboard = get_clipboard()?;
         let string_getter = clipboard
             .getter
@@ -128,200 +140,93 @@ impl ClipboardContext {
 
 pub fn check_clipboard(
     ctx: &mut Option<ClipboardContext>,
-    old: Option<Arc<Mutex<ClipboardData>>>,
+    side: ClipboardSide,
+    force: bool,
 ) -> Option<Message> {
     if ctx.is_none() {
-        *ctx = ClipboardContext::new(true).ok();
+        *ctx = ClipboardContext::new().ok();
     }
     let ctx2 = ctx.as_mut()?;
-    let side = if old.is_none() { "host" } else { "client" };
-    let old = if let Some(old) = old {
-        old
-    } else {
-        CONTENT.clone()
-    };
-    let content = ctx2.get();
+    let content = ctx2.get(side, force);
     if let Ok(content) = content {
         if !content.is_empty() {
-            if matches!(content, ClipboardData::Text(_)) {
-                // Skip the text if the last content is image-svg/html
-                if ctx2.is_last_plain {
-                    return None;
-                }
-            }
-
-            let changed = content != *old.lock().unwrap();
-            if changed {
-                log::info!("{} update found on {}", CLIPBOARD_NAME, side);
-                let msg = content.create_msg();
-                *old.lock().unwrap() = content;
-                return Some(msg);
-            }
+            let mut msg = Message::new();
+            let clipboards = proto::create_multi_clipboards(content);
+            msg.set_multi_clipboards(clipboards.clone());
+            *LAST_MULTI_CLIPBOARDS.lock().unwrap() = clipboards;
+            return Some(msg);
         }
     }
     None
 }
 
-fn update_clipboard_(clipboard: Clipboard, old: Option<Arc<Mutex<ClipboardData>>>) {
-    let content = ClipboardData::from_msg(clipboard);
-    if content.is_empty() {
-        return;
-    }
-    match ClipboardContext::new(false) {
-        Ok(mut ctx) => {
-            let side = if old.is_none() { "host" } else { "client" };
-            let old = if let Some(old) = old {
-                old
-            } else {
-                CONTENT.clone()
-            };
-            allow_err!(ctx.set(&content));
-            *old.lock().unwrap() = content;
-            log::debug!("{} updated on {}", CLIPBOARD_NAME, side);
-        }
-        Err(err) => {
-            log::error!("Failed to create clipboard context: {}", err);
+#[cfg(target_os = "windows")]
+pub fn check_clipboard_cm() -> ResultType<MultiClipboards> {
+    let mut ctx = CLIPBOARD_CTX.lock().unwrap();
+    if ctx.is_none() {
+        match ClipboardContext::new() {
+            Ok(x) => {
+                *ctx = Some(x);
+            }
+            Err(e) => {
+                hbb_common::bail!("Failed to create clipboard context: {}", e);
+            }
         }
     }
-}
-
-pub fn update_clipboard(clipboard: Clipboard, old: Option<Arc<Mutex<ClipboardData>>>) {
-    std::thread::spawn(move || {
-        update_clipboard_(clipboard, old);
-    });
-}
-
-#[derive(Clone)]
-pub enum ClipboardData {
-    Text(String),
-    Image(arboard::ImageData<'static>, u64),
-    Empty,
-}
-
-impl Default for ClipboardData {
-    fn default() -> Self {
-        ClipboardData::Empty
+    if let Some(ctx) = ctx.as_mut() {
+        let content = ctx.get(ClipboardSide::Host, false)?;
+        let clipboards = proto::create_multi_clipboards(content);
+        Ok(clipboards)
+    } else {
+        hbb_common::bail!("Failed to create clipboard context");
     }
 }
 
-impl ClipboardData {
-    fn image(image: arboard::ImageData<'static>) -> ClipboardData {
-        let hash = 0;
-        /*
-        use std::hash::{DefaultHasher, Hash, Hasher};
-        let mut hasher = DefaultHasher::new();
-        image.bytes.hash(&mut hasher);
-        let hash = hasher.finish();
-        */
-        ClipboardData::Image(image, hash)
-    }
-
-    pub fn is_empty(&self) -> bool {
-        match self {
-            ClipboardData::Empty => true,
-            ClipboardData::Text(s) => s.is_empty(),
-            ClipboardData::Image(a, _) => a.bytes().is_empty(),
-        }
+fn update_clipboard_(multi_clipboards: Vec<Clipboard>, side: ClipboardSide) {
+    let mut to_update_data = proto::from_multi_clipbards(multi_clipboards);
+    if to_update_data.is_empty() {
+        return;
     }
-
-    fn from_msg(clipboard: Clipboard) -> Self {
-        let is_image = clipboard.width > 0;
-        let data = if clipboard.compress {
-            decompress(&clipboard.content)
-        } else {
-            clipboard.content.into()
-        };
-        if is_image {
-            // We cannot use data.start_with(b"<svg") to check if it is svg image
-            // because svg image may starts with other bytes
-            let img = if clipboard.height == 0 && clipboard.width as usize == FAKE_SVG_WIDTH {
-                arboard::ImageData::svg(std::str::from_utf8(&data).unwrap_or_default())
-            } else {
-                arboard::ImageData::rgba(clipboard.width as _, clipboard.height as _, data.into())
-            };
-            ClipboardData::Image(img, 0)
-        } else {
-            if let Ok(content) = String::from_utf8(data) {
-                ClipboardData::Text(content)
-            } else {
-                ClipboardData::Empty
+    let mut ctx = CLIPBOARD_CTX.lock().unwrap();
+    if ctx.is_none() {
+        match ClipboardContext::new() {
+            Ok(x) => {
+                *ctx = Some(x);
+            }
+            Err(e) => {
+                log::error!("Failed to create clipboard context: {}", e);

----------------------------------------

File: src/common.rs
Status: modified
Changes: +10 -1
Diff:
@@ -1359,7 +1359,7 @@ fn read_custom_client_advanced_settings(
     } else {
         config::DEFAULT_SETTINGS.write().unwrap()
     };
-    let mut buildin_settings = config::BUILDIN_SETTINGS.write().unwrap();
+    let mut buildin_settings = config::BUILTIN_SETTINGS.write().unwrap();
 
     if let Some(settings) = settings.as_object() {
         for (k, v) in settings {
@@ -1494,6 +1494,15 @@ pub fn is_empty_uni_link(arg: &str) -> bool {

----------------------------------------

File: src/core_main.rs
Status: modified
Changes: +55 -2
Diff:
@@ -261,6 +261,20 @@ pub fn core_main() -> Option<Vec<String>> {
             return None;
         } else if args[0] == "--server" {
             log::info!("start --server with user {}", crate::username());
+            #[cfg(target_os = "linux")]
+            {
+                hbb_common::allow_err!(crate::platform::check_autostart_config());
+                std::process::Command::new("pkill")
+                    .arg("-f")
+                    .arg(&format!("{} --tray", crate::get_app_name().to_lowercase()))
+                    .status()
+                    .ok();
+                hbb_common::allow_err!(crate::platform::run_as_user(
+                    vec!["--tray"],
+                    None,
+                    None::<(&str, &str)>,
+                ));
+            }
             #[cfg(windows)]
             crate::privacy_mode::restore_reg_connectivity(true);
             #[cfg(any(target_os = "linux", target_os = "windows"))]
@@ -302,6 +316,20 @@ pub fn core_main() -> Option<Vec<String>> {
                 }
             }
             return None;
+        } else if args[0] == "--set-unlock-pin" {
+            #[cfg(feature = "flutter")]
+            if args.len() == 2 {
+                if crate::platform::is_installed() && is_root() {
+                    if let Err(err) = crate::ipc::set_unlock_pin(args[1].to_owned(), false) {

----------------------------------------

File: src/custom_server.rs
Status: modified
Changes: +28 -14
Diff:
@@ -59,30 +59,30 @@ pub fn get_custom_server_from_string(s: &str) -> ResultType<CustomServer> {
     if s.contains("host=") {
         let stripped = &s[s.find("host=").unwrap_or(0)..s.len()];
         let strs: Vec<&str> = stripped.split(",").collect();
-        let mut host = "";
-        let mut key = "";
-        let mut api = "";
-        let mut relay = "";
+        let mut host = String::default();
+        let mut key = String::default();
+        let mut api = String::default();
+        let mut relay = String::default();
         let strs_iter = strs.iter();
         for el in strs_iter {
             if el.starts_with("host=") {
-                host = &el[5..el.len()];
+                host = el.chars().skip(5).collect();
             }
             if el.starts_with("key=") {
-                key = &el[4..el.len()];
+                key = el.chars().skip(4).collect();
             }
             if el.starts_with("api=") {
-                api = &el[4..el.len()];
+                api = el.chars().skip(4).collect();

----------------------------------------

File: src/flutter.rs
Status: modified
Changes: +83 -3
Diff:
@@ -794,7 +794,7 @@ impl InvokeUiSession for FlutterHandler {
         for (_, session) in self.session_handlers.read().unwrap().iter() {
             if session.renderer.on_texture(display, texture) {
                 if let Some(stream) = &session.event_stream {
-                    stream.add(EventToUI::Texture(display));
+                    stream.add(EventToUI::Texture(display, true));
                 }
             }
         }
@@ -1063,7 +1063,7 @@ impl FlutterHandler {
         }
         // We need `is_sent` here. Because we use texture render for multi-displays session.
         //
-        // Eg. We have to windows, one is display 1, the other is displays 0&1.
+        // Eg. We have two windows, one is display 1, the other is displays 0&1.
         // When image of display 0 is received, we will not send the event.
         //
         // 1. "display 1" will not send the event.
@@ -1087,7 +1087,7 @@ impl FlutterHandler {
             if use_texture_render || session.displays.len() > 1 {
                 if session.renderer.on_rgba(display, rgba) {
                     if let Some(stream) = &session.event_stream {
-                        stream.add(EventToUI::Rgba(display));
+                        stream.add(EventToUI::Texture(display, false));
                     }
                 }
             }
@@ -1256,6 +1256,19 @@ pub fn update_text_clipboard_required() {
 pub fn send_text_clipboard_msg(msg: Message) {
     for s in sessions::get_sessions() {
         if s.is_text_clipboard_required() {
+            // Check if the client supports multi clipboards
+            if let Some(message::Union::MultiClipboards(multi_clipboards)) = &msg.union {
+                let version = s.ui_handler.peer_info.read().unwrap().version.clone();
+                let platform = s.ui_handler.peer_info.read().unwrap().platform.clone();
+                if let Some(msg_out) = crate::clipboard::get_msg_if_not_support_multi_clip(
+                    &version,
+                    &platform,
+                    multi_clipboards,
+                ) {
+                    s.send(Data::Message(msg_out));
+                    continue;
+                }
+            }
             s.send(Data::Message(msg.clone()));

----------------------------------------

File: src/flutter_ffi.rs
Status: modified
Changes: +57 -5
Diff:
@@ -89,7 +89,7 @@ pub fn stop_global_event_stream(app_type: String) {
 pub enum EventToUI {
     Event(String),
     Rgba(usize),
-    Texture(usize),
+    Texture(usize, bool), // (display, gpu_texture)
 }
 
 pub fn host_stop_system_key_propagate(_stopped: bool) {
@@ -208,12 +208,21 @@ pub fn session_login(
     }
 }
 
-pub fn session_send2fa(session_id: SessionID, code: String) {
+pub fn session_send2fa(session_id: SessionID, code: String, trust_this_device: bool) {
     if let Some(session) = sessions::get_session_by_session_id(&session_id) {
-        session.send2fa(code);
+        session.send2fa(code, trust_this_device);
     }
 }
 
+pub fn session_get_enable_trusted_devices(session_id: SessionID) -> SyncReturn<bool> {
+    let v = if let Some(session) = sessions::get_session_by_session_id(&session_id) {
+        session.get_enable_trusted_devices()
+    } else {
+        false
+    };
+    SyncReturn(v)
+}
+
 pub fn session_close(session_id: SessionID) {
     if let Some(session) = sessions::remove_session_by_session_id(&session_id) {
         session.close_event_stream(session_id);
@@ -701,6 +710,18 @@ pub fn session_resume_job(session_id: SessionID, act_id: i32, is_remote: bool) {
     }
 }
 
+pub fn session_rename_file(
+    session_id: SessionID,
+    act_id: i32,
+    path: String,
+    new_name: String,
+    is_remote: bool,
+) {
+    if let Some(session) = sessions::get_session_by_session_id(&session_id) {

----------------------------------------

File: src/hbbs_http/sync.rs
Status: modified
Changes: +3 -3
Diff:
@@ -5,7 +5,7 @@ use std::{
 };
 
 #[cfg(not(any(target_os = "ios")))]
-use crate::{ui_interface::get_buildin_option, Connection};
+use crate::{ui_interface::get_builtin_option, Connection};
 use hbb_common::{
     config::{keys, Config, LocalConfig},
     tokio::{self, sync::broadcast, time::Instant},
@@ -91,11 +91,11 @@ async fn start_hbbs_sync_async() {

----------------------------------------

File: src/ipc.rs
Status: modified
Changes: +114 -9
Diff:
@@ -1,10 +1,3 @@
-use std::{
-    collections::HashMap,
-    sync::atomic::{AtomicBool, Ordering},
-};
-#[cfg(not(windows))]
-use std::{fs::File, io::prelude::*};
-
 use crate::{
     privacy_mode::PrivacyModeState,
     ui_interface::{get_local_option, set_local_option},
@@ -14,6 +7,12 @@ use parity_tokio_ipc::{
     Connection as Conn, ConnectionClient as ConnClient, Endpoint, Incoming, SecurityAttributes,
 };
 use serde_derive::{Deserialize, Serialize};
+use std::{
+    collections::HashMap,
+    sync::atomic::{AtomicBool, Ordering},
+};
+#[cfg(not(windows))]
+use std::{fs::File, io::prelude::*};
 
 #[cfg(all(feature = "flutter", feature = "plugin_framework"))]
 #[cfg(not(any(target_os = "android", target_os = "ios")))]
@@ -26,8 +25,13 @@ use hbb_common::{
     config::{self, Config, Config2},
     futures::StreamExt as _,
     futures_util::sink::SinkExt,
-    log, password_security as password, timeout, tokio,
-    tokio::io::{AsyncRead, AsyncWrite},
+    log, password_security as password,
+    sodiumoxide::base64,
+    timeout,
+    tokio::{
+        self,
+        io::{AsyncRead, AsyncWrite},
+    },
     tokio_util::codec::Framed,
     ResultType,
 };
@@ -98,6 +102,25 @@ pub enum FS {
         last_modified: u64,
         is_upload: bool,
     },
+    Rename {
+        id: i32,
+        path: String,
+        new_name: String,
+    },
+}
+
+#[cfg(target_os = "windows")]
+#[derive(Debug, Serialize, Deserialize, Clone)]
+#[serde(tag = "t")]
+pub struct ClipboardNonFile {
+    pub compress: bool,
+    pub content: bytes::Bytes,
+    pub content_len: usize,
+    pub next_raw: bool,
+    pub width: i32,
+    pub height: i32,
+    // message.proto: ClipboardFormat
+    pub format: i32,
 }
 

----------------------------------------

File: src/lang.rs
Status: modified
Changes: +3 -3
Diff:
@@ -41,7 +41,7 @@ mod sv;
 mod th;
 mod tr;
 mod tw;
-mod ua;
+mod uk;
 mod vn;
 
 pub const LANGS: &[(&str, &str)] = &[
@@ -72,7 +72,7 @@ pub const LANGS: &[(&str, &str)] = &[

----------------------------------------

File: src/lang/ar.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/be.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/bg.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/ca.rs
Status: modified
Changes: +232 -218
Diff:
@@ -8,8 +8,8 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("Ready", "Llest"),
         ("Established", "Establert"),
         ("connecting_status", "Connexió a la xarxa RustDesk en progrés..."),
-        ("Enable service", "Habilitar Servei"),
-        ("Start service", "Iniciar Servei"),
+        ("Enable service", "Habilita el servei"),
+        ("Start service", "Inicia el servei"),
         ("Service is running", "El servei s'està executant"),
         ("Service is not running", "El servei no s'està executant"),
         ("not_ready_status", "No està llest. Comprova la teva connexió"),
@@ -21,32 +21,32 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("Confirmation", "Confirmació"),
         ("TCP tunneling", "Túnel TCP"),
         ("Remove", "Eliminar"),
-        ("Refresh random password", "Actualitzar contrasenya aleatòria"),
-        ("Set your own password", "Estableix la teva pròpia contrasenya"),
-        ("Enable keyboard/mouse", "Habilitar teclat/ratolí"),
-        ("Enable clipboard", "Habilitar portapapers"),
-        ("Enable file transfer", "Habilitar transferència d'arxius"),
-        ("Enable TCP tunneling", "Habilitar túnel TCP"),
+        ("Refresh random password", "Actualitza la contrasenya aleatòria"),
+        ("Set your own password", "Estableix la teva contrasenya"),
+        ("Enable keyboard/mouse", "Habilita el teclat/ratolí"),
+        ("Enable clipboard", "Habilita el portapapers"),
+        ("Enable file transfer", "Habilita la transferència d'arxius"),
+        ("Enable TCP tunneling", "Habilita el túnel TCP"),
         ("IP Whitelisting", "Adreces IP admeses"),
         ("ID/Relay Server", "Servidor ID/Relay"),
-        ("Import server config", "Importar configuració de servidor"),
-        ("Export Server Config", "Exportar configuració del servidor"),
-        ("Import server configuration successfully", "Configuració de servidor importada amb èxit"),
-        ("Export server configuration successfully", "Configuració de servidor exportada con èxit"),
-        ("Invalid server configuration", "Configuració de servidor incorrecta"),
+        ("Import server config", "Importa la configuració del servidor"),
+        ("Export Server Config", "Exporta la configuració del servidor"),
+        ("Import server configuration successfully", "Configuració del servidor importada amb èxit"),
+        ("Export server configuration successfully", "Configuració del servidor exportada con èxit"),
+        ("Invalid server configuration", "Configuració del servidor incorrecta"),
         ("Clipboard is empty", "El portapapers està buit"),
-        ("Stop service", "Aturar servei"),
+        ("Stop service", "Atura el servei"),
         ("Change ID", "Canviar ID"),
         ("Your new ID", "La teva nova ID"),
         ("length %min% to %max%", "Ha de tenir entre %min% i %max% caràcters"),
-        ("starts with a letter", "començar amb una lletra"),
+        ("starts with a letter", "comença amb una lletra"),
         ("allowed characters", "caràcters permesos"),
         ("id_change_tip", "Només pots utilitzar caràcters a-z, A-Z, 0-9 e _ (guionet baix). El primer caràcter ha de ser a-z o A-Z. La longitut ha d'estar entre 6 i 16 caràcters."),
         ("Website", "Lloc web"),
         ("About", "Sobre"),
         ("Slogan_tip", ""),
         ("Privacy Statement", "Declaració de privacitat"),
-        ("Mute", "Silenciar"),
+        ("Mute", "Silencia"),
         ("Build Date", "Data de creació"),
         ("Version", "Versió"),
         ("Home", "Inici"),
@@ -63,140 +63,140 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("server_not_support", "Encara no és compatible amb el servidor"),
         ("Not available", "No disponible"),
         ("Too frequent", "Massa comú"),
-        ("Cancel", "Cancel·lar"),
-        ("Skip", "Saltar"),
-        ("Close", "Tancar"),
-        ("Retry", "Reintentar"),
+        ("Cancel", "Cancel·la"),
+        ("Skip", "Salta"),
+        ("Close", "Tanca"),
+        ("Retry", "Reintenta"),
         ("OK", "D'acord"),
         ("Password Required", "Es necessita la contrasenya"),
-        ("Please enter your password", "Si us plau, introdueixi la seva contrasenya"),
-        ("Remember password", "Recordar contrasenya"),
+        ("Please enter your password", "Introdueix la teva contrasenya"),
+        ("Remember password", "Recorda la contrasenya"),
         ("Wrong Password", "Contrasenya incorrecta"),
-        ("Do you want to enter again?", "Vol tornar a entrar?"),
+        ("Do you want to enter again?", "Vols tornar a entrar?"),
         ("Connection Error", "Error de connexió"),
         ("Error", "Error"),
         ("Reset by the peer", "Reestablert pel peer"),
         ("Connecting...", "Connectant..."),
-        ("Connection in progress. Please wait.", "Connexió en procés. Esperi."),
-        ("Please try 1 minute later", "Torni a provar-ho d'aquí un minut"),
-        ("Login Error", "Error d'inicio de sessió"),
+        ("Connection in progress. Please wait.", "Connexió en procés. Espera."),
+        ("Please try 1 minute later", "Torna a provar-ho d'aquí un minut"),
+        ("Login Error", "Error d'inici de sessió"),
         ("Successful", "Exitós"),
         ("Connected, waiting for image...", "Connectant, esperant imatge..."),
         ("Name", "Nom"),
         ("Type", "Tipus"),
         ("Modified", "Modificat"),
         ("Size", "Grandària"),
-        ("Show Hidden Files", "Mostrar arxius ocults"),
-        ("Receive", "Rebre"),
-        ("Send", "Enviar"),
-        ("Refresh File", "Actualitzar arxiu"),
+        ("Show Hidden Files", "Mostra arxius ocults"),
+        ("Receive", "Rep"),
+        ("Send", "Envia"),
+        ("Refresh File", "Actualitza el fitxer"),
         ("Local", "Local"),
         ("Remote", "Remot"),
         ("Remote Computer", "Ordinador remot"),
         ("Local Computer", "Ordinador local"),
-        ("Confirm Delete", "Confirma eliminació"),
-        ("Delete", "Eliminar"),
+        ("Confirm Delete", "Confirma l'eliminació"),
+        ("Delete", "Elimina"),
         ("Properties", "Propietats"),
         ("Multi Select", "Selecció múltiple"),
-        ("Select All", "Selecciona-ho Tot"),
-        ("Unselect All", "Deselecciona-ho Tot"),
-        ("Empty Directory", "Directori buit"),
-        ("Not an empty directory", "No és un directori buit"),
-        ("Are you sure you want to delete this file?", "Estàs segur que vols eliminar aquest arxiu?"),
-        ("Are you sure you want to delete this empty directory?", "Estàs segur que vols eliminar aquest directori buit?"),
-        ("Are you sure you want to delete the file of this directory?", "Estàs segur que vols eliminar aquest arxiu d'aquest directori?"),
+        ("Select All", "Selecciona-ho tot"),
+        ("Unselect All", "Deselecciona-ho tot"),
+        ("Empty Directory", "Carpeta buida"),
+        ("Not an empty directory", "No és una carpeta buida"),
+        ("Are you sure you want to delete this file?", "Segur que vols eliminar aquest fitxer?"),
+        ("Are you sure you want to delete this empty directory?", "Segur que vols eliminar aquesta carpeta buida?"),
+        ("Are you sure you want to delete the file of this directory?", "Segur que vols eliminar aquest fitxer d'aquesta car`peta?"),
         ("Do this for all conflicts", "Fes això per a tots els conflictes"),
         ("This is irreversible!", "Això és irreversible!"),
         ("Deleting", "Eliminant"),
-        ("files", "arxius"),
+        ("files", "fitxers"),
         ("Waiting", "Esperant"),
         ("Finished", "Acabat"),
         ("Speed", "Velocitat"),
         ("Custom Image Quality", "Qualitat d'imatge personalitzada"),
         ("Privacy mode", "Mode privat"),
-        ("Block user input", "Bloquejar entrada d'usuari"),
-        ("Unblock user input", "Desbloquejar entrada d'usuari"),
-        ("Adjust Window", "Ajustar finestra"),
+        ("Block user input", "Bloqueja l'entrada d'usuari"),
+        ("Unblock user input", "Desbloqueja l'entrada d'usuari"),
+        ("Adjust Window", "Ajusta la finestra"),
         ("Original", "Original"),
         ("Shrink", "Reduir"),
         ("Stretch", "Estirar"),
         ("Scrollbar", "Barra de desplaçament"),
-        ("ScrollAuto", "Desplaçament automàtico"),
+        ("ScrollAuto", "Desplaçament automàtic"),
         ("Good image quality", "Bona qualitat d'imatge"),
         ("Balanced", "Equilibrat"),
-        ("Optimize reaction time", "Optimitzar el temps de reacció"),
+        ("Optimize reaction time", "Optimitza el temps de reacció"),
         ("Custom", "Personalitzat"),
-        ("Show remote cursor", "Mostrar cursor remot"),
-        ("Show quality monitor", "Mostrar qualitat del monitor"),
-        ("Disable clipboard", "Deshabilitar portapapers"),
-        ("Lock after session end", "Bloquejar després del final de la sessió"),
-        ("Insert", "Inserir"),
-        ("Insert Lock", "Inserir bloqueig"),
-        ("Refresh", "Actualitzar"),
+        ("Show remote cursor", "Mostra el cursor remot"),
+        ("Show quality monitor", "Mostra la qualitat del monitor"),
+        ("Disable clipboard", "Deshabilita el portapapers"),
+        ("Lock after session end", "Bloqueja després del final de la sessió"),
+        ("Insert", "Insereix"),
+        ("Insert Lock", "Insereix bloqueig"),
+        ("Refresh", "Actualitza"),
         ("ID does not exist", "L'ID no existeix"),
         ("Failed to connect to rendezvous server", "No es pot connectar al servidor rendezvous"),
-        ("Please try later", "Siusplau provi-ho més tard"),
+        ("Please try later", "Prova-ho més tard"),
         ("Remote desktop is offline", "L'escriptori remot està desconecctat"),
         ("Key mismatch", "La clau no coincideix"),
         ("Timeout", "Temps esgotat"),
         ("Failed to connect to relay server", "No es pot connectar al servidor de relay"),
         ("Failed to connect via rendezvous server", "No es pot connectar a través del servidor de rendezvous"),
         ("Failed to connect via relay server", "No es pot connectar a través del servidor de relay"),
         ("Failed to make direct connection to remote desktop", "No s'ha pogut establir una connexió directa amb l'escriptori remot"),
-        ("Set Password", "Configurar la contrasenya"),
+        ("Set Password", "Configura la contrasenya"),
         ("OS Password", "contrasenya del sistema operatiu"),
         ("install_tip", ""),
-        ("Click to upgrade", "Clicar per actualitzar"),
-        ("Click to download", "Clicar per descarregar"),
-        ("Click to update", "Clicar per refrescar"),
-        ("Configure", "Configurar"),
+        ("Click to upgrade", "Clica per a actualitzar"),
+        ("Click to download", "Clica per a descarregar"),
+        ("Click to update", "Clica per a refrescar"),
+        ("Configure", "Configurr"),
         ("config_acc", ""),
         ("config_screen", "Configurar pantalla"),
         ("Installing ...", "Instal·lant ..."),
-        ("Install", "Instal·lar"),
+        ("Install", "Instal·la"),
         ("Installation", "Instal·lació"),
         ("Installation Path", "Ruta d'instal·lació"),
         ("Create start menu shortcuts", "Crear accessos directes al menú d'inici"),
         ("Create desktop icon", "Crear icona d'escriptori"),
         ("agreement_tip", ""),
-        ("Accept and Install", "Acceptar i instal·lar"),
-        ("End-user license agreement", "Acord de llicència d'usuario final"),
+        ("Accept and Install", "Acceptar i instal·la"),
+        ("End-user license agreement", "Acord de llicència d'usuari final"),
         ("Generating ...", "Generant ..."),
-        ("Your installation is lower version.", "La seva instal·lació és una versión inferior."),
+        ("Your installation is lower version.", "La teva instal·lació és una versión inferior."),
         ("not_close_tcp_tip", ""),
         ("Listening ...", "Escoltant..."),
         ("Remote Host", "Hoste remot"),
         ("Remote Port", "Port remot"),
         ("Action", "Acció"),
-        ("Add", "Afegirr"),
+        ("Add", "Afegeix"),
         ("Local Port", "Port local"),
         ("Local Address", "Adreça Local"),
-        ("Change Local Port", "Canviar Port Local"),
+        ("Change Local Port", "Canvia el port local"),
         ("setup_server_tip", ""),
         ("Too short, at least 6 characters.", "Massa curt, almenys 6 caràcters."),
-        ("The confirmation is not identical.", "La confirmación no coincideix."),
+        ("The confirmation is not identical.", "La confirmació no coincideix."),
         ("Permissions", "Permisos"),
-        ("Accept", "Acceptar"),
-        ("Dismiss", "Cancel·lar"),
-        ("Disconnect", "Desconnectar"),
-        ("Enable file copy and paste", "Permetre copiar i enganxar arxius"),
+        ("Accept", "Accepta"),
+        ("Dismiss", "Cancel·la"),
+        ("Disconnect", "Desconnecta"),
+        ("Enable file copy and paste", "Permet copiar i enganxar fitxers"),
         ("Connected", "Connectat"),
         ("Direct and encrypted connection", "Connexió directa i xifrada"),
-        ("Relayed and encrypted connection", "connexió retransmesa i xifrada"),
-        ("Direct and unencrypted connection", "connexió directa i sense xifrar"),
-        ("Relayed and unencrypted connection", "connexió retransmesa i sense xifrar"),
-        ("Enter Remote ID", "Introduixi l'ID remot"),
-        ("Enter your password", "Introdueixi la seva contrasenya"),
+        ("Relayed and encrypted connection", "Connexió retransmesa i xifrada"),
+        ("Direct and unencrypted connection", "Connexió directa i sense xifrar"),
+        ("Relayed and unencrypted connection", "Connexió retransmesa i sense xifrar"),
+        ("Enter Remote ID", "Introdueix l'ID remot"),
+        ("Enter your password", "Introdueix la teva contrasenya"),
         ("Logging in...", "Iniciant sessió..."),
-        ("Enable RDP session sharing", "Habilitar l'ús compartit de sessions RDP"),
+        ("Enable RDP session sharing", "Habilita l'ús compartit de sessions RDP"),
         ("Auto Login", "Inici de sessió automàtic"),
-        ("Enable direct IP access", "Habilitar accés IP directe"),
-        ("Rename", "Renombrar"),
+        ("Enable direct IP access", "Habilita accés IP directe"),
+        ("Rename", "Renombra"),
         ("Space", "Espai"),
-        ("Create desktop shortcut", "Crear accés directe a l'escriptori"),
-        ("Change Path", "Cnviar ruta"),
-        ("Create Folder", "Crear carpeta"),
-        ("Please enter the folder name", "Indiqui el nom de la carpeta"),
+        ("Create desktop shortcut", "Crea accés directe a l'escriptori"),
+        ("Change Path", "Canvia la ruta"),

----------------------------------------

File: src/lang/cn.rs
Status: modified
Changes: +18 -4
Diff:
@@ -624,11 +624,25 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("Volume up", "提升音量"),
         ("Volume down", "降低音量"),
         ("Power", "电源"),
-        ("Telegram bot", ""),
-        ("enable-bot-tip", ""),
-        ("enable-bot-desc", ""),
+        ("Telegram bot", "Telegram 机器人"),
+        ("enable-bot-tip", "如果您启用此功能，您可以从您的机器人接收双重认证码，亦可作为连线通知之用。"),
+        ("enable-bot-desc", "1. 开启与 @BotFather 的对话。\n2. 发送命令 \"/newbot\"。 您将在完成此步骤后收到权杖 (Token)。\n3. 开始与您刚创建的机器人的对话。发送一则以正斜杠 (\"/\") 开头的消息来启用它，例如 \"/hello\"。"),

----------------------------------------

File: src/lang/cs.rs
Status: modified
Changes: +22 -8
Diff:
@@ -37,7 +37,7 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("Clipboard is empty", "Schránka je prázdná"),
         ("Stop service", "Zastavit službu"),
         ("Change ID", "Změnit ID"),
-        ("Your new ID", "Váše nové ID"),
+        ("Your new ID", "Vaše nové ID"),
         ("length %min% to %max%", "délka mezi %min% a %max%"),
         ("starts with a letter", "začíná písmenem"),
         ("allowed characters", "povolené znaky"),
@@ -160,7 +160,7 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("Create desktop icon", "Vytvořit ikonu na ploše"),
         ("agreement_tip", "Spuštěním instalace přijímáte licenční ujednání."),
         ("Accept and Install", "Přijmout a nainstalovat"),
-        ("End-user license agreement", "Licencenční ujednání s koncovým uživatelem"),
+        ("End-user license agreement", "Licenční ujednání s koncovým uživatelem"),
         ("Generating ...", "Vytváření ..."),
         ("Your installation is lower version.", "Máte nainstalovanou starší verzi"),
         ("not_close_tcp_tip", "Po dobu, po kterou tunel potřebujete, nezavírejte toto okno"),
@@ -263,7 +263,7 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("Canvas Move", "Posun zobrazení"),
         ("Pinch to Zoom", "Přiblížíte roztažením dvěma prsty"),
         ("Canvas Zoom", "Přiblížení zobrazení"),
-        ("Reset canvas", "Vrátit měřtko zobrazení na výchozí"),
+        ("Reset canvas", "Vrátit měřítko zobrazení na výchozí"),
         ("No permission of file transfer", "Žádné oprávnění k přenosu souborů"),
         ("Note", "Poznámka"),
         ("Connection", "Připojení"),
@@ -297,7 +297,7 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =

----------------------------------------

File: src/lang/da.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/de.rs
Status: modified
Changes: +18 -4
Diff:
@@ -22,7 +22,7 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("TCP tunneling", "TCP-Tunnelung"),
         ("Remove", "Entfernen"),
         ("Refresh random password", "Zufälliges Passwort erzeugen"),
-        ("Set your own password", "Eigenes Passwort setzen"),
+        ("Set your own password", "Eigenes Passwort festlegen"),
         ("Enable keyboard/mouse", "Tastatur und Maus aktivieren"),
         ("Enable clipboard", "Zwischenablage aktivieren"),
         ("Enable file transfer", "Dateiübertragung aktivieren"),
@@ -314,7 +314,7 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("Translate mode", "Übersetzungsmodus"),
         ("Use permanent password", "Permanentes Passwort verwenden"),
         ("Use both passwords", "Beide Passwörter verwenden"),
-        ("Set permanent password", "Permanentes Passwort setzen"),
+        ("Set permanent password", "Permanentes Passwort festlegen"),
         ("Enable remote restart", "Entfernten Neustart aktivieren"),

----------------------------------------

File: src/lang/el.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", "Είστε βέβαιοι ότι θέλετε να ακυρώσετε το 2FA;"),
         ("cancel-bot-confirm-tip", "Είστε βέβαιοι ότι θέλετε να ακυρώσετε το Telegram bot;"),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/en.rs
Status: modified
Changes: +2 -0
Diff:
@@ -232,5 +232,7 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", "Are you sure you want to cancel 2FA?"),
         ("cancel-bot-confirm-tip", "Are you sure you want to cancel Telegram bot?"),
         ("About RustDesk", ""),
+        ("network_error_tip", "Please check your network connection, then click retry."),
+        ("enable-trusted-devices-tip", "Skip 2FA verification on trusted devices"),
     ].iter().cloned().collect();
 }

----------------------------------------

File: src/lang/eo.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/es.rs
Status: modified
Changes: +16 -2
Diff:
@@ -48,7 +48,7 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("Privacy Statement", "Declaración de privacidad"),
         ("Mute", "Silenciar"),
         ("Build Date", "Fecha de compilación"),
-        ("Version", "¨Versión"),
+        ("Version", "Versión"),
         ("Home", "Inicio"),
         ("Audio Input", "Entrada de audio"),
         ("Enhancements", "Mejoras"),
@@ -629,6 +629,20 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =

----------------------------------------

File: src/lang/et.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/eu.rs
Status: modified
Changes: +646 -634
Diff:
@@ -1,636 +1,648 @@
 lazy_static::lazy_static! {
-    pub static ref T: std::collections::HashMap<&'static str, &'static str> =
-        [
-            ("Status", "Egoera"),
-            ("Your Desktop", "Zure mahaigaina"),
-            ("desk_tip", "Mahaigainera zure ID eta pasahitzarekin sartu zaitezke"),
-            ("Password", "Pasahitza"),
-            ("Ready", "Prest"),
-            ("Established", "Ezarrita"),
-            ("connecting_status", "RustDesk sarera konektatzen..."),
-            ("Enable service", "Gaitu zerbitzua"),
-            ("Start service", "Hasi zerbitzua"),
-            ("Service is running", "Zerbitzua martxan dago"),
-            ("Service is not running", "Zerbitzua ez dago martxan"),
-            ("not_ready_status", "Ez dago prest. Mesedez, egiaztatu zure konexioa"),
-            ("Control Remote Desktop", "Kontrolatu urruneko mahaigaina"),
-            ("Transfer file", "Transferitu fitxategia"),
-            ("Connect", "Konektatu"),
-            ("Recent sessions", "Azken saioak"),
-            ("Address book", "Helbide-liburua"),
-            ("Confirmation", "Berrespena"),
-            ("TCP tunneling", "TCP tunela"),
-            ("Remove", "Kendu"),
-            ("Refresh random password", "Freskatu ausazko pasahitza"),
-            ("Set your own password", "Ezarri zure pasahitza"),
-            ("Enable keyboard/mouse", "Gaitu teklatua/sagua"),
-            ("Enable clipboard", "Gaitu arbela"),
-            ("Enable file transfer", "Gaitu fitxategien transferentzia"),
-            ("Enable TCP tunneling", "Gaitu TCP tunela"),
-            ("IP Whitelisting", "Onartutako IP helbideak"),
-            ("ID/Relay Server", "ID/Relay zerbitzaria"),
-            ("Import server config", "Inportatu zerbitzariaren konfigurazioa"),
-            ("Export Server Config", "Esportatu zerbitzariaren konfigurazioa"),
-            ("Import server configuration successfully", "Zerbitzariaren konfigurazioa ondo inportatu da"),
-            ("Export server configuration successfully", "Zerbitzariaren konfigurazioa ondo esportatu da"),
-            ("Invalid server configuration", "Zerbitzariaren konfigurazioa baliogabea da"),
-            ("Clipboard is empty", "Arbela hutsik dago"),
-            ("Stop service", "Gelditu zerbitzua"),
-            ("Change ID", "Aldatu IDa"),
-            ("Your new ID", "Zure ID berria"),
-            ("length %min% to %max%", "%min%(e)tik %max% arteko luzera"),
-            ("starts with a letter", "hizki batekin hasten da"),
-            ("allowed characters", "onartutako karaktereak"),
-            ("id_change_tip", "Soilik a-z, A-Z, 0-9 eta _ (barra baxua) karaktereak daude onartuta. Lehen hizkia a-z, A-Z izan behar da. Luzera 6 eta 16 artekoa izan behar da."),
-            ("Website", "Webgunea"),
-            ("About", "Honi buruz"),
-            ("Slogan_tip", "Bihotzez eginda mundu kaotiko honetan!"),
-            ("Privacy Statement", "Pribatutasun-politika"),
-            ("Mute", "Mututu"),
-            ("Build Date", "Konpilazio-data"),
-            ("Version", "Bertsioa"),
-            ("Home", "Hasiera"),
-            ("Audio Input", "Audio sarrera"),
-            ("Enhancements", "Hobespenak"),
-            ("Hardware Codec", "Hardware kodeka"),
-            ("Adaptive bitrate", "Bit-emari moldagarria"),
-            ("ID Server", "ID zerbitzaria"),
-            ("Relay Server", "Relay zerbitzaria"),
-            ("API Server", "API zerbitzaria"),
-            ("invalid_http", "http:// edo https://-rekin hasi behar da"),
-            ("Invalid IP", "IP baliogabea"),
-            ("Invalid format", "Formatu baliogabea"),
-            ("server_not_support", "Oraindik ez dago zerbitzariarengatik onartuta"),
-            ("Not available", "Ez dago eskuragarri"),
-            ("Too frequent", "Sarriegia"),
-            ("Cancel", "Utzi"),
-            ("Skip", "Saltatu"),
-            ("Close", "Itxi"),
-            ("Retry", "Saiatu berriro"),
-            ("OK", "Ondo"),
-            ("Password Required", "Pasahitza beharrezkoa da"),
-            ("Please enter your password", "Mesedez, sartu zure pasahitza"),
-            ("Remember password", "Gogoratu pasahitza"),
-            ("Wrong Password", "Pasahitz okerra"),
-            ("Do you want to enter again?", "Berriro sartu nahi zara?"),
-            ("Connection Error", "Konexio errorea"),
-            ("Error", "Errorea"),
-            ("Reset by the peer", "Konexioa parekidearengatik berrezarrita"),
-            ("Connecting...", "Konektatzen..."),
-            ("Connection in progress. Please wait.", "Konexioa abian da. Itxaron mesedez."),
-            ("Please try 1 minute later", "Mesedez, saiatu berrito minutu bat pasata"),
-            ("Login Error", "Saio-hasiera errorea"),
-            ("Successful", "Arrakastatsua"),
-            ("Connected, waiting for image...", "Konektatuta, irudiaren zain..."),
-            ("Name", "Izena"),
-            ("Type", "Mota"),
-            ("Modified", "Aldatua"),
-            ("Size", "Tamaina"),
-            ("Show Hidden Files", "Erakutsi ezkutuko fitxategiak"),
-            ("Receive", "Jaso"),
-            ("Send", "Bidali"),
-            ("Refresh File", "Freskatu fitxategia"),
-            ("Local", "Lokala"),
-            ("Remote", "Urrunekoa"),
-            ("Remote Computer", "Urruneko ordenagailua"),
-            ("Local Computer", "Ordenagailu lokala"),
-            ("Confirm Delete", "Berretsi ezabapena"),
-            ("Delete", "Ezabatu"),
-            ("Properties", "Ezaugarriak"),
-            ("Multi Select", "Multi-hautapena"),
-            ("Select All", "Hautatu guztiak"),
-            ("Unselect All", "Desautatu denak"),
-            ("Empty Directory", "Karpeta hutsa"),
-            ("Not an empty directory", "Ez da karpeta huts bat"),
-            ("Are you sure you want to delete this file?", "Ziur zaude fitxategi hau ezabatu nahi duzula?"),
-            ("Are you sure you want to delete this empty directory?", "Ziur zaude karpeta huts hau ezabatu nahi duzula?"),
-            ("Are you sure you want to delete the file of this directory?", "Ziur zaude karpeta honen fitxategia ezabatu nahi duzula?"),
-            ("Do this for all conflicts", "Egin hau gatazka guztietarako"),
-            ("This is irreversible!", "Hau ezin da atzera bueltatu!"),
-            ("Deleting", "Ezabatzen"),
-            ("files", "fitxategiak"),
-            ("Waiting", "Zain"),
-            ("Finished", "Bukatuta"),
-            ("Speed", "Abiadura"),
-            ("Custom Image Quality", "Irudi kalitate pertsonalizatua"),
-            ("Privacy mode", "Pribatutasun modua"),
-            ("Block user input", "Blokeatu erabiltzailearen sarrera"),
-            ("Unblock user input", "Desblokeatu erabiltzailearen sarrera"),
-            ("Adjust Window", "Doitu leihoa"),
-            ("Original", "Originala"),
-            ("Shrink", "Txikitu"),
-            ("Stretch", "Luzatu"),
-            ("Scrollbar", "Korritze-barra"),
-            ("ScrollAuto", "Korritze automatikoa"),
-            ("Good image quality", "Irudi kalitate ona"),
-            ("Balanced", "Orekatua"),
-            ("Optimize reaction time", "Optimizatu erreakzio-denbiora"),
-            ("Custom", "Pertsonalizatua"),
-            ("Show remote cursor", "Erakutsi urruneko kurtsorea"),
-            ("Show quality monitor", "Erakutsi kalitate monitorea"),
-            ("Disable clipboard", "Desgaitu arbela"),
-            ("Lock after session end", "Blokeatu sesioa amaitu ostean"),
-            ("Insert", "Sartu"),
-            ("Insert Lock", "Sarrera-blokeoa"),
-            ("Refresh", "Freskatu"),
-            ("ID does not exist", "IDa ez da existitzen"),
-            ("Failed to connect to rendezvous server", "Topaketa zerbitzarira konektatzeak huts egin du"),
-            ("Please try later", "Mesedez, saiatu berriro geroago"),
-            ("Remote desktop is offline", "Urruneko mahaigaina lineaz kanpo dago"),
-            ("Key mismatch", "Gakoak ez datoz bat"),
-            ("Timeout", "Denbora-muga"),
-            ("Failed to connect to relay server", "Igorpen zerbitzarira konektatzeak huts egin du"),
-            ("Failed to connect via rendezvous server", "Topaketa zerbitzariaren bidez konektatzeak huts egin du"),
-            ("Failed to connect via relay server", "Igorpen zerbitzariaren bidez konektatzeak huts egin du"),
-            ("Failed to make direct connection to remote desktop", "Urruneko mahaigainera zuzeneko konexio bat ezartzeak huts egin du"),
-            ("Set Password", "Ezarri pasahitza"),
-            ("OS Password", "Sistema eragilearen pasahitza"),
-            ("install_tip", "Erabiltzaile Kontuen Kontrolarengatik, RustDesk ezin du ondo funtzionatu urruneko mahaigainean. EKK saihesteko, mesedez, egin klik azpiko botoian RustDesk sistema mailan instalatzeko."),
-            ("Click to upgrade", "Egin klik bertsio-berritzeko"),
-            ("Click to download", "Egin klik deskargatzeko"),
-            ("Click to update", "Egin klik eguneratzeko"),
-            ("Configure", "Konfiguratu"),
-            ("config_acc", "Zure mahaigaina urrunetik kontrolatzeko, RustDesk-i \"Irisgarritasuna\" baimenak eman behar dituzu."),
-            ("config_screen", "Zure mahaigaina kanpotik kontrolatzeko, RustDesk-i \"Pantaila grabatu\" baimena eman behar duzu."),
-            ("Installing ...", "Instalantzen..."),
-            ("Install", "Instalatu"),
-            ("Installation", "Instalazioa"),
-            ("Installation Path", "Instalazio bide-izena"),
-            ("Create start menu shortcuts", "Sortu hasiera-menuko lasterbideak"),
-            ("Create desktop icon", "Sortu mahaigaineko ikonoa"),
-            ("agreement_tip", "Instalazioa hastean, lizentzia-kontratua onartzen duzu."),
-            ("Accept and Install", "Onartu eta instalatu"),
-            ("End-user license agreement", "Azken erabiltzailearen lizentzia akordioa"),
-            ("Generating ...", "Sortzen..."),
-            ("Your installation is lower version.", "Zure instalazioak bertsio zaharragoa du."),
-            ("not_close_tcp_tip", "Ez itxi leiho hau tunela erabili bitartean"),
-            ("Listening ...", "Entzuten..."),
-            ("Remote Host", "Urruneko ostalaria"),
-            ("Remote Port", "Urruneko ataka"),
-            ("Action", "Ekintza"),
-            ("Add", "Gehitu"),
-            ("Local Port", "Ataka lokala"),
-            ("Local Address", "Helbide lokala"),
-            ("Change Local Port", "Aldatu ataka lokala"),
-            ("setup_server_tip", "Konexio azkarragorako, konfiguratu zure zerbitzaria"),
-            ("Too short, at least 6 characters.", "Laburregia, 6 karaktere gutxienez."),
-            ("The confirmation is not identical.", "Berrespena ez dator bat."),
-            ("Permissions", "Baimenak"),
-            ("Accept", "Onartu"),
-            ("Dismiss", "Ezeztatu"),
-            ("Disconnect", "Deskonektatu"),
-            ("Enable file copy and paste", "Gaitu fitxategien kopiatze eta itsastea"),
-            ("Connected", "Konektatuta"),
-            ("Direct and encrypted connection", "Zifratutako konexio zuzena"),
-            ("Relayed and encrypted connection", "Zifratutako konexio igorria"),
-            ("Direct and unencrypted connection", "Zifratu gabeko konexio zuzena"),
-            ("Relayed and unencrypted connection", "Zifratu gabeko konexio igorria"),
-            ("Enter Remote ID", "Sartu urruneko IDa"),
-            ("Enter your password", "Sartu zure pasahitza"),
-            ("Logging in...", "Saioa hasten..."),
-            ("Enable RDP session sharing", "Gaitu RDP saio-partekatzea"),
-            ("Auto Login", "Saio-haste automatikoa"),
-            ("Enable direct IP access", "Gaitu IP sarbide zuzena"),
-            ("Rename", "Berrizendatu"),
-            ("Space", "Zuriunea"),
-            ("Create desktop shortcut", "Sortu mahaigaineko lasterbidea"),
-            ("Change Path", "Aldatu bide-izena"),
-            ("Create Folder", "Sortu karpeta"),
-            ("Please enter the folder name", "Mesedez, sartu karpetaren izena"),
-            ("Fix it", "Konpondu"),
-            ("Warning", "Oharra"),
-            ("Login screen using Wayland is not supported", "Saio-hasiera Wayland erabilita ez dago onartuta"),
-            ("Reboot required", "Berrabiaraztea beharrezkoa"),
-            ("Unsupported display server", "Bistaratze-zerbitzaria ez da bateragarria"),
-            ("x11 expected", "x11 espero zen"),
-            ("Port", "Ataka"),
-            ("Settings", "Ezarpenak"),
-            ("Username", "Erabiltzaile-izena"),
-            ("Invalid port", "Ataka baliogabea"),
-            ("Closed manually by the peer", "Parekideak konexioa eskuz itxi du"),
-            ("Enable remote configuration modification", "Gaitu urruneko konfigurazio-aldaketak"),
-            ("Run without install", "Exekutatu instalatu gabe"),
-            ("Connect via relay", "Konektatu igorpen-zerbitzari batetik"),
-            ("Always connect via relay", "Konektatu beti igorpen-zerbitzari batetik"),
-            ("whitelist_tip", "Baimendutako IPak soilik konektatu daitezke mahaigain honetara"),
-            ("Login", "Saio-hasiera"),
-            ("Verify", "Egiaztatu"),
-            ("Remember me", "Gogoratu"),
-            ("Trust this device", "Gailu honetaz fidatu"),
-            ("Verification code", "Egiaztapen-kodea"),
-            ("verification_tip", "Egiaztapen-kode bat bidali da erregistratutako helbide elektronikora. Sartu egiaztapen-kodea saio-hasiera jarraitzeko."),
-            ("Logout", "Saioa bukatu"),
-            ("Tags", "Etiketak"),
-            ("Search ID", "Bilatu IDa"),
-            ("whitelist_sep", "Koma, puntu koma, zuriune edo lerro berriengatik banatuta"),
-            ("Add ID", "Gehitu IDa"),
-            ("Add Tag", "Gehitu etiketa"),
-            ("Unselect all tags", "Desautatu etiketa guztiak"),
-            ("Network error", "Sare-errorea"),
-            ("Username missed", "Erabiltzaile-izena ahaztu duzu"),
-            ("Password missed", "Pasahitza ahaztu duzu"),
-            ("Wrong credentials", "Kredentzial baliogabeak"),
-            ("The verification code is incorrect or has expired", "Egiaztapen-kodea baliogabe edo iraungitua da"),
-            ("Edit Tag", "Editatu etiketa"),
-            ("Forget Password", "Ahaztu pasahitza"),
-            ("Favorites", "Gogokoenak"),
-            ("Add to Favorites", "Gehitu gogokoenetara"),
-            ("Remove from Favorites", "Kendu gpgokoenetatik"),
-            ("Empty", "Hutsik"),
-            ("Invalid folder name", "Karpeta-izen baliogabea"),
-            ("Socks5 Proxy", "Socks5 proxia"),
-            ("Socks5/Http(s) Proxy", "Socks5/Http(s) proxia"),
-            ("Discovered", "Aurkituta"),
-            ("install_daemon_tip", "Ordenagailua pizterakoan hasteko, sistemaren zerbitzua instalatu behar duzu."),
-            ("Remote ID", "Urruneko IDa"),
-            ("Paste", "Itsatsi"),
-            ("Paste here?", "Itsatsi hemen?"),
-            ("Are you sure to close the connection?", "Ziur zaude konexioa itxi nahi duzula?"),
-            ("Download new version", "Deskargatu bertsio berria"),
-            ("Touch mode", "Ukipen modua"),
-            ("Mouse mode", "Sagu modua"),
-            ("One-Finger Tap", "Hatz bakarreko ukipena"),
-            ("Left Mouse", "Ezkerreko botoia"),
-            ("One-Long Tap", "Ukipen luzea"),
-            ("Two-Finger Tap", "Bi hatzeko ukipena"),
-            ("Right Mouse", "Eskuineko botoia"),
-            ("One-Finger Move", "Hatz bakarreko mugimendua"),
-            ("Double Tap & Move", "Bi aldiz ukitu eta mugitu"),
-            ("Mouse Drag", "Saguarekin arrastatu"),
-            ("Three-Finger vertically", "Hiru hatz bertikalki"),
-            ("Mouse Wheel", "Saguaren gurpila"),
-            ("Two-Finger Move", "Bi hatzeko mugimendua"),
-            ("Canvas Move", "Oihal-mugimendua"),
-            ("Pinch to Zoom", "Atximurkatu zoom egiteko"),
-            ("Canvas Zoom", "Oihal-zooma"),
-            ("Reset canvas", "Berrezarri oihala"),
-            ("No permission of file transfer", "Ez duzu baimenik fitxategiak transferitzeko"),
-            ("Note", "Nota"),
-            ("Connection", "Konexioa"),
-            ("Share Screen", "Partekatu pantaila"),
-            ("Chat", "Txata"),
-            ("Total", "Guztira"),
-            ("items", "elementuak"),
-            ("Selected", "hautatuta"),
-            ("Screen Capture", "Pantaila-grabazioa"),
-            ("Input Control", "Sarrera-kontrola"),
-            ("Audio Capture", "Audio-grabazioa"),
-            ("File Connection", "Fitxategi-konexioa"),
-            ("Screen Connection", "Pantaila-konexioa"),
-            ("Do you accept?", "Onartzen al duzu?"),
-            ("Open System Setting", "Ireki sistemaren ezarpenak"),
-            ("How to get Android input permission?", "Nola lortu dezaket Android sarrera-baimena?"),
-            ("android_input_permission_tip1", "Urruneko gailu batek zure Android gailua saguaren edo ukipenaren bidez kontrolatzeko, RustDesk \"Irisgarritasuna\" zerbitzua erabiltzeko baimena eman behar diozu."),
-            ("android_input_permission_tip2", "Joan hurrengo irekiko den sistemaren konfigurazio orrira, bilatu eta sartu [Instalatutako zerbitzuak], aktibatu [RustDesk Input] zerbitzua."),
-            ("android_new_connection_tip", "Kontrol-eskaera berri bat jaso da uneko gailuarentzat."),
-            ("android_service_will_start_tip", "Pantaila-argazkia gaitzen baduzu, zerbitzua automatikoki abiaraziko da, eta beste gailu batzuek gailu honetatik konexioa eskatzeko aukera izango dute."),
-            ("android_stop_service_tip", "Zerbitzua ixteak ezarritako konexio guztiak automatikoki itxiko ditu."),
-            ("android_version_audio_tip", "Uneko Android bertsioak ez du audioa grabatzea onartzen; mesedez, eguneratu Android 10 edo berrira."),
-            ("android_start_service_tip", "Sakatu [Hasi zerbitzua] edo gaitu [Pantaila-grabazioa] baimena pantaila-partekatzea hasteko."),
-            ("android_permission_may_not_change_tip", "Ezarritako konexioen baimenak ez dira aldatuko berriro konektatu arte."),
-            ("Account", "Kontua"),
-            ("Overwrite", "Berridatzi"),
-            ("This file exists, skip or overwrite this file?", "Fitxategi hau existitzen da dagoeneko, saltatu edo berridatzi nahi duzu?"),
-            ("Quit", "Irten"),
-            ("Help", "Laguntza"),
-            ("Failed", "Huts egin du"),
-            ("Succeeded", "Arrakastatsua izan da"),
-            ("Someone turns on privacy mode, exit", "Norbaitek pribatutasun modua hasten du, irten"),
-            ("Unsupported", "Ez da onartzen"),
-            ("Peer denied", "Parekidea ukatuta"),
-            ("Please install plugins", "Mesedez, instalatu plugin hauek"),
-            ("Peer exit", "Parekidea irten da"),
-            ("Failed to turn off", "Itzaltzeak huts egin du"),
-            ("Turned off", "Itzalita"),
-            ("Language", "Hizkuntza"),
-            ("Keep RustDesk background service", "Mantendu RustDesk atzeko planoko zerbitzu bezala"),
-            ("Ignore Battery Optimizations", "Ezikusi bateria optimizazioak"),
-            ("android_open_battery_optimizations_tip", "Ezaugarri hau desgaitu nahi baduzu, joan zaitez RustDesk aplikazioaren ezarpen orrira, bilatu eta saltu [Bateria] orrira eta kendu [Mugarik gabe]"),
-            ("Start on boot", "Hasi abiaraztean"),
-            ("Start the screen sharing service on boot, requires special permissions", "Hasi pantaila-partekatze zerbitzua abiaraztean, baimen bereziak behar ditu"),
-            ("Connection not allowed", "Konexioa ez dago baimenduta"),
-            ("Legacy mode", "Legatu-modua"),
-            ("Map mode", "Mapa modua"),
-            ("Translate mode", "Itzultze modua"),
-            ("Use permanent password", "Erabili betirako pasahitza"),
-            ("Use both passwords", "Erabili bi pasahitzak"),
-            ("Set permanent password", "Ezarri betirako pasahitza"),
-            ("Enable remote restart", "Gaitu urruneko berrabiaraztea"),
-            ("Restart remote device", "Berrabiarazi urruneko gailua"),
-            ("Are you sure you want to restart", "Ziur zaude berrabiarazi nahi duzula?"),
-            ("Restarting remote device", "Urruneko gailua berrabiarazten"),
-            ("remote_restarting_tip", "Urruneko gailua berrabiarazten dabil. Mesedez, itxi mezu hau eta konektatu betirako pasahitzarekin une bat pasa ostean."),
-            ("Copied", "Kopiatuta"),
-            ("Exit Fullscreen", "Irten pantaila osotik"),
-            ("Fullscreen", "Pantaila osoa"),
-            ("Mobile Actions", "Mugikor-ekintzak"),
-            ("Select Monitor", "Hautatu monitorea"),
-            ("Control Actions", "Kontrol-ekintzak"),
-            ("Display Settings", "Pantailaren ezarpenak"),
-            ("Ratio", "Erlazioa"),
-            ("Image Quality", "Irudiaren kalitatea"),
-            ("Scroll Style", "Korritze estiloa"),
-            ("Show Toolbar", "Erakutsi tresna-barra"),
-            ("Hide Toolbar", "Ezkutatu tresna-barra"),
-            ("Direct Connection", "Konexio zuzena"),
-            ("Relay Connection", "Konexio igorria"),
-            ("Secure Connection", "Konexio segurua"),
-            ("Insecure Connection", "Konexio ez-segurua"),
-            ("Scale original", "Jatorrizko eskala"),
-            ("Scale adaptive", "Eskala moldagarria"),
-            ("General", "Orokorra"),
-            ("Security", "Segurtasuna"),
-            ("Theme", "Itxura"),
-            ("Dark Theme", "Itxura iluna"),
-            ("Light Theme", "Itxura argia"),
-            ("Dark", "Iluna"),
-            ("Light", "Argia"),
-            ("Follow System", "Jarraitu sistemaren itxura"),
-            ("Enable hardware codec", "Gaitu hardware kodeka"),
-            ("Unlock Security Settings", "Desblokeatu segurtasun ezarpenak"),
-            ("Enable audio", "Gaitu audioa"),
-            ("Unlock Network Settings", "Desblokeatu sare-ezarpenak"),
-            ("Server", "Zerbitzaria"),
-            ("Direct IP Access", "IP sarbide zuzena"),
-            ("Proxy", "Proxia"),
-            ("Apply", "Aplikatu"),
-            ("Disconnect all devices?", "Deskonektatu gailu guztiak?"),
-            ("Clear", "Garbitu"),
-            ("Audio Input Device", "Audio sarrera gailua"),
-            ("Use IP Whitelisting", "Erabili IP onartuen zerrenda"),
-            ("Network", "Sarea"),
-            ("Pin Toolbar", "Ainguratu tresna-barra"),
-            ("Unpin Toolbar", "Aingura kendu tresna-barrari"),
-            ("Recording", "Grabatzen"),
-            ("Directory", "Direktorioa"),
-            ("Automatically record incoming sessions", "Automatikoki grabatu sarrerako saioak"),
-            ("Change", "Aldatu"),
-            ("Start session recording", "Hasi saioaren grabaketa"),
-            ("Stop session recording", "Gelditu saioaren grabaketa"),
-            ("Enable recording session", "Gaitu saioen grabaketa"),
-            ("Enable LAN discovery", "Gaitu LAN ezagutza"),
-            ("Deny LAN discovery", "Ukatu LAN ezagutza"),
-            ("Write a message", "Idatzi mezu bat"),
-            ("Prompt", "Testu-gonbita"),
-            ("Please wait for confirmation of UAC...", "Mesedez, itxaron UAC berrespenari"),
-            ("elevated_foreground_window_tip", "Mahaigaineko uneko urruneko leihoak goi mailako baimenak behar ditu funtzionatzeko. Beraz, ezin duzu sagua eta teklatua erabili aldi baterako. Urruneko erabiltzaileari uneko leihoa minizatu edo kudeatze-leihoan maila igotzeko botoia erabili dezan eskatu diezaiokezu. Arazo hau saihesteko, programa instalatzea gomendatzen da urruneko gailuan."),
-            ("Disconnected", "Deskonektatuta"),
-            ("Other", "Besteak"),
-            ("Confirm before closing multiple tabs", "Berretsi fitxa ugari itxi baino lehen"),
-            ("Keyboard Settings", "Teklatuaren ezarpenak"),
-            ("Full Access", "Sarbide osoa"),
-            ("Screen Share", "Pantailaren partekatzea"),
-            ("Wayland requires Ubuntu 21.04 or higher version.", "Wayland Ubuntu 21.04 edo bertsio berriagoa behar du."),
-            ("Wayland requires higher version of linux distro. Please try X11 desktop or change your OS.", "Wayland-ek linux banaketa berriago bat behar du. Saiatu X11 mahaigainarekin edo aldatu zure sistema eragilea."),
-            ("JumpLink", "Ikusi"),
-            ("Please Select the screen to be shared(Operate on the peer side).", "Mesedez, hautatu partekatuko den pantaila (Kudeatu parekidearen aldean)"),
-            ("Show RustDesk", "Erakutsi RustDesk"),
-            ("This PC", "PC hau"),
-            ("or", "edo"),
-            ("Continue with", "Jarraitu honekin"),
-            ("Elevate", "Igo maila"),
-            ("Zoom cursor", "Handitu kurtsorea"),
-            ("Accept sessions via password", "Onartu saioak pasahitzaren bidez"),
-            ("Accept sessions via click", "Onartu saioak klikaren bidez"),
-            ("Accept sessions via both", "Onatu saioak bientzako"),
-            ("Please wait for the remote side to accept your session request...", "Mesedez, itxaron urruneko aldeak zure saio eskaera onartu dezan..."),
-            ("One-time Password", "Aldi bateko pasahitza"),
-            ("Use one-time password", "Erabili aldi baterako pasahitza"),
-            ("One-time password length", "Aldi baterako pasahitzaren luzera"),
-            ("Request access to your device", "Eskatu sarrera zure gailura"),
-            ("Hide connection management window", "Ezkutatu konexio kudeatze leihoa"),
-            ("hide_cm_tip", "Utzi ezkutatzen saioak pasahitzarekin onartzen badira eta pasahitza betirakoa bada"),
-            ("wayland_experiment_tip", "Wayland euskarria oraindik fase esperimentalean dago, mesedez, erabili X11 arretarik gabeko sarrera behar baduzu."),
-            ("Right click to select tabs", "Eskuineko klika fitxak hautatzeko"),
-            ("Skipped", "Saltatuta"),
-            ("Add to address book", "Gehitu helbide-liburura"),
-            ("Group", "Taldea"),
-            ("Search", "Bilatu"),
-            ("Closed manually by web console", "Web kontsolarengatik eskuz itxita"),
-            ("Local keyboard type", "Teklatu mota lokala"),
-            ("Select local keyboard type", "Hautatu teklatu mota lokala"),
-            ("software_render_tip", "Nvidia bideo-txartela baduzu eta urruneko leihoa berehala ixten bada, nouveau driver-a instalatzea eta software errenderizazioa hautatzea lagundu dezake. Aplikazioa berrabiarazi behar da."),
-            ("Always use software rendering", "Erabili software bidezko errenderizazioa beti"),
-            ("config_input", "Urruneko mahaigaina teklatuaren bidez kontrolatzeko, RustDesk-i \"Sarrera monitorizazioa\" baimena eman behar diozu."),
-            ("config_microphone", "Urrunetik hitz egin ahal izateko, RustDeski-i \"Grabatu audioa\" baimena eman behar diozu."),
-            ("request_elevation_tip", "Pribilegioen maila igotzea eskatu ahal duzu ere norbait badago urruneko aldean"),
-            ("Wait", "Itxaron"),
-            ("Elevation Error", "Maila-igotze errorea"),
-            ("Ask the remote user for authentication", "Eskatu autentifikazioa urruneko erabiltzaileari"),
-            ("Choose this if the remote account is administrator", "Aukeratu urruneko kontua administratzailea bada"),
-            ("Transmit the username and password of administrator", "Igorri administratzailearen erabiltzailea eta pasahitza"),
-            ("still_click_uac_tip", "Oraindik beharrezkoa da urruneko erabiltzaileak Ondo botoiari klik egitea exekutatzen ari den RustDesk UAC leihoan"),
-            ("Request Elevation", "Eskatu pribilegioen maila igotzea"),
-            ("wait_accept_uac_tip", "Mesedez, itxaron urruneko erabiltzaileak UAC onartu arte."),
-            ("Elevate successfully", "Maila igotzea ondo joan da"),
-            ("uppercase", "maiuskula"),
-            ("lowercase", "minuskula"),

----------------------------------------

File: src/lang/fa.rs
Status: modified
Changes: +30 -16
Diff:
@@ -610,25 +610,39 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("clear_Wayland_screen_selection_tip", "پس از پاک کردن صفحه انتخابی، می توانید صفحه را برای اشتراک گذاری مجدد انتخاب کنید"),
         ("confirm_clear_Wayland_screen_selection_tip", "را پاک می کنید؟ Wayland آیا مطمئن هستید که انتخاب صفحه"),
         ("android_new_voice_call_tip", "یک درخواست تماس صوتی جدید دریافت شد. اگر بپذیرید، صدا به ارتباط صوتی تغییر خواهد کرد."),
-        ("texture_render_tip", ""),
-        ("Use texture rendering", ""),
-        ("Floating window", ""),
-        ("floating_window_tip", ""),
-        ("Keep screen on", ""),
-        ("Never", ""),
+        ("texture_render_tip", "از رندر بافت برای صاف کردن تصاویر استفاده کنید. اگر با مشکل رندر مواجه شدید، می توانید این گزینه را غیرفعال کنید."),
+        ("Use texture rendering", "از رندر بافت استفاده کنید"),
+        ("Floating window", "پنجره شناور"),
+        ("floating_window_tip", "کمک می کند RustDesk این به حفظ سرویس پس زمینه"),
+        ("Keep screen on", "صفحه نمایش را روشن نگه دارید"),
+        ("Never", "هرگز"),
         ("During controlled", ""),
         ("During service is on", ""),

----------------------------------------

File: src/lang/fr.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/he.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/hr.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/hu.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/id.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/it.rs
Status: modified
Changes: +23 -9
Diff:
@@ -46,7 +46,7 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("About", "Info programma"),
         ("Slogan_tip", "Realizzato con il cuore in questo mondo caotico!"),
         ("Privacy Statement", "Informativa sulla privacy"),
-        ("Mute", "Audio off"),
+        ("Mute", "Audio disabilitato"),
         ("Build Date", "Data build"),
         ("Version", "Versione"),
         ("Home", "Home"),
@@ -208,7 +208,7 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("Username", "Nome utente"),
         ("Invalid port", "Numero porta non valido"),
         ("Closed manually by the peer", "Chiuso manualmente dal dispositivo remoto"),
-        ("Enable remote configuration modification", "Abilita la modifica remota della configurazione"),
+        ("Enable remote configuration modification", "Abilita modifica remota configurazione"),
         ("Run without install", "Esegui senza installare"),
         ("Connect via relay", "Collegati tramite relay"),
         ("Always connect via relay", "Collegati sempre tramite relay"),
@@ -541,19 +541,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("I Agree", "Accetto"),
         ("Decline", "Non accetto"),
         ("Timeout in minutes", "Timeout in minuti"),
-        ("auto_disconnect_option_tip", "Chiudi automaticamente sessioni in entrata in caso di inattività utente"),
+        ("auto_disconnect_option_tip", "Chiudi automaticamente sessioni in entrata per inattività utente"),
         ("Connection failed due to inactivity", "Connessione non riuscita a causa di inattività"),
         ("Check for software update on startup", "All'avvio verifica presenza aggiornamenti programma"),

----------------------------------------

File: src/lang/ja.rs
Status: modified
Changes: +15 -2
Diff:
@@ -430,7 +430,7 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("length>=8", "8文字以上"),
         ("Weak", "脆弱"),
         ("Medium", "普通"),
-        ("Strong", "協力"),
+        ("Strong", "強力"),
         ("Switch Sides", "接続方向の切り替え"),
         ("Please confirm if you want to share your desktop?", "デスクトップの共有を許可しますか？"),
         ("Display", "ディスプレイ"),
@@ -630,6 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =

----------------------------------------

File: src/lang/ko.rs
Status: modified
Changes: +64 -50
Diff:
@@ -341,11 +341,11 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("General", "일반"),
         ("Security", "보안"),
         ("Theme", "테마"),
-        ("Dark Theme", "다크 테마"),
-        ("Light Theme", "라이트 테마"),
-        ("Dark", "다크"),
-        ("Light", "라이트"),
-        ("Follow System", "시스템 설정에따름"),
+        ("Dark Theme", "어두운 테마"),
+        ("Light Theme", "밝은 테마"),
+        ("Dark", "어둡게"),
+        ("Light", "밝게"),
+        ("Follow System", "시스템 기본값"),
         ("Enable hardware codec", "하드웨어 코덱 활성화"),
         ("Unlock Security Settings", "보안 설정 잠금 해제"),
         ("Enable audio", "오디오 활성화"),
@@ -585,50 +585,64 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("Please select the session you want to connect to", "연결하려는 세션을 선택하세요."),
         ("powered_by_me", "RustDesk 제공"),
         ("outgoing_only_desk_tip", "이것은 맞춤형 버전입니다.\n다른 장치에 연결할 수 있지만 다른 장치는 귀하의 장치에 연결할 수 없습니다."),
-        ("preset_password_warning", ""),
-        ("Security Alert", ""),
-        ("My address book", ""),
-        ("Personal", ""),
-        ("Owner", ""),
-        ("Set shared password", ""),
-        ("Exist in", ""),
-        ("Read-only", ""),
-        ("Read/Write", ""),
-        ("Full Control", ""),
-        ("share_warning_tip", ""),
-        ("Everyone", ""),
-        ("ab_web_console_tip", ""),
-        ("allow-only-conn-window-open-tip", ""),
-        ("no_need_privacy_mode_no_physical_displays_tip", ""),
-        ("Follow remote cursor", ""),
-        ("Follow remote window focus", ""),
-        ("default_proxy_tip", ""),
-        ("no_audio_input_device_tip", ""),
-        ("Incoming", ""),
-        ("Outgoing", ""),

----------------------------------------

File: src/lang/kz.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/lt.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/lv.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", "Vai tiešām vēlaties atcelt 2FA?"),
         ("cancel-bot-confirm-tip", "Vai tiešām vēlaties atcelt Telegram robotu?"),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/nb.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/nl.rs
Status: modified
Changes: +15 -1
Diff:
@@ -629,6 +629,20 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("enable-bot-desc", "1, Open een chat met @BotFather.\n2, Verzend het commando \"/newbot\". Als deze stap voltooid is, ontvang je een token.\n3, Start een chat met de nieuw aangemaakte bot. Om hem te activeren stuurt u een bericht dat begint met een schuine streep (\"/\"), bijvoorbeeld \"/hello\".\n"),
         ("cancel-2fa-confirm-tip", "Weet je zeker dat je 2FA wilt annuleren?"),
         ("cancel-bot-confirm-tip", "Weet je zeker dat je de Telegram-bot wilt annuleren?"),
-        ("About RustDesk", ""),
+        ("About RustDesk", "Over RustDesk"),
+        ("Send clipboard keystrokes", "Klembord toetsaanslagen verzenden"),
+        ("network_error_tip", "Controleer de netwerkverbinding en selecteer 'Opnieuw proberen'."),
+        ("Unlock with PIN", "Ontgrendelen met PIN"),
+        ("Requires at least {} characters", "Vereist minstens {} tekens"),

----------------------------------------

File: src/lang/pl.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/pt_PT.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/ptbr.rs
Status: modified
Changes: +25 -11
Diff:
@@ -559,21 +559,21 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("Big tiles", ""),
         ("Small tiles", ""),
         ("List", "Lista"),
-        ("Virtual display", ""),
+        ("Virtual display", "Display Virtual"),
         ("Plug out all", ""),
         ("True color (4:4:4)", ""),
         ("Enable blocking user input", ""),
         ("id_input_tip", ""),
         ("privacy_mode_impl_mag_tip", ""),
         ("privacy_mode_impl_virtual_display_tip", ""),
-        ("Enter privacy mode", ""),
-        ("Exit privacy mode", ""),
+        ("Enter privacy mode", "Entrar no modo privado"),
+        ("Exit privacy mode", "Sair do modo privado"),
         ("idd_not_support_under_win10_2004_tip", ""),
         ("input_source_1_tip", ""),
         ("input_source_2_tip", ""),
         ("Swap control-command key", ""),
         ("swap-left-right-mouse", ""),

----------------------------------------

File: src/lang/ro.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/ru.rs
Status: modified
Changes: +15 -1
Diff:
@@ -629,6 +629,20 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("enable-bot-desc", "1) Откройте чат с @BotFather.\n2) Отправьте команду \"/newbot\". После выполнения этого шага вы получите токен.\n3) Начните чат с вашим только что созданным ботом. Отправьте сообщение, начинающееся с прямой косой черты (\"/\"), например, \"/hello\", чтобы его активировать.\n"),
         ("cancel-2fa-confirm-tip", "Отключить двухфакторную аутентификацию?"),
         ("cancel-bot-confirm-tip", "Отключить Telegram-бота?"),
-        ("About RustDesk", ""),
+        ("About RustDesk", "О RustDesk"),
+        ("Send clipboard keystrokes", "Отправлять нажатия клавиш из буфера обмена"),
+        ("network_error_tip", "Проверьте подключение к сети, затем нажмите \"Повтор\"."),
+        ("Unlock with PIN", "Разблокировать PIN-кодом"),
+        ("Requires at least {} characters", "Требуется не менее {} символов"),

----------------------------------------

File: src/lang/sk.rs
Status: modified
Changes: +15 -1
Diff:
@@ -629,6 +629,20 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("enable-bot-desc", "1, Otvorte chat s @BotFather.\n2, Odošlite príkaz \"/newbot\". Po dokončení tohto kroku dostanete token.\n3, Spustite chat s novo vytvoreným botom. Odošlite správu začínajúcu lomítkom vpred (\"/\"), napríklad \"/hello\", aby ste ho aktivovali.\n"),
         ("cancel-2fa-confirm-tip", "Ste si istí, že chcete zrušiť službu 2FA?"),
         ("cancel-bot-confirm-tip", "Ste si istí, že chcete zrušiť bota Telegramu?"),
-        ("About RustDesk", ""),
+        ("About RustDesk", "O RustDesk"),
+        ("Send clipboard keystrokes", "Odoslať stlačenia klávesov zo schránky"),
+        ("network_error_tip", "Skontrolujte svoje sieťové pripojenie a potom kliknite na tlačidlo Opakovať."),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),

----------------------------------------

File: src/lang/sl.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/sq.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/sr.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/sv.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/template.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/th.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/tr.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/lang/tw.rs
Status: modified
Changes: +15 -1
Diff:
@@ -629,6 +629,20 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("enable-bot-desc", "1. 開啟與 @BotFather 的對話。\n2. 傳送指令 \"/newbot\"。 您將會在完成此步驟後收到權杖 (Token)。\n3. 開始與您剛創立的機器人的對話。 傳送一則以正斜槓 (\"/\") 開頭的訊息來啟用它，例如 \"/hello\"。"),
         ("cancel-2fa-confirm-tip", "確定要取消二步驟驗證嗎？"),
         ("cancel-bot-confirm-tip", "確定要取消 Telegram 機器人嗎？"),
-        ("About RustDesk", ""),
+        ("About RustDesk", "關於 RustDesk"),
+        ("Send clipboard keystrokes", "發送剪貼簿按鍵"),
+        ("network_error_tip", "請檢查網路連結，然後點擊重試"),
+        ("Unlock with PIN", "使用 PIN 碼解鎖設定"),
+        ("Requires at least {} characters", "不少於 {} 個字元"),

----------------------------------------

File: src/lang/uk.rs
Status: renamed
Changes: +53 -39
Diff:
@@ -3,12 +3,12 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
     [
         ("Status", "Статус"),
         ("Your Desktop", "Ваша стільниця"),
-        ("desk_tip", "Ваша стільниця доступна з цим ідентифікатором і паролем"),
+        ("desk_tip", "Доступ до вашої стільниці можливий з цим ID та паролем."),
         ("Password", "Пароль"),
         ("Ready", "Готово"),
         ("Established", "Встановлено"),
         ("connecting_status", "Підключення до мережі RustDesk..."),
-        ("Enable service", "Включити службу"),
+        ("Enable service", "Увімкнути службу"),
         ("Start service", "Запустити службу"),
         ("Service is running", "Служба працює"),
         ("Service is not running", "Служба не запущена"),
@@ -41,9 +41,9 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("length %min% to %max%", "від %min% до %max% символів"),
         ("starts with a letter", "починається з літери"),
         ("allowed characters", "дозволені символи"),
-        ("id_change_tip", "Допускаються лише символи a-z, A-Z, 0-9 і _ (підкреслення). Першою повинна бути літера a-z, A-Z. В межах від 6 до 16 символів"),
+        ("id_change_tip", "Допускаються лише символи a-z, A-Z, 0-9 і _ (підкреслення). Першою повинна бути літера a-z, A-Z. Довжина — від 6 до 16 символів"),
         ("Website", "Веб-сайт"),
-        ("About", "Про RustDesk"),
+        ("About", "Про застосунок"),
         ("Slogan_tip", "Створено з душею в цьому хаотичному світі!"),
         ("Privacy Statement", "Декларація про конфіденційність"),
         ("Mute", "Вимкнути звук"),
@@ -66,7 +66,7 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("Cancel", "Скасувати"),
         ("Skip", "Пропустити"),
         ("Close", "Закрити"),
-        ("Retry", "Спробувати знову"),
+        ("Retry", "Повторити"),
         ("OK", "OK"),
         ("Password Required", "Потрібен пароль"),
         ("Please enter your password", "Будь ласка, введіть ваш пароль"),
@@ -145,23 +145,23 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("Failed to make direct connection to remote desktop", "Не вдалося встановити пряме підключення до віддаленої стільниці"),
         ("Set Password", "Встановити пароль"),
         ("OS Password", "Пароль ОС"),
-        ("install_tip", "Через UAC в деяких випадках RustDesk може працювати некоректно на віддаленому вузлі. Щоб уникнути UAC, натисніть кнопку нижче для встановлення RustDesk в системі"),
+        ("install_tip", "Через UAC, в деяких випадках RustDesk може працювати некоректно на віддаленому вузлі. Щоб уникнути UAC, натисніть кнопку нижче для встановлення RustDesk в системі"),
         ("Click to upgrade", "Натисніть, щоб перевірити наявність оновлень"),
         ("Click to download", "Натисніть, щоб завантажити"),
         ("Click to update", "Натисніть, щоб оновити"),
         ("Configure", "Налаштувати"),
-        ("config_acc", "Для віддаленого керування вашою стільницею, вам необхідно надати RustDesk дозволи \"Доступності\""),
-        ("config_screen", "Для віддаленого доступу до вашої стільниці,вам необхідно надати RustDesk дозволи на \"Запис екрана\""),
+        ("config_acc", "Для віддаленого керування вашою стільницею, вам необхідно надати RustDesk дозволи \"Спеціальні можливості\""),
+        ("config_screen", "Для віддаленого доступу до вашої стільниці, вам необхідно надати RustDesk дозволи на \"Запис екрана\""),
         ("Installing ...", "Встановлюється..."),
         ("Install", "Встановити"),
         ("Installation", "Встановлення"),
         ("Installation Path", "Шлях встановлення"),
         ("Create start menu shortcuts", "Створити ярлики меню \"Пуск\""),
-        ("Create desktop icon", "Створити значок на стільниці"),
+        ("Create desktop icon", "Створити піктограму на стільниці"),
         ("agreement_tip", "Починаючи встановлення, ви приймаєте умови ліцензійної угоди"),
         ("Accept and Install", "Прийняти та встановити"),
         ("End-user license agreement", "Ліцензійна угода з кінцевим користувачем"),
-        ("Generating ...", "Генерація..."),
+        ("Generating ...", "Генерування..."),
         ("Your installation is lower version.", "У вас встановлена більш рання версія"),
         ("not_close_tcp_tip", "Не закривайте це вікно під час використання тунелю"),
         ("Listening ...", "Очікуємо ..."),
@@ -173,7 +173,7 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("Local Address", "Локальна адреса"),
         ("Change Local Port", "Змінити локальний порт"),
         ("setup_server_tip", "Для пришвидшення зʼєднання, будь ласка, налаштуйте власний сервер"),
-        ("Too short, at least 6 characters.", "Занадто коротко, мінімум 6 символів"),
+        ("Too short, at least 6 characters.", "Має бути щонайменше 6 символів"),
         ("The confirmation is not identical.", "Підтвердження не збігається"),
         ("Permissions", "Дозволи"),
         ("Accept", "Прийняти"),

----------------------------------------

File: src/lang/vn.rs
Status: modified
Changes: +14 -0
Diff:
@@ -630,5 +630,19 @@ pub static ref T: std::collections::HashMap<&'static str, &'static str> =
         ("cancel-2fa-confirm-tip", ""),
         ("cancel-bot-confirm-tip", ""),
         ("About RustDesk", ""),
+        ("Send clipboard keystrokes", ""),
+        ("network_error_tip", ""),
+        ("Unlock with PIN", ""),
+        ("Requires at least {} characters", ""),
+        ("Wrong PIN", ""),
+        ("Set PIN", ""),

----------------------------------------

File: src/platform/linux.rs
Status: modified
Changes: +22 -17
Diff:
@@ -730,7 +730,8 @@ pub fn block_input(_v: bool) -> (bool, String) {
 
 pub fn is_installed() -> bool {
     if let Ok(p) = std::env::current_exe() {
-        p.to_str().unwrap_or_default().starts_with("/usr") || p.to_str().unwrap_or_default().starts_with("/nix/store")
+        p.to_str().unwrap_or_default().starts_with("/usr")
+            || p.to_str().unwrap_or_default().starts_with("/nix/store")
     } else {
         false
     }
@@ -1413,22 +1414,26 @@ pub fn check_autostart_config() -> ResultType<()> {
     let app_name = crate::get_app_name().to_lowercase();
     let path = format!("{home}/.config/autostart");
     let file = format!("{path}/{app_name}.desktop");
-    std::fs::create_dir_all(&path).ok();
-    if !Path::new(&file).exists() {
-        // write text to the desktop file

----------------------------------------

File: src/platform/macos.rs
Status: modified
Changes: +0 -1
Diff:
@@ -493,7 +493,6 @@ pub fn lock_screen() {
 }
 
 pub fn start_os_service() {
-    crate::platform::macos::hide_dock();
     log::info!("Username: {}", crate::username());
     let mut sys = System::new();
     let path =

----------------------------------------

File: src/platform/windows.rs
Status: modified
Changes: +168 -43
Diff:
@@ -1,21 +1,20 @@
 use super::{CursorData, ResultType};
-use crate::common::PORTABLE_APPNAME_RUNTIME_ENV_KEY;
 use crate::{
+    common::PORTABLE_APPNAME_RUNTIME_ENV_KEY,
     custom_server::*,
     ipc,
     privacy_mode::win_topmost_window::{self, WIN_TOPMOST_INJECTED_PROCESS_EXE},
 };
-use hbb_common::libc::{c_int, wchar_t};
 use hbb_common::{
     allow_err,
     anyhow::anyhow,
     bail,
     config::{self, Config},
+    libc::{c_int, wchar_t},
     log,
     message_proto::{DisplayInfo, Resolution, WindowsSession},
     sleep, timeout, tokio,
 };
-use std::process::{Command, Stdio};
 use std::{
     collections::HashMap,
     ffi::{CString, OsString},
@@ -24,15 +23,16 @@ use std::{
     mem,
     os::windows::process::CommandExt,
     path::*,
+    process::{Command, Stdio},
     ptr::null_mut,
     sync::{atomic::Ordering, Arc, Mutex},
     time::{Duration, Instant},
 };
 use wallpaper;
-use winapi::um::sysinfoapi::{GetNativeSystemInfo, SYSTEM_INFO};
 use winapi::{
     ctypes::c_void,
     shared::{minwindef::*, ntdef::NULL, windef::*, winerror::*},
+    um::sysinfoapi::{GetNativeSystemInfo, SYSTEM_INFO},
     um::{
         errhandlingapi::GetLastError,
         handleapi::CloseHandle,
@@ -63,13 +63,15 @@ use windows_service::{
     },
     service_control_handler::{self, ServiceControlHandlerResult},
 };
-use winreg::enums::*;
-use winreg::RegKey;
+use winreg::{enums::*, RegKey};
 
 pub const FLUTTER_RUNNER_WIN32_WINDOW_CLASS: &'static str = "FLUTTER_RUNNER_WIN32_WINDOW"; // main window, install window
 pub const EXPLORER_EXE: &'static str = "explorer.exe";
 pub const SET_FOREGROUND_WINDOW: &'static str = "SET_FOREGROUND_WINDOW";
 
+const REG_NAME_INSTALL_DESKTOPSHORTCUTS: &str = "DESKTOPSHORTCUTS";
+const REG_NAME_INSTALL_STARTMENUSHORTCUTS: &str = "STARTMENUSHORTCUTS";
+
 pub fn get_focused_display(displays: Vec<DisplayInfo>) -> Option<usize> {
     unsafe {
         let hwnd = GetForegroundWindow();
@@ -992,6 +994,32 @@ fn get_valid_subkey() -> String {
     return get_subkey(&app_name, false);
 }
 
+// Return install options other than InstallLocation.
+pub fn get_install_options() -> String {
+    let app_name = crate::get_app_name();
+    let subkey = format!(".{}", app_name.to_lowercase());
+    let mut opts = HashMap::new();
+
+    let desktop_shortcuts = get_reg_of_hkcr(&subkey, REG_NAME_INSTALL_DESKTOPSHORTCUTS);
+    if let Some(desktop_shortcuts) = desktop_shortcuts {
+        opts.insert(REG_NAME_INSTALL_DESKTOPSHORTCUTS, desktop_shortcuts);
+    }
+    let start_menu_shortcuts = get_reg_of_hkcr(&subkey, REG_NAME_INSTALL_STARTMENUSHORTCUTS);
+    if let Some(start_menu_shortcuts) = start_menu_shortcuts {
+        opts.insert(REG_NAME_INSTALL_STARTMENUSHORTCUTS, start_menu_shortcuts);
+    }
+    serde_json::to_string(&opts).unwrap_or("{}".to_owned())
+}
+
+// This function return Option<String>, because some registry value may be empty.
+fn get_reg_of_hkcr(subkey: &str, name: &str) -> Option<String> {
+    let hkcr = RegKey::predef(HKEY_CLASSES_ROOT);
+    if let Ok(tmp) = hkcr.open_subkey(subkey.replace("HKEY_CLASSES_ROOT\\", "")) {
+        return tmp.get_value(name).ok();
+    }
+    None
+}
+
 pub fn get_install_info() -> (String, String, String, String) {
     get_install_info_with_subkey(get_valid_subkey())
 }
@@ -1101,7 +1129,11 @@ pub fn copy_exe_cmd(src_exe: &str, exe: &str, path: &str) -> ResultType<String>
     ))
 }
 
-fn get_after_install(exe: &str) -> String {
+fn get_after_install(
+    exe: &str,
+    reg_value_start_menu_shortcuts: Option<String>,
+    reg_value_desktop_shortcuts: Option<String>,
+) -> String {
     let app_name = crate::get_app_name();
     let ext = app_name.to_lowercase();
 
@@ -1112,9 +1144,24 @@ fn get_after_install(exe: &str) -> String {
     hcu.delete_subkey_all(format!("Software\\Classes\\{}", exe))
         .ok();
 
+    let desktop_shortcuts = reg_value_desktop_shortcuts

----------------------------------------

File: src/privacy_mode.rs
Status: modified
Changes: +6 -8
Diff:
@@ -38,14 +38,9 @@ pub const TURN_OFF_OTHER_ID: &'static str =
     "Failed to turn off privacy mode that belongs to someone else.";
 pub const NO_PHYSICAL_DISPLAYS: &'static str = "no_need_privacy_mode_no_physical_displays_tip";
 
-#[cfg(windows)]
-pub const PRIVACY_MODE_IMPL_WIN_MAG: &str = win_mag::PRIVACY_MODE_IMPL;
-#[cfg(windows)]
-pub const PRIVACY_MODE_IMPL_WIN_EXCLUDE_FROM_CAPTURE: &str =
-    win_exclude_from_capture::PRIVACY_MODE_IMPL;
-
-#[cfg(windows)]

----------------------------------------

File: src/privacy_mode/win_exclude_from_capture.rs
Status: modified
Changes: +1 -1
Diff:
@@ -2,7 +2,7 @@ use hbb_common::platform::windows::is_windows_version_or_greater;
 
 pub use super::win_topmost_window::PrivacyModeImpl;
 
-pub(super) const PRIVACY_MODE_IMPL: &str = "privacy_mode_impl_exclude_from_capture";
+pub(super) const PRIVACY_MODE_IMPL: &str = super::PRIVACY_MODE_IMPL_WIN_EXCLUDE_FROM_CAPTURE;
 
 pub(super) fn is_supported() -> bool {
     // https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-setwindowdisplayaffinity

----------------------------------------

File: src/privacy_mode/win_mag.rs
Status: modified
Changes: +1 -1
Diff:
@@ -4,7 +4,7 @@ use std::time::Instant;
 
 pub use super::win_topmost_window::PrivacyModeImpl;
 
-pub(super) const PRIVACY_MODE_IMPL: &str = "privacy_mode_impl_mag";
+pub(super) const PRIVACY_MODE_IMPL: &str = super::PRIVACY_MODE_IMPL_WIN_MAG;
 
 pub fn create_capturer(
     privacy_mode_id: i32,

----------------------------------------

File: src/privacy_mode/win_topmost_window.rs
Status: modified
Changes: +1 -1
Diff:
@@ -75,7 +75,7 @@ impl PrivacyMode for PrivacyModeImpl {
     fn is_async_privacy_mode(&self) -> bool {
         false
     }
-    
+
     fn init(&self) -> ResultType<()> {
         Ok(())
     }

----------------------------------------

File: src/privacy_mode/win_virtual_display.rs
Status: modified
Changes: +51 -122
Diff:
@@ -1,5 +1,5 @@
 use super::{PrivacyMode, PrivacyModeState, INVALID_PRIVACY_MODE_CONN_ID, NO_PHYSICAL_DISPLAYS};
-use crate::virtual_display_manager;
+use crate::{platform::windows::reg_display_settings, virtual_display_manager};
 use hbb_common::{allow_err, bail, config::Config, log, ResultType};
 use std::{
     io::Error,
@@ -21,13 +21,13 @@ use winapi::{
         winuser::{
             ChangeDisplaySettingsExW, EnumDisplayDevicesW, EnumDisplaySettingsExW,
             EnumDisplaySettingsW, CDS_NORESET, CDS_RESET, CDS_SET_PRIMARY, CDS_UPDATEREGISTRY,
-            DISP_CHANGE_SUCCESSFUL, EDD_GET_DEVICE_INTERFACE_NAME, ENUM_CURRENT_SETTINGS,
-            ENUM_REGISTRY_SETTINGS,
+            DISP_CHANGE_FAILED, DISP_CHANGE_SUCCESSFUL, EDD_GET_DEVICE_INTERFACE_NAME,
+            ENUM_CURRENT_SETTINGS, ENUM_REGISTRY_SETTINGS,
         },
     },
 };
 
-pub(super) const PRIVACY_MODE_IMPL: &str = "privacy_mode_impl_virtual_display";
+pub(super) const PRIVACY_MODE_IMPL: &str = super::PRIVACY_MODE_IMPL_WIN_VIRTUAL_DISPLAY;
 
 const CONFIG_KEY_REG_RECOVERY: &str = "reg_recovery";
 
@@ -150,10 +150,24 @@ impl PrivacyModeImpl {
     }
 
     fn restore_plug_out_monitor(&mut self) {
-        let _ = virtual_display_manager::plug_out_monitor_indices(&self.virtual_displays_added);
+        let _ =
+            virtual_display_manager::plug_out_monitor_indices(&self.virtual_displays_added, true);
         self.virtual_displays_added.clear();
     }
 
+    #[inline]
+    fn change_display_settings_ex_err_msg(rc: i32) -> String {
+        if rc != DISP_CHANGE_FAILED {
+            format!("ret: {}", rc)
+        } else {
+            format!(
+                "ret: {}, last error: {:?}",
+                rc,
+                std::io::Error::last_os_error()
+            )
+        }
+    }
+
     fn set_primary_display(&mut self) -> ResultType<()> {
         let display = &self.virtual_displays[0];
 
@@ -213,23 +227,34 @@ impl PrivacyModeImpl {
                 dm.u1.s2_mut().dmPosition.x -= new_primary_dm.u1.s2().dmPosition.x;
                 dm.u1.s2_mut().dmPosition.y -= new_primary_dm.u1.s2().dmPosition.y;
                 dm.dmFields |= DM_POSITION;
+                dm.dmPelsWidth = 1920;
+                dm.dmPelsHeight = 1080;
                 let rc = ChangeDisplaySettingsExW(
                     dd.DeviceName.as_ptr(),
                     &mut dm,
                     NULL as _,
                     flags,
                     NULL,
                 );
-
                 if rc != DISP_CHANGE_SUCCESSFUL {
+                    let err = Self::change_display_settings_ex_err_msg(rc);
                     log::error!(
-                        "Failed ChangeDisplaySettingsEx, device name: {:?}, flags: {}, ret: {}",
+                        "Failed ChangeDisplaySettingsEx, device name: {:?}, flags: {}, {}",
                         std::string::String::from_utf16(&dd.DeviceName),
                         flags,
-                        rc
+                        &err
                     );
-                    bail!("Failed ChangeDisplaySettingsEx, ret: {}", rc);
+                    bail!("Failed ChangeDisplaySettingsEx, {}", err);
                 }
+
+                // If we want to set dpi, the following references may be helpful.
+                // And setting dpi should be called after changing the display settings.
+                // https://stackoverflow.com/questions/35233182/how-can-i-change-windows-10-display-scaling-programmatically-using-c-sharp
+                // https://github.com/lihas/windows-DPI-scaling-sample/blob/master/DPIHelper/DpiHelper.cpp
+                //
+                // But the official API does not provide a way to get/set dpi.
+                // https://learn.microsoft.com/en-us/windows/win32/api/wingdi/ne-wingdi-displayconfig_device_info_type
+                // https://github.com/lihas/windows-DPI-scaling-sample/blob/738ac18b7a7ce2d8fdc157eb825de9cb5eee0448/DPIHelper/DpiHelper.h#L37
             }

----------------------------------------

File: src/rendezvous_mediator.rs
Status: modified
Changes: +10 -5
Diff:
@@ -12,7 +12,10 @@ use uuid::Uuid;
 use hbb_common::{
     allow_err,
     anyhow::{self, bail},
-    config::{self, Config, CONNECT_TIMEOUT, READ_TIMEOUT, REG_INTERVAL, RENDEZVOUS_PORT},
+    config::{
+        self, keys::*, option2bool, Config, CONNECT_TIMEOUT, READ_TIMEOUT, REG_INTERVAL,
+        RENDEZVOUS_PORT,
+    },
     futures::future::join_all,
     log,
     protobuf::Message as _,
@@ -29,7 +32,7 @@ use hbb_common::{
 use crate::{

----------------------------------------

File: src/server.rs
Status: modified
Changes: +1 -1
Diff:
@@ -481,7 +481,7 @@ pub async fn start_server(is_server: bool) {
         });
         input_service::fix_key_down_timeout_loop();
         #[cfg(target_os = "linux")]
-        if crate::platform::current_is_wayland() {
+        if input_service::wayland_use_uinput() {
             allow_err!(input_service::setup_uinput(0, 1920, 0, 1080).await);
         }
         #[cfg(any(target_os = "macos", target_os = "linux"))]

----------------------------------------

File: src/server/audio_service.rs
Status: modified
Changes: +0 -1
Diff:
@@ -230,7 +230,6 @@ mod cpal_impl {
     #[cfg(windows)]
     fn get_device() -> ResultType<(Device, SupportedStreamConfig)> {
         let audio_input = super::get_audio_input();
-        println!("REMOVE ME =============================== use audio input: {}", &audio_input);
         if !audio_input.is_empty() {
             return get_audio_input(&audio_input);
         }

----------------------------------------

File: src/server/clipboard_service.rs
Status: modified
Changes: +169 -33
Diff:
@@ -1,49 +1,185 @@
 use super::*;
 pub use crate::clipboard::{
-    check_clipboard, ClipboardContext, CLIPBOARD_INTERVAL as INTERVAL, CLIPBOARD_NAME as NAME,
-    CONTENT,
+    check_clipboard, ClipboardContext, ClipboardSide, CLIPBOARD_INTERVAL as INTERVAL,
+    CLIPBOARD_NAME as NAME,
+};
+#[cfg(windows)]
+use crate::ipc::{self, ClipboardFile, ClipboardNonFile, Data};
+use clipboard_master::{CallbackResult, ClipboardHandler};
+use std::{
+    io,
+    sync::mpsc::{channel, RecvTimeoutError, Sender},
+    time::Duration,
 };
 
-#[derive(Default)]
-struct State {
+struct Handler {
+    sp: EmptyExtraFieldService,
     ctx: Option<ClipboardContext>,
+    tx_cb_result: Sender<CallbackResult>,
+    #[cfg(target_os = "windows")]
+    stream: Option<ipc::ConnectionTmpl<parity_tokio_ipc::ConnectionClient>>,
 }
 
-impl super::service::Reset for State {
-    fn reset(&mut self) {
-        *CONTENT.lock().unwrap() = Default::default();
-        self.ctx = None;
-    }
+pub fn new() -> GenericService {
+    let svc = EmptyExtraFieldService::new(NAME.to_owned(), true);
+    GenericService::run(&svc.clone(), run);
+    svc.sp
+}
+
+fn run(sp: EmptyExtraFieldService) -> ResultType<()> {
+    let (tx_cb_result, rx_cb_result) = channel();
+    let handler = Handler {
+        sp: sp.clone(),
+        ctx: Some(ClipboardContext::new()?),
+        tx_cb_result,
+        #[cfg(target_os = "windows")]
+        stream: None,
+    };
+
+    let (tx_start_res, rx_start_res) = channel();
+    let h = crate::clipboard::start_clipbard_master_thread(handler, tx_start_res);
+    let shutdown = match rx_start_res.recv() {
+        Ok((Some(s), _)) => s,
+        Ok((None, err)) => {
+            bail!(err);
+        }
+        Err(e) => {
+            bail!("Failed to create clipboard listener: {}", e);
+        }
+    };
 
-    fn init(&mut self) {
-        let ctx = match ClipboardContext::new(true) {
-            Ok(ctx) => Some(ctx),
-            Err(err) => {
-                log::error!("Failed to start {}: {}", NAME, err);
-                None
+    while sp.ok() {
+        match rx_cb_result.recv_timeout(Duration::from_millis(INTERVAL)) {
+            Ok(CallbackResult::Stop) => {
+                log::debug!("Clipboard listener stopped");
+                break;
             }
-        };

----------------------------------------

File: src/server/connection.rs
Status: modified
Changes: +86 -9
Diff:
@@ -1,6 +1,6 @@
 use super::{input_service::*, *};
 #[cfg(not(any(target_os = "android", target_os = "ios")))]
-use crate::clipboard::update_clipboard;
+use crate::clipboard::{update_clipboard, ClipboardSide};
 #[cfg(any(target_os = "windows", target_os = "linux", target_os = "macos"))]
 use crate::clipboard_file::*;
 #[cfg(target_os = "android")]
@@ -27,7 +27,7 @@ use hbb_common::platform::linux::run_cmds;
 #[cfg(target_os = "android")]
 use hbb_common::protobuf::EnumOrUnknown;
 use hbb_common::{
-    config::{self, Config},
+    config::{self, Config, TrustedDevice},
     fs::{self, can_enable_overwrite_detection},
     futures::{SinkExt, StreamExt},
     get_time, get_version_number,
@@ -502,10 +502,12 @@ impl Connection {
                             } else if &name == "audio" {
                                 conn.audio = enabled;
                                 conn.send_permission(Permission::Audio, enabled).await;
-                                if let Some(s) = conn.server.upgrade() {
-                                    s.write().unwrap().subscribe(
-                                        super::audio_service::NAME,
-                                        conn.inner.clone(), conn.audio_enabled());
+                                if conn.authorized {
+                                    if let Some(s) = conn.server.upgrade() {
+                                        s.write().unwrap().subscribe(
+                                            super::audio_service::NAME,
+                                            conn.inner.clone(), conn.audio_enabled());
+                                    }
                                 }
                             } else if &name == "file" {
                                 conn.file = enabled;
@@ -682,8 +684,19 @@ impl Connection {
                                 msg = Arc::new(new_msg);
                             }
                         }
+                        Some(message::Union::MultiClipboards(_multi_clipboards)) => {
+                            #[cfg(not(any(target_os = "android", target_os = "ios")))]
+                            if let Some(msg_out) = crate::clipboard::get_msg_if_not_support_multi_clip(&conn.lr.version, &conn.lr.my_platform, _multi_clipboards) {
+                                if let Err(err) = conn.stream.send(&msg_out).await {
+                                    conn.on_close(&err.to_string(), false).await;
+                                    break;
+                                }
+                                continue;
+                            }
+                        }
                         _ => {}
                     }
+
                     let msg: &Message = &msg;
                     if let Err(err) = conn.stream.send(msg).await {
                         conn.on_close(&err.to_string(), false).await;
@@ -1307,7 +1320,7 @@ impl Connection {
                     #[cfg(target_os = "linux")]
                     {
                         // use rdp_input when uinput is not available in wayland. Ex: flatpak
-                        if !is_x11() && !crate::is_server() {
+                        if input_service::wayland_use_rdp_input() {
                             let _ = setup_rdp_input().await;
                         }
                     }
@@ -1469,6 +1482,9 @@ impl Connection {

----------------------------------------

File: src/server/display_service.rs
Status: modified
Changes: +0 -1
Diff:
@@ -433,7 +433,6 @@ pub fn try_get_displays_(add_amyuni_headless: bool) -> ResultType<Vec<Display>>
     // }
 
     let no_displays_v = no_displays(&displays);
-    virtual_display_manager::set_can_plug_out_all(!no_displays_v);
     if no_displays_v {
         log::debug!("no displays, create virtual display");
         if let Err(e) = virtual_display_manager::plug_in_headless() {

----------------------------------------

File: src/server/input_service.rs
Status: modified
Changes: +13 -2
Diff:
@@ -973,12 +973,11 @@ pub fn handle_mouse_(evt: &MouseEvent, conn: i32) {
         },
         MOUSE_TYPE_WHEEL | MOUSE_TYPE_TRACKPAD => {
             #[allow(unused_mut)]
-            let mut x = evt.x;
+            let mut x = -evt.x;
             #[allow(unused_mut)]
             let mut y = evt.y;
             #[cfg(not(windows))]
             {
-                x = -x;

----------------------------------------

File: src/server/uinput.rs
Status: modified
Changes: +369 -19
Diff:
@@ -4,7 +4,11 @@ use evdev::{
     uinput::{VirtualDevice, VirtualDeviceBuilder},
     AttributeSet, EventType, InputEvent,
 };
-use hbb_common::{allow_err, bail, log, tokio::{self, runtime::Runtime}, ResultType};
+use hbb_common::{
+    allow_err, bail, log,
+    tokio::{self, runtime::Runtime},
+    ResultType,
+};
 
 static IPC_CONN_TIMEOUT: u64 = 1000;
 static IPC_REQUEST_TIMEOUT: u64 = 1000;
@@ -34,7 +38,10 @@ pub mod client {
         fn send_get_key_state(&mut self, data: Data) -> ResultType<bool> {
             self.rt.block_on(self.conn.send(&data))?;
 
-            match self.rt.block_on(self.conn.next_timeout(IPC_REQUEST_TIMEOUT)) {
+            match self
+                .rt
+                .block_on(self.conn.next_timeout(IPC_REQUEST_TIMEOUT))
+            {
                 Ok(Some(Data::KeyboardResponse(ipc::DataKeyboardResponse::GetKeyState(state)))) => {
                     Ok(state)
                 }
@@ -171,7 +178,6 @@ pub mod client {
 pub mod service {
     use super::*;
     use hbb_common::lazy_static;
-    use mouce::MouseActions;
     use std::{collections::HashMap, sync::Mutex};
 
     lazy_static::lazy_static! {
@@ -389,7 +395,7 @@ pub mod service {
         } else {
             match key {
                 enigo::Key::Layout(c) => {
-                    if let Some((k,is_shift)) = KEY_MAP_LAYOUT.get(&c) {
+                    if let Some((k, is_shift)) = KEY_MAP_LAYOUT.get(&c) {
                         log::trace!("mapkey {:?}, get {:?}", &key, k);
                         return Ok((k.clone(), is_shift.clone()));
                     }
@@ -431,7 +437,8 @@ pub mod service {
             DataKeyboard::KeyDown(key) => {
                 if let Ok((k, is_shift)) = map_key(key) {
                     if is_shift {
-                        let down_event = InputEvent::new(EventType::KEY, evdev::Key::KEY_LEFTSHIFT.code(), 1);
+                        let down_event =
+                            InputEvent::new(EventType::KEY, evdev::Key::KEY_LEFTSHIFT.code(), 1);
                         allow_err!(keyboard.emit(&[down_event]));
                     }
                     let down_event = InputEvent::new(EventType::KEY, k.code(), 1);
@@ -504,7 +511,7 @@ pub mod service {
         }
     }
 
-    fn handle_mouse(mouse: &mut mouce::nix::UInputMouseManager, data: &DataMouse) {
+    fn handle_mouse(mouse: &mut mouce::UInputMouseManager, data: &DataMouse) {
         log::trace!("handle_mouse {:?}", &data);
         match data {
             DataMouse::MoveTo(x, y) => {
@@ -515,9 +522,9 @@ pub mod service {
             }
             DataMouse::Down(button) => {
                 let btn = match button {
-                    enigo::MouseButton::Left => mouce::common::MouseButton::Left,
-                    enigo::MouseButton::Middle => mouce::common::MouseButton::Middle,
-                    enigo::MouseButton::Right => mouce::common::MouseButton::Right,
+                    enigo::MouseButton::Left => mouce::MouseButton::Left,
+                    enigo::MouseButton::Middle => mouce::MouseButton::Middle,
+                    enigo::MouseButton::Right => mouce::MouseButton::Right,
                     _ => {
                         return;
                     }
@@ -526,9 +533,9 @@ pub mod service {
             }
             DataMouse::Up(button) => {
                 let btn = match button {
-                    enigo::MouseButton::Left => mouce::common::MouseButton::Left,
-                    enigo::MouseButton::Middle => mouce::common::MouseButton::Middle,
-                    enigo::MouseButton::Right => mouce::common::MouseButton::Right,
+                    enigo::MouseButton::Left => mouce::MouseButton::Left,
+                    enigo::MouseButton::Middle => mouce::MouseButton::Middle,
+                    enigo::MouseButton::Right => mouce::MouseButton::Right,
                     _ => {
                         return;
                     }
@@ -537,9 +544,9 @@ pub mod service {
             }
             DataMouse::Click(button) => {
                 let btn = match button {
-                    enigo::MouseButton::Left => mouce::common::MouseButton::Left,
-                    enigo::MouseButton::Middle => mouce::common::MouseButton::Middle,
-                    enigo::MouseButton::Right => mouce::common::MouseButton::Right,
+                    enigo::MouseButton::Left => mouce::MouseButton::Left,
+                    enigo::MouseButton::Middle => mouce::MouseButton::Middle,
+                    enigo::MouseButton::Right => mouce::MouseButton::Right,
                     _ => {
                         return;
                     }
@@ -553,9 +560,9 @@ pub mod service {
                 let mut length = *length;
 
                 let scroll = if length < 0 {
-                    mouce::common::ScrollDirection::Up
+                    mouce::ScrollDirection::Up
                 } else {
-                    mouce::common::ScrollDirection::Down
+                    mouce::ScrollDirection::Down
                 };
 
                 if length < 0 {
@@ -621,7 +628,7 @@ pub mod service {
                 rng_y.0,
                 rng_y.1
             );
-            let mut mouse = match mouce::Mouse::new_uinput(rng_x, rng_y) {
+            let mut mouse = match mouce::UInputMouseManager::new(rng_x, rng_y) {
                 Ok(mouse) => mouse,
                 Err(e) => {
                     log::error!("Failed to create mouse, {}", e);
@@ -650,7 +657,7 @@ pub mod service {
                                                 rng_y.0,
                                                 rng_y.1
                                             );
-                                            mouse = match mouce::Mouse::new_uinput(rng_x, rng_y) {
+                                            mouse = match mouce::UInputMouseManager::new(rng_x, rng_y) {
                                                 Ok(mouse) => mouse,
                                                 Err(e) => {
                                                     log::error!("Failed to create mouse, {}", e);
@@ -761,3 +768,346 @@ pub mod service {
         log::info!("stop uinput control service");
     }
 }
+
+// https://github.com/emrebicer/mouce
+mod mouce {
+    use std::{
+        fs::File,
+        io::{Error, ErrorKind, Result},
+        mem::size_of,
+        os::{
+            raw::{c_char, c_int, c_long, c_uint, c_ulong, c_ushort},
+            unix::{fs::OpenOptionsExt, io::AsRawFd},
+        },
+        thread,
+        time::Duration,
+    };
+
+    pub const O_NONBLOCK: c_int = 2048;
+
+    /// ioctl and uinput definitions
+    const UI_ABS_SETUP: c_ulong = 1075598596;
+    const UI_SET_EVBIT: c_ulong = 1074025828;
+    const UI_SET_KEYBIT: c_ulong = 1074025829;
+    const UI_SET_RELBIT: c_ulong = 1074025830;
+    const UI_SET_ABSBIT: c_ulong = 1074025831;
+    const UI_DEV_SETUP: c_ulong = 1079792899;
+    const UI_DEV_CREATE: c_ulong = 21761;

----------------------------------------

File: src/server/video_service.rs
Status: modified
Changes: +9 -4
Diff:
@@ -540,7 +540,7 @@ fn run(vs: VideoService) -> ResultType<()> {
             VRamEncoder::set_fallback_gdi(display_idx, true);
             bail!("SWITCH");
         }
-        check_privacy_mode_changed(&sp, c.privacy_mode_id)?;
+        check_privacy_mode_changed(&sp, display_idx, &c)?;
         #[cfg(windows)]
         {
             if crate::platform::windows::desktop_changed()
@@ -659,7 +659,7 @@ fn run(vs: VideoService) -> ResultType<()> {
         let timeout_millis = 3_000u64;
         let wait_begin = Instant::now();
         while wait_begin.elapsed().as_millis() < timeout_millis as _ {
-            check_privacy_mode_changed(&sp, c.privacy_mode_id)?;

----------------------------------------

File: src/server/wayland.rs
Status: modified
Changes: +33 -29
Diff:
@@ -135,6 +135,7 @@ pub(super) async fn check_init() -> ResultType<()> {
         let mut maxx = 0;
         let mut miny = 0;
         let mut maxy = 0;
+        let use_uinput = crate::input_service::wayland_use_uinput();
 
         if *CAP_DISPLAY_INFO.read().unwrap() == 0 {
             let mut lock = CAP_DISPLAY_INFO.write().unwrap();
@@ -167,28 +168,29 @@ pub(super) async fn check_init() -> ResultType<()> {
                     num_cpus::get(),
                 );
 
-                let (max_width, max_height) = match get_max_desktop_resolution() {
-                    Some(result) if !result.is_empty() => {
-                        let resolution: Vec<&str> = result.split(" ").collect();
-                        let w: i32 = resolution[0].parse().unwrap_or(origin.0 + width as i32);
-                        let h: i32 = resolution[2]
-                            .trim_end_matches(",")
-                            .parse()
-                            .unwrap_or(origin.1 + height as i32);
-                        if w < origin.0 + width as i32 || h < origin.1 + height as i32 {
-                            (origin.0 + width as i32, origin.1 + height as i32)
+                if use_uinput {
+                    let (max_width, max_height) = match get_max_desktop_resolution() {
+                        Some(result) if !result.is_empty() => {
+                            let resolution: Vec<&str> = result.split(" ").collect();
+                            let w: i32 = resolution[0].parse().unwrap_or(origin.0 + width as i32);
+                            let h: i32 = resolution[2]

----------------------------------------

File: src/tray.rs
Status: modified
Changes: +13 -1
Diff:
@@ -9,10 +9,22 @@ use std::sync::{Arc, Mutex};
 use std::time::Duration;
 
 pub fn start_tray() {
+    if crate::ui_interface::get_builtin_option(hbb_common::config::keys::OPTION_HIDE_TRAY) == "Y" {
+        #[cfg(target_os = "macos")]
+        {
+            loop {
+                std::thread::sleep(std::time::Duration::from_secs(1));
+            }

----------------------------------------

File: src/ui.rs
Status: modified
Changes: +5 -0
Diff:
@@ -312,6 +312,10 @@ impl UI {
         install_path()
     }
 
+    fn install_options(&self) -> String {
+        install_options()
+    }
+
     fn get_socks(&self) -> Value {
         Value::from_iter(get_socks())

----------------------------------------

File: src/ui/common.tis
Status: modified
Changes: +1 -1
Diff:
@@ -268,7 +268,7 @@ function msgbox(type, title, content, link="", callback=null, height=180, width=
                 view.close();
                 return;
             }
-            handler.send2fa(res.code); 
+            handler.send2fa(res.code, res.trust_this_device || false); 
             msgbox("connecting", "Connecting...", "Logging in...");
         };
     } else if (type == "session-login" || type == "session-re-login") {

----------------------------------------

File: src/ui/index.tis
Status: modified
Changes: +1 -1
Diff:
@@ -1149,7 +1149,7 @@ function showSettings() {
 function checkConnectStatus() {
     handler.check_mouse_time(); // trigger connection status updater
     self.timer(1s, function() {
-        var tmp = !!handler.get_option("stop-service");
+        var tmp = handler.get_option("stop-service") == "Y";
         if (tmp != service_stopped) {
             service_stopped = tmp;
             app.update();

----------------------------------------

File: src/ui/install.tis
Status: modified
Changes: +5 -2
Diff:
@@ -6,13 +6,16 @@ var install_path = "";
 
 class Install: Reactor.Component {
     function render() {
+        const install_options = JSON.parse(view.install_options());
+        const desktop_icon = { checked: install_options?.DESKTOPSHORTCUTS == '0' ? false : true };
+        const startmenu_shortcuts = { checked: install_options?.STARTMENUSHORTCUTS == '0' ? false : true };
         return <div .content>
             <div style="font-size: 2em;">{translate('Installation')}</div>
             <div style="margin: 2em 0;">{translate('Installation Path')} {": "}<input|text disabled value={view.install_path()} #path_input />

----------------------------------------

File: src/ui/msgbox.tis
Status: modified
Changes: +2 -0
Diff:
@@ -66,9 +66,11 @@ class MsgboxComponent: Reactor.Component {
     }
 
     function get2faContent() {
+        var enable_trusted_devices = handler.get_enable_trusted_devices();
         return <div .form>
             <div>{translate('enter-2fa-title')}</div>
             <div .code><input name='code' type='text' .outline-focus /></div>
+            {enable_trusted_devices ? <div><button|checkbox(trust_this_device) {ts}>{translate('Trust this device')}</button></div> : ""}
         </div>;

----------------------------------------

File: src/ui/remote.rs
Status: modified
Changes: +2 -1
Diff:
@@ -433,7 +433,8 @@ impl sciter::EventHandler for SciterSession {
         fn is_port_forward();
         fn is_rdp();
         fn login(String, String, String, bool);
-        fn send2fa(String);
+        fn send2fa(String, bool);
+        fn get_enable_trusted_devices();
         fn new_rdp();
         fn send_mouse(i32, i32, i32, bool, bool, bool, bool);
         fn enter(String);

----------------------------------------

File: src/ui_cm_interface.rs
Status: modified
Changes: +68 -17
Diff:
@@ -1,16 +1,5 @@
-#[cfg(any(target_os = "android", target_os = "ios", feature = "flutter"))]
-use std::iter::FromIterator;
-#[cfg(any(target_os = "windows", target_os = "linux", target_os = "macos"))]
-use std::sync::Arc;
-use std::{
-    collections::HashMap,
-    ops::{Deref, DerefMut},
-    sync::{
-        atomic::{AtomicI64, Ordering},
-        RwLock,
-    },
-};
-
+#[cfg(target_os = "windows")]
+use crate::ipc::ClipboardNonFile;
 #[cfg(not(any(target_os = "android", target_os = "ios")))]
 use crate::ipc::Connection;
 #[cfg(not(any(target_os = "ios")))]
@@ -21,7 +10,7 @@ use clipboard::ContextSend;
 use hbb_common::tokio::sync::mpsc::unbounded_channel;
 use hbb_common::{
     allow_err,
-    config::Config,
+    config::{keys::*, option2bool, Config},
     fs::is_write_need_confirmation,
     fs::{self, get_string, new_send_confirm, DigestCheckResult},
     log,
@@ -36,6 +25,18 @@ use hbb_common::{
 #[cfg(any(target_os = "windows", target_os = "linux", target_os = "macos"))]
 use hbb_common::{tokio::sync::Mutex as TokioMutex, ResultType};
 use serde_derive::Serialize;
+#[cfg(any(target_os = "android", target_os = "ios", feature = "flutter"))]
+use std::iter::FromIterator;
+#[cfg(any(target_os = "windows", target_os = "linux", target_os = "macos"))]
+use std::sync::Arc;
+use std::{
+    collections::HashMap,
+    ops::{Deref, DerefMut},
+    sync::{
+        atomic::{AtomicI64, Ordering},
+        RwLock,
+    },

----------------------------------------

File: src/ui_interface.rs
Status: modified
Changes: +61 -5
Diff:
@@ -3,7 +3,10 @@ use hbb_common::password_security;
 use hbb_common::{
     allow_err,
     bytes::Bytes,
-    config::{self, Config, LocalConfig, PeerConfig, CONNECT_TIMEOUT, RENDEZVOUS_PORT},
+    config::{
+        self, keys::*, option2bool, Config, LocalConfig, PeerConfig, CONNECT_TIMEOUT,
+        RENDEZVOUS_PORT,
+    },
     directories_next,
     futures::future::join_all,
     log,
@@ -203,8 +206,8 @@ pub fn get_hard_option(key: String) -> String {
 }
 
 #[inline]
-pub fn get_buildin_option(key: &str) -> String {
-    config::BUILDIN_SETTINGS
+pub fn get_builtin_option(key: &str) -> String {
+    config::BUILTIN_SETTINGS
         .read()
         .unwrap()
         .get(key)
@@ -423,6 +426,14 @@ pub fn install_path() -> String {
     return "".to_owned();
 }
 
+#[inline]
+pub fn install_options() -> String {
+    #[cfg(windows)]
+    return crate::platform::windows::get_install_options();
+    #[cfg(not(windows))]
+    return "{}".to_owned();
+}
+

----------------------------------------

File: src/ui_session_interface.rs
Status: modified
Changes: +16 -3
Diff:
@@ -779,7 +779,6 @@ impl<T: InvokeUiSession> Session<T> {
         }
     }
 
-    // flutter only TODO new input
     pub fn input_string(&self, value: &str) {
         let mut key_event = KeyEvent::new();
         key_event.set_seq(value.to_owned());
@@ -1018,7 +1017,7 @@ impl<T: InvokeUiSession> Session<T> {
             }
         }
 
-        let (x, y) = if mask == MOUSE_TYPE_WHEEL {
+        let (x, y) = if mask == MOUSE_TYPE_WHEEL || mask == MOUSE_TYPE_TRACKPAD {
             self.get_scroll_xy((x, y))
         } else {

----------------------------------------

File: src/virtual_display_manager.rs
Status: modified
Changes: +45 -34
Diff:
@@ -1,38 +1,14 @@
 use hbb_common::{bail, platform::windows::is_windows_version_or_greater, ResultType};
-use std::sync::atomic;
 
 // This string is defined here.
-//  https://github.com/rustdesk/RustDeskIddDriver/blob/b370aad3f50028b039aad211df60c8051c4a64d6/RustDeskIddDriver/RustDeskIddDriver.inf#LL73C1-L73C40
+//  https://github.com/rustdesk-org/RustDeskIddDriver/blob/b370aad3f50028b039aad211df60c8051c4a64d6/RustDeskIddDriver/RustDeskIddDriver.inf#LL73C1-L73C40
 pub const RUSTDESK_IDD_DEVICE_STRING: &'static str = "RustDeskIddDriver Device\0";
 pub const AMYUNI_IDD_DEVICE_STRING: &'static str = "USB Mobile Monitor Virtual Display\0";
 
 const IDD_IMPL: &str = IDD_IMPL_AMYUNI;
 const IDD_IMPL_RUSTDESK: &str = "rustdesk_idd";
 const IDD_IMPL_AMYUNI: &str = "amyuni_idd";
 
-const IS_CAN_PLUG_OUT_ALL_NOT_SET: i8 = 0;
-const IS_CAN_PLUG_OUT_ALL_YES: i8 = 1;
-const IS_CAN_PLUG_OUT_ALL_NO: i8 = 2;
-static IS_CAN_PLUG_OUT_ALL: atomic::AtomicI8 = atomic::AtomicI8::new(IS_CAN_PLUG_OUT_ALL_NOT_SET);
-
-pub fn is_can_plug_out_all() -> bool {
-    IS_CAN_PLUG_OUT_ALL.load(atomic::Ordering::Relaxed) != IS_CAN_PLUG_OUT_ALL_NO
-}
-
-// No need to consider concurrency here.
-pub fn set_can_plug_out_all(v: bool) {
-    if IS_CAN_PLUG_OUT_ALL.load(atomic::Ordering::Relaxed) == IS_CAN_PLUG_OUT_ALL_NOT_SET {
-        IS_CAN_PLUG_OUT_ALL.store(
-            if v {
-                IS_CAN_PLUG_OUT_ALL_YES
-            } else {
-                IS_CAN_PLUG_OUT_ALL_NO
-            },
-            atomic::Ordering::Relaxed,
-        );
-    }
-}
-
 pub fn is_amyuni_idd() -> bool {
     IDD_IMPL == IDD_IMPL_AMYUNI
 }
@@ -100,7 +76,7 @@ pub fn plug_in_monitor(idx: u32, modes: Vec<virtual_display::MonitorMode>) -> Re
     }
 }
 
-pub fn plug_out_monitor(index: i32) -> ResultType<()> {
+pub fn plug_out_monitor(index: i32, force_all: bool) -> ResultType<()> {
     match IDD_IMPL {
         IDD_IMPL_RUSTDESK => {
             let indices = if index == -1 {
@@ -110,7 +86,7 @@ pub fn plug_out_monitor(index: i32) -> ResultType<()> {
             };
             rustdesk_idd::plug_out_peer_request(&indices)
         }
-        IDD_IMPL_AMYUNI => amyuni_idd::plug_out_monitor(index),
+        IDD_IMPL_AMYUNI => amyuni_idd::plug_out_monitor(index, force_all),
         _ => bail!("Unsupported virtual display implementation."),
     }
 }
@@ -126,12 +102,12 @@ pub fn plug_in_peer_request(modes: Vec<Vec<virtual_display::MonitorMode>>) -> Re

----------------------------------------

File: vcpkg.json
Status: modified
Changes: +35 -4
Diff:
@@ -51,13 +51,44 @@
     {
       "name": "libyuv",
       "host": false
+    },
+    {
+      "name": "ffmpeg",
+      "host": true,
+      "features": [
+        {
+          "name": "amf",
+          "platform": "((windows | linux) & static)"
+        },
+        {
+          "name": "nvcodec",
+          "platform": "((windows | linux) & static)"

----------------------------------------

